<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Kinh Doanh V·∫≠n H√†nh</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <style>
    /* ==================== CSS VARIABLES ==================== */
    :root {
      /* Colors */
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --primary-light: #3b82f6;
      --secondary: #64748b;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #0ea5e9;
      
      /* Backgrounds */
      --bg-main: #f0f4f8;
      --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
      --bg-sidebar: #1a2744;
      --bg-header: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
      
      /* Text */
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-light: #9ca3af;
      --text-white: #ffffff;
      
      /* Borders */
      --border-color: #e5e7eb;
      --border-radius: 10px;
      --border-radius-sm: 6px;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.15);
      
      /* Spacing */
      --spacing-xs: 5px;
      --spacing-sm: 10px;
      --spacing-md: 15px;
      --spacing-lg: 20px;
      --spacing-xl: 30px;
    }

    /* ==================== RESET & BASE ==================== */

    /* ==================== RESET & BASE ==================== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica', 'Arial', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ==================== CONTAINER & LAYOUT ==================== */
    .container {
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ==================== HEADER ==================== */
    .header {
      background: var(--bg-header);
      color: var(--text-white);
      padding: 25px 30px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow);
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-logo {
      height: 50px;
      width: auto;
    }

    .header-title h1 {
      font-size: 28px;
      font-weight: 700;
      margin: 0;
      line-height: 1.2;
    }

    .header-title p {
      font-size: 13px;
      opacity: 0.9;
      margin-top: 3px;
    }

    .header-filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-select {
      background: #eff6ff;
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.875rem;
      color: #1e40af;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-select:hover {
      border-color: #2563eb;
      background: #dbeafe;
    }

    .filter-select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* ==================== MAIN WRAPPER ==================== */
    /* ==================== MAIN WRAPPER ==================== */
    .main-wrapper {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ==================== SIDEBAR NAVIGATION ==================== */
    .sidebar {
      background: linear-gradient(180deg, #1e3a8a 0%, #2563eb 100%);
      width: 300px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      z-index: 50;
    }

    .sidebar-header {
      padding: 32px 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 16px;
      text-align: left;
    }

    .sidebar-logo-img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      background: white;
      padding: 10px;
      border-radius: 14px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }

    .sidebar-brand {
      flex: 1;
    }

    .sidebar-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: white;
      line-height: 1.3;
      margin: 0;
    }

    .sidebar-subtitle {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.75);
      line-height: 1.4;
      margin-bottom: 4px;
      font-weight: 500;
    }

    .sidebar-logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 10px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
    }

    .nav-section {
      padding: 16px 12px;
    }

    .nav-section-title {
      padding: 8px 12px;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.65);
      margin-bottom: 4px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      margin: 2px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.95rem;
      font-weight: 500;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-left-color: white;
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      border-left-color: white;
      color: white;
      font-weight: 600;
    }

    .nav-icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      margin-top: auto;
      padding: 16px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.15);
    }

    .sidebar-update {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.75);
      text-align: center;
      line-height: 1.5;
    }

    /* ==================== CONTENT AREA ==================== */
    .content {
      flex: 1;
      overflow-y: auto;
      background: var(--bg-gradient);
    }

    .content-inner {
      padding: 25px;
      max-width: 1800px;
      margin: 0 auto;
    }

    /* ==================== PAGE SECTIONS ==================== */
    .page {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border-color);
    }

    .page-title {
      font-size: 26px;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    /* ==================== CARDS & KPI ==================== */
    /* ==================== CARDS & KPI ==================== */
    .stats-grid,
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-bottom: 25px;
    }

    .stat-card,
    .kpi-card {
      background: white;
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover,
    .kpi-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card.success, .kpi-card.success { border-left-color: var(--success); }
    .stat-card.warning, .kpi-card.warning { border-left-color: var(--warning); }
    .stat-card.danger, .kpi-card.danger { border-left-color: var(--danger); }
    .stat-card.info, .kpi-card.info { border-left-color: var(--info); }

    .stat-label,
    .kpi-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .stat-value,
    .kpi-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 5px;
      line-height: 1.2;
    }

    .stat-change,
    .kpi-meta {
      font-size: 12px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .stat-change.up { color: var(--success); }
    .stat-change.down { color: var(--danger); }

    .trend-up { color: var(--success); font-weight: 600; }
    .trend-down { color: var(--danger); font-weight: 600; }

    /* ==================== CHARTS & CARDS ==================== */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .card,
    .chart-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
      transition: all 0.3s;
    }

    .card:hover,
    .chart-card:hover {
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--border-color);
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 3px;
    }

    .chart-wrapper {
      min-height: 300px;
      width: 100%;
    }

    /* ==================== BADGES & PILLS ==================== */
    .badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-primary { background: #dbeafe; color: #1e40af; }
    .badge-success { background: #d1fae5; color: #065f46; }
    .badge-warning { background: #fef3c7; color: #92400e; }
    .badge-danger { background: #fee2e2; color: #991b1b; }
    .badge-info { background: #e0f2fe; color: #075985; }

    .status-pill {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid transparent;
    }

    .status-pill.success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border-color: rgba(16, 185, 129, 0.3);
    }

    .status-pill.warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border-color: rgba(245, 158, 11, 0.3);
    }

    .status-pill.danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border-color: rgba(239, 68, 68, 0.3);
    }

    /* ==================== TABLES ==================== */
    .table-wrapper {
      overflow-x: auto;
      border-radius: var(--border-radius);
      background: white;
      padding: 20px;
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th {
      background: #f9fafb;
      color: var(--text-secondary);
      font-weight: 600;
      text-align: left;
      padding: 12px 15px;
      border-bottom: 2px solid var(--border-color);
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.5px;
    }

    td {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-primary);
    }

    tbody tr:hover {
      background: #f9fafb;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    /* ==================== PROGRESS BARS ==================== */
    .progress-bar {
      background: #e5e7eb;
      height: 8px;
      border-radius: 10px;
      overflow: hidden;
      margin: 8px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      transition: width 0.3s ease;
      border-radius: 10px;
    }

    .progress-fill.success { background: linear-gradient(90deg, var(--success), #34d399); }
    .progress-fill.warning { background: linear-gradient(90deg, var(--warning), #fbbf24); }
    .progress-fill.danger { background: linear-gradient(90deg, var(--danger), #f87171); }

    /* ==================== RESPONSIVE ==================== */

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 1280px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 1024px) {
      .sidebar {
        width: 200px;
      }

      .header-title h1 {
        font-size: 22px;
      }

      .stats-grid,
      .kpi-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .main-wrapper {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        max-height: 300px;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .header-left {
        width: 100%;
      }

      .header-filters {
        width: 100%;
        justify-content: flex-start;
      }

      .content-inner {
        padding: 15px;
      }

      .stats-grid,
      .kpi-grid {
        grid-template-columns: 1fr;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ==================== UTILITY CLASSES ==================== */
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .mt-1 { margin-top: var(--spacing-sm); }
    .mt-2 { margin-top: var(--spacing-md); }
    .mt-3 { margin-top: var(--spacing-lg); }
    .mb-1 { margin-bottom: var(--spacing-sm); }
    .mb-2 { margin-bottom: var(--spacing-md); }
    .mb-3 { margin-bottom: var(--spacing-lg); }
    .p-1 { padding: var(--spacing-sm); }
    .p-2 { padding: var(--spacing-md); }
    .p-3 { padding: var(--spacing-lg); }

    /* ==================== SPECIAL SECTIONS ==================== */
    .repair-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--panel-bright);
    }

    .repair-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent-iris);
      letter-spacing: -0.2px;
    }

    .repair-filters {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .filter-pill-select {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(147, 51, 234, 0.12);
      border: 1px solid rgba(147, 51, 234, 0.18);
      color: var(--accent-iris);
      font-size: 0.82rem;
      font-weight: 500;
    }

    .filter-pill-select select {
      border: none;
      background: transparent;
      color: var(--accent-iris);
      font-size: 0.82rem;
      font-weight: 600;
      outline: none;
      cursor: pointer;
    }

    .repair-kpi-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 14px;
    }

    .repair-kpi {
      background: white;
      border: none;
      border-left: 5px solid #2563eb;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .repair-kpi.red { border-left-color: #ef4444; }
    .repair-kpi.amber { border-left-color: #f59e0b; }
    .repair-kpi.green { border-left-color: #10b981; }
    .repair-kpi.blue { border-left-color: #2563eb; }

    .repair-kpi .kpi-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .repair-kpi .kpi-title {
      font-size: 0.72rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-dim);
      font-weight: 600;
    }

    .kpi-badge {
      font-size: 0.72rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.04);
      border: 1px solid rgba(15, 23, 42, 0.08);
      color: var(--text-dim);
      font-weight: 600;
    /* Grid Layouts */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-top: 24px;
    }

    .charts-grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-top: 24px;
    }

    .cards-grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-top: 24px;
    }

    /* Chart Wrapper */
    .chart-wrapper {
      width: 100%;
      min-height: 320px;
      position: relative;
    }

    /* List Items */
    .list-item {
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .list-item:last-child {
      border-bottom: none;
    }

    .list-item strong {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.95rem;
    }

    .text-muted {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    /* Header - Removed, styles moved to sidebar */

    /* Nav Section Title */
    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      padding: 0 16px 8px;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    /* Page Header */
    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    .page-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .page-subtitle {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin: 8px 0 0 0;
    }

    /* Table Container */
    .table-container {
      width: 100%;
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    .data-table th,
    .data-table td {
      padding: 16px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .data-table thead th {
      background: var(--background);
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
    }

    .data-table tbody tr:hover {
      background: rgba(59, 130, 246, 0.02);
    }

    .data-table tbody td {
      color: var(--text-primary);
    }

    /* Trend Indicators */
    .trend-up {
      color: var(--success);
      font-weight: 600;
    }

    .trend-down {
      color: var(--danger);
      font-weight: 600;
    }

    /* Content Inner */
    .content-inner {
      max-width: 1600px;
      margin: 0 auto;
    }

    /* Repair Page Specific Styles */
    #sua-chua {
      background: #f1f5f9;
      padding: 24px;
      border-radius: 8px;
    }

    #sua-chua .page-title {
      color: #7c3aed;
      font-size: 1.5rem;
      font-weight: 700;
    }

    #sua-chua .filter-select {
      background: #eff6ff;
      border: 1px solid #3b82f6;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.875rem;
      color: #1e40af;
      cursor: pointer;
      font-weight: 500;
    }

    #sua-chua .filter-select:hover {
      border-color: #2563eb;
      background: #dbeafe;
    }

    #sua-chua .kpi-card {
      background: white;
      border-radius: 12px;
      border-left-width: 4px;
      border-left-style: solid;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    #sua-chua .kpi-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #64748b;
    }

    #sua-chua .kpi-value {
      font-size: 2rem;
      font-weight: 700;
      color: #1e293b;
      margin: 8px 0;
    }

    #sua-chua .kpi-meta {
      font-size: 0.8rem;
      color: #64748b;
    }

    #sua-chua .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    #sua-chua .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e2e8f0;
    }

    #sua-chua .card-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #475569;
    }

    #sua-chua .data-table {
      font-size: 0.875rem;
    }

    #sua-chua .data-table thead th {
      background: #f8fafc;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #64748b;
      padding: 12px 16px;
      border-bottom: 2px solid #e2e8f0;
    }

    #sua-chua .data-table tbody td {
      padding: 12px 16px;
      color: #334155;
      border-bottom: 1px solid #f1f5f9;
    }

    #sua-chua .data-table tbody tr:hover {
      background: #f8fafc;
    }

    /* Responsive Adjustments */
    @media (max-width: 1280px) {
      .charts-grid,
      .cards-grid-3 {
        grid-template-columns: 1fr;
      }

      .charts-grid-3 {
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }

      .header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }

      .header-filters {
        width: 100%;
        justify-content: flex-start;
      }
    }

    @media (max-width: 1024px) {
      .main-wrapper {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }

      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0;
      }

      .header {
        border-radius: 0;
      }

      .content {
        padding: 16px;
      }

      .kpi-grid {
        grid-template-columns: 1fr;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
    }

    /* Legacy styles for backwards compatibility */
    .kpi-badge.up { color: #ef4444; background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.18); }
    .kpi-badge.down { color: #16a34a; background: rgba(22, 163, 74, 0.1); border-color: rgba(22, 163, 74, 0.18); }

    /* ==================== QU·∫¢N L√ù R·ªñNG STYLES ==================== */
    .filter-pill {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      color: var(--text-secondary);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .filter-pill span {
      font-weight: 500;
      color: var(--text-primary);
    }

    .filter-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-orange);
    }

    .kpi-card-qlr {
      background: white;
      border-radius: 12px;
      padding: 12px 12px 10px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 92px;
      transition: transform .12s ease;
      box-shadow: var(--shadow);
    }

    .kpi-card-qlr:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    .kpi-card-qlr .kpi-label {
      font-size: 0.62rem;
      text-transform: uppercase;
      color: var(--text-secondary);
      letter-spacing: 0.06em;
      display: block;
      white-space: normal;
      line-height: 1.05;
      max-height: 2.2em;
      overflow: hidden;
      word-break: break-word;
      max-width: calc(100% - 56px);
      padding-right: 8px;
    }

    .kpi-card-qlr .kpi-value {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 4px 0 2px;
      color: var(--text-primary);
    }

    .kpi-card-qlr .kpi-sub {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .kpi-card-qlr .kpi-chip {
      position: absolute;
      top: 8px;
      right: 10px;
      font-size: 0.62rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.1);
      color: #38bdf8;
      border: 1px solid rgba(56, 189, 248, 0.2);
      z-index: 3;
      pointer-events: none;
    }

    .kpi-card-qlr .kpi-chip.danger {
      background: rgba(239, 68, 68, 0.12);
      color: #ef4444;
      border-color: rgba(239, 68, 68, 0.3);
    }

    .kpi-card-qlr .kpi-chip.warning {
      background: rgba(234, 179, 8, 0.14);
      color: #eab308;
      border-color: rgba(234, 179, 8, 0.3);
    }

    .kpi-card-qlr .kpi-chip.success {
      background: rgba(34, 197, 94, 0.16);
      color: #22c55e;
      border-color: rgba(34, 197, 94, 0.3);
    }

    .meter-wrapper {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.25);
      margin-top: 4px;
    }

    .meter-fill {
      height: 100%;
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.3), #38bdf8);
      width: 72%;
    }

    .meter-fill.danger {
      background: linear-gradient(90deg, rgba(239, 68, 68, 0.3), #ef4444);
      width: 92%;
    }

    .detail-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      margin-top: 8px;
    }

    .detail-table thead {
      background: #f8fafc;
    }

    .detail-table th {
      padding: 8px 10px;
      text-align: left;
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid var(--border-color);
    }

    .detail-table td {
      padding: 8px 10px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
    }

    .detail-table tbody tr:hover {
      background: #f9fafb;
    }

    .detail-table tbody tr:last-child td {
      border-bottom: none;
    }

    .repair-kpi .kpi-number {
      margin-top: 10px;
      font-size: 1.7rem;
      font-weight: 800;
      color: var(--text-main);
    }

    .repair-kpi .kpi-subtext {
      margin-top: 2px;
      font-size: 0.78rem;
      color: var(--text-dim);
    }

    .repair-grid-3 {
      display: grid;
      grid-template-columns: 1.4fr 1fr 1fr;
      gap: 18px;
    }

    .repair-grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
    }

    .repair-card {
      background: white;
      border: none;
      border-radius: 10px;
      padding: 18px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 260px;
    }

    .heat-legend {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-dim);
      font-size: 0.82rem;
    }

    .heat-legend-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .heat-legend-gradient {
      flex: 1;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(147, 51, 234, 0.12), rgba(147, 51, 234, 0.65));
      border: 1px solid rgba(15, 23, 42, 0.08);
      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.06);
    }

    .repair-card .card-title {
      font-size: 0.9rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-weight: 700;
      color: var(--text-main);
    }

    .repair-chart {
      flex: 1;
      min-height: 260px;
    }

    .repair-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    .repair-table th,
    .repair-table td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.08);
      vertical-align: middle;
    }

    .repair-table thead th {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-dim);
      font-weight: 700;
      background: rgba(15, 23, 42, 0.02);
      border-bottom: 1px solid rgba(15, 23, 42, 0.08);
    }

    .value-red { color: #ef4444; font-weight: 700; }
    .value-amber { color: #f59e0b; font-weight: 700; }
    .value-green { color: #22c55e; font-weight: 700; }

    .heat-cell {
      text-align: center;
      font-weight: 700;
      border-radius: 8px;
      padding: 6px 8px;
      display: inline-block;
      min-width: 34px;
    }

    .status {
      display: inline-flex;
      align-items: center;
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 700;
      border: 1px solid rgba(15, 23, 42, 0.1);
    }

    .status.done { background: rgba(34, 197, 94, 0.12); color: #15803d; border-color: rgba(34, 197, 94, 0.22); }
    .status.inprogress { background: rgba(147, 51, 234, 0.12); color: #7c3aed; border-color: rgba(147, 51, 234, 0.22); }
    .status.pending { background: rgba(245, 158, 11, 0.14); color: #b45309; border-color: rgba(245, 158, 11, 0.25); }

    @media (max-width: 1200px) {
      .repair-kpi-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .repair-grid-3 { grid-template-columns: 1fr; }
      .repair-grid-2 { grid-template-columns: 1fr; }
    }

    @media (max-width: 1280px) {
      .workspace { grid-template-columns: 1fr; }
      nav.side-nav { position: static; max-height: none; }
    }

    @media (max-width: 768px) {
      body { padding: 16px; }
      header.hero { flex-direction: column; }
      .cards-two { grid-template-columns: 1fr; }
      section.page { padding: 20px; }
    }

    /* ==================== HELP MODAL ==================== */
    .help-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
    }

    .help-modal.active {
      display: flex;
    }

    .help-modal-content {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 900px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .help-modal-header {
      background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
      padding: 24px 32px;
      border-radius: 16px 16px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .help-modal-title {
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .help-modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .help-modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    .help-modal-body {
      padding: 32px;
    }

    .help-section {
      margin-bottom: 32px;
    }

    .help-section:last-child {
      margin-bottom: 0;
    }

    .help-section-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e2e8f0;
    }

    .help-section-title .icon {
      font-size: 1.4rem;
    }

    .help-subsection {
      margin-bottom: 20px;
    }

    .help-subsection-title {
      font-size: 1.05rem;
      font-weight: 600;
      color: #475569;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .help-page-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .help-page-item {
      padding: 12px 16px;
      margin-bottom: 8px;
      background: #f8fafc;
      border-radius: 8px;
      border-left: 4px solid #3b82f6;
    }

    .help-page-name {
      font-weight: 600;
      color: #1e293b;
      display: block;
      margin-bottom: 4px;
    }

    .help-page-desc {
      color: #64748b;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .help-tips {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 16px;
      border-radius: 8px;
      margin-top: 12px;
    }

    .help-tips-title {
      font-weight: 700;
      color: #92400e;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .help-tips-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .help-tips-list li {
      color: #78350f;
      padding: 6px 0;
      padding-left: 20px;
      position: relative;
    }

    .help-tips-list li:before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      color: #f59e0b;
      font-weight: 700;
    }

    .help-questions {
      background: #f0fdf4;
      border-left: 4px solid #10b981;
      padding: 16px;
      border-radius: 8px;
      margin-top: 12px;
    }

    .help-questions-title {
      font-weight: 700;
      color: #065f46;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .help-questions-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .help-questions-list li {
      color: #064e3b;
      padding: 6px 0;
      padding-left: 20px;
      position: relative;
      font-weight: 500;
    }

    .help-questions-list li:before {
      content: "?";
      position: absolute;
      left: 0;
      color: #10b981;
      font-weight: 700;
      width: 18px;
      height: 18px;
      background: #d1fae5;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .help-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .help-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Main Wrapper -->
    <div class="main-wrapper">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <img src="assets/t·∫£i xu·ªëng.png" alt="Logo" class="sidebar-logo-img" />
          <div class="sidebar-brand">
            <div class="sidebar-subtitle">B√°o c√°o</div>
            <div class="sidebar-title">Kinh doanh v·∫≠n h√†nh</div>
          </div>
        </div>

        <nav class="nav-section">
          <div class="nav-section-title">TR·ª¢ GI√öP</div>
          <div class="nav-item" data-page="huong-dan">
            <span class="nav-icon">‚ùì</span>
            <span>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</span>
          </div>
        </nav>

        <nav class="nav-section">
          <div class="nav-section-title">T·ªîNG QUAN</div>
          <div class="nav-item active" data-page="overview">
            <span class="nav-icon">üìä</span>
            <span>T·ªïng quan</span>
          </div>
        </nav>

        <nav class="nav-section">
          <div class="nav-section-title">HI·ªÜU QU·∫¢ KINH DOANH</div>
          <div class="nav-item" data-page="khai-thac">
            <span class="nav-icon">‚öì</span>
            <span>Khai th√°c</span>
          </div>
          <div class="nav-item" data-page="thuong-vu">
            <span class="nav-icon">üíº</span>
            <span>Kinh doanh th∆∞∆°ng v·ª•</span>
          </div>
          <div class="nav-item" data-page="mnr">
            <span class="nav-icon">üîß</span>
            <span>MnR</span>
          </div>
          <div class="nav-item" data-page="kho-bai">
            <span class="nav-icon">üì¶</span>
            <span>Kho b√£i</span>
          </div>
        </nav>

        <nav class="nav-section">
          <div class="nav-section-title">V·∫¨N H√ÄNH</div>
          <div class="nav-item" data-page="xnt">
            <span class="nav-icon">üìã</span>
            <span>Xu·∫•t - Nh·∫≠p - T·ªìn</span>
          </div>
          <div class="nav-item" data-page="quanly-rong">
            <span class="nav-icon">üì¶</span>
            <span>Qu·∫£n l√Ω r·ªóng</span>
          </div>
          <div class="nav-item" data-page="sua-chua">
            <span class="nav-icon">üõ†Ô∏è</span>
            <span>S·ª≠a ch·ªØa thi·∫øt b·ªã</span>
          </div>
        </nav>

        <nav class="nav-section">
          <div class="nav-section-title">KH√ÅCH H√ÄNG</div>
          <div class="nav-item" data-page="khach-hang">
            <span class="nav-icon">üë•</span>
            <span>Qu·∫£n l√Ω kh√°ch h√†ng</span>
          </div>
        </nav>

        <div class="sidebar-footer">
          <div class="sidebar-update" id="navTimestamp">
            C·∫≠p nh·∫≠t:<br>06/01/2026 - 08:30
          </div>
        </div>
      </aside>

      <!-- Content Area -->
      <main class="content">
        <div class="content-inner">
          
          <!-- PAGE: T·ªîNG QUAN -->
          <section class="page active" id="overview" style="background: #f8fafc;">
            <div class="page-header">
              <div>
                <h2 class="page-title">üìä T·ªïng Quan Kinh Doanh</h2>
                <p class="page-subtitle">Hi·ªáu qu·∫£ ho·∫°t ƒë·ªông v√† c√°c ch·ªâ s·ªë ch√≠nh</p>
              </div>
              <div style="display: flex; gap: 12px; align-items: center;">
                <select id="ovFilterMonth" class="filter-select" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0; background: white; cursor: pointer;">
                  <option value="2026-01">Th√°ng 1/2026</option>
                  <option value="2025-12">Th√°ng 12/2025</option>
                  <option value="2025-11">Th√°ng 11/2025</option>
                  <option value="2025-10">Th√°ng 10/2025</option>
                </select>
              </div>
            </div>

            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr 1fr 1fr; gap: 16px; margin-bottom: 24px;">
              <!-- Doanh thu so v·ªõi m·ª•c ti√™u -->
              <div class="card" style="background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border: 2px solid #e2e8f0;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #475569; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Doanh thu vs M·ª•c ti√™u</div>
                  <div id="ov-chart-gauge" style="height: 140px; margin: -10px;"></div>
                  <div style="text-align: center; margin-top: -5px;">
                    <div id="ovKpiRevenueValue" style="font-size: 1.5rem; font-weight: 700; color: #1e293b;">289 t·ª∑</div>
                    <div id="ovKpiRevenueTarget" style="color: #64748b; font-size: 0.75rem; margin-top: 2px;">M·ª•c ti√™u: 280 t·ª∑</div>
                  </div>
                </div>
              </div>

              <!-- L·ª£i nhu·∫≠n -->
              <div class="card" style="background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); border-left: 4px solid #10b981;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #64748b; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">L·ª£i nhu·∫≠n</div>
                  <div id="ovKpiProfit" style="font-size: 1.8rem; font-weight: 700; color: #10b981; margin-bottom: 4px;">89 t·ª∑</div>
                  <div style="color: #64748b; font-size: 0.7rem; margin-bottom: 4px;">Bi√™n LN: <span id="ovKpiMargin" style="font-weight: 600; color: #10b981;">30.8%</span></div>
                  <div class="kpi-meta">
                    <span id="ovKpiProfitTrend" style="color: #10b981; font-size: 0.7rem; font-weight: 600;">‚Üë +12.5%</span>
                    <span style="color: #64748b; font-size: 0.65rem;"> vs th√°ng tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>

              <!-- T·ªïng doanh thu -->
              <div class="card" style="background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%); border-left: 4px solid #3b82f6;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #64748b; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">T·ªïng doanh thu</div>
                  <div id="ovKpiRevenue" style="font-size: 1.8rem; font-weight: 700; color: #3b82f6; margin-bottom: 4px;">289 t·ª∑</div>
                  <div class="kpi-meta">
                    <span id="ovKpiRevenueTrend" style="color: #10b981; font-size: 0.7rem; font-weight: 600;">‚Üë +15.2%</span>
                    <span style="color: #64748b; font-size: 0.65rem;"> vs nƒÉm tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>

              <!-- T·ªïng chi ph√≠ -->
              <div class="card" style="background: linear-gradient(135deg, #fff7ed 0%, #ffffff 100%); border-left: 4px solid #f97316;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #64748b; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">T·ªïng chi ph√≠</div>
                  <div id="ovKpiCost" style="font-size: 1.8rem; font-weight: 700; color: #f97316; margin-bottom: 4px;">200 t·ª∑</div>
                  <div class="kpi-meta">
                    <span id="ovKpiCostTrend" style="color: #ef4444; font-size: 0.7rem; font-weight: 600;">‚Üë +8.5%</span>
                    <span style="color: #64748b; font-size: 0.65rem;"> vs th√°ng tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>

              <!-- T·ªïng s·ªë KH -->
              <div class="card" style="background: linear-gradient(135deg, #faf5ff 0%, #ffffff 100%); border-left: 4px solid #8b5cf6;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #64748b; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">T·ªïng s·ªë KH</div>
                  <div id="ovKpiCustomers" style="font-size: 1.8rem; font-weight: 700; color: #8b5cf6; margin-bottom: 4px;">1,245</div>
                  <div style="color: #64748b; font-size: 0.7rem; margin-bottom: 2px;">KH m·ªõi: <span id="ovKpiNewCustomers" style="font-weight: 600; color: #8b5cf6;">+32</span></div>
                  <div style="color: #64748b; font-size: 0.7rem;">KH trung th√†nh: <span id="ovKpiLoyalCustomers" style="font-weight: 600; color: #10b981;">892</span></div>
                </div>
              </div>
            </div>

            <!-- T·ªïng quan Section -->
            <div class="card" style="margin-bottom: 24px; background: #f8fafc;">
              <div class="card-header" style="background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border-bottom: 2px solid #e2e8f0;">
                <div class="card-title" style="font-size: 1.1rem; color: #1e293b;">üìà T·ªîNG QUAN</div>
              </div>
              
              <!-- Row 1: Funnel, Doanh thu/L·ª£i nhu·∫≠n/Chi ph√≠ & L·ª£i nhu·∫≠n theo m·∫£ng -->
              <div style="display: grid; grid-template-columns: 0.8fr 1.2fr 1fr; gap: 20px; padding: 20px; background: #f8fafc;">
                <div class="card">
                  <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Ph·ªÖu l·ª£i nhu·∫≠n</div>
                  <div id="ov-chart-profit-funnel" style="height: 300px;"></div>
                </div>
                <div class="card">
                  <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Doanh thu / L·ª£i nhu·∫≠n / Chi ph√≠ theo th·ªùi gian</div>
                  <div id="ov-chart-revenue-trend" style="height: 300px;"></div>
                </div>
                <div class="card">
                  <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">L·ª£i nhu·∫≠n theo m·∫£ng kinh doanh</div>
                  <div id="ov-chart-profit-by-segment" style="height: 300px;"></div>
                </div>
              </div>

              <!-- Row 2: 3 bi·ªÉu ƒë·ªì 1 h√†ng ngang -->
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; padding: 0 20px 20px 20px; background: #f8fafc;">
                <div class="card">
                  <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Ph√¢n b·ªï doanh thu theo m·∫£ng</div>
                  <div id="ov-chart-revenue-pie" style="height: 280px;"></div>
                </div>
                <div class="card">
                  <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">C∆° c·∫•u chi ph√≠</div>
                  <div id="ov-chart-cost-structure" style="height: 280px;"></div>
                </div>
                <div class="card">
                  <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Top 10 kh√°ch h√†ng</div>
                  <div id="ov-chart-top-customers" style="height: 280px;"></div>
                </div>
              </div>

              <!-- Row 3: B·∫£ng chi ti·∫øt (moved from bottom) -->
              <div style="padding: 0 20px 20px 20px; background: #f8fafc;">
                <div class="card">
                  <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Chi ti·∫øt d·ªãch v·ª•</div>
                  <div class="table-container">
                    <table class="data-table" id="ovTableDetail">
                    <thead>
                      <tr>
                        <th style="text-align: left;">M·∫£ng d·ªãch v·ª•</th>
                        <th style="text-align: right;">Doanh thu (t·ª∑)</th>
                        <th style="text-align: right;">Chi ph√≠ (t·ª∑)</th>
                        <th style="text-align: right;">L·ª£i nhu·∫≠n (t·ª∑)</th>
                        <th style="text-align: right;">T·ª∑ su·∫•t LN (%)</th>
                        <th style="text-align: right;">T·ª∑ tr·ªçng DT (%)</th>
                        <th style="text-align: right;">% COG</th>
                        <th style="text-align: right;">TƒÉng vs k·ª≥ tr∆∞·ªõc</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- B·∫£ng chi ti·∫øt d·ªãch v·ª• -->
            <div class="card" style="display: none;">
              <div class="card-header" style="background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border-bottom: 2px solid #e2e8f0;">
                <div class="card-title" style="font-size: 1.1rem; color: #1e293b;">üìã B·∫¢NG CHI TI·∫æT D·ªäCH V·ª§</div>
              </div>
              <div class="card-body">
                <div class="table-container">
                  <table class="data-table" id="ovTableDetailOld">
                    <thead>
                      <tr>
                        <th style="text-align: left;">M·∫£ng d·ªãch v·ª•</th>
                        <th style="text-align: right;">Doanh thu (t·ª∑)</th>
                        <th style="text-align: right;">Chi ph√≠ (t·ª∑)</th>
                        <th style="text-align: right;">L·ª£i nhu·∫≠n (t·ª∑)</th>
                        <th style="text-align: right;">% COG</th>
                        <th style="text-align: right;">TƒÉng vs k·ª≥ tr∆∞·ªõc</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </section>

          <!-- PAGE: KHAI TH√ÅC -->
          <section class="page" id="khai-thac">
            <div class="page-header">
              <div>
                <h2 class="page-title">‚öì Khai Th√°c</h2>
                <p class="page-subtitle">T·∫£i tr·ªçng & tuy·∫øn t√†u</p>
              </div>
              <div style="display: flex; gap: 12px;">
                <select class="filter-select" id="ktFilterMonth" aria-label="Th√°ng">
                  <option value="2026-01">Th√°ng 01/2026</option>
                  <option value="2025-12">Th√°ng 12/2025</option>
                  <option value="2025-11">Th√°ng 11/2025</option>
                  <option value="2025-10">Th√°ng 10/2025</option>
                </select>
              </div>
            </div>

            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px;">
              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%); border-left: 4px solid #3b82f6;">
                <div class="card-body" style="padding: 6px 10px;">
                  <div style="color: #64748b; font-size: 0.65rem; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">DOANH THU</div>
                  <div id="ktKpiRevenue" style="font-size: 1.25rem; font-weight: 700; color: #3b82f6; margin-bottom: 0px; line-height: 1.1;">156.8 t·ª∑</div>
                  <div class="kpi-meta" style="margin-top: 1px;">
                    <span id="ktKpiRevenueTrend" style="color: #10b981; font-size: 0.65rem; font-weight: 600;">‚Üë +8.2%</span>
                    <span style="color: #64748b; font-size: 0.6rem; margin-left: 2px;">vs. k·ª≥ tr∆∞·ªõc</span>
                  </div>
                  <div style="margin-top: 2px;">
                    <span id="ktKpiRevenueKpi" style="color: #10b981; font-size: 0.65rem; font-weight: 600;">‚úì 102.5%</span>
                    <span style="color: #64748b; font-size: 0.6rem; margin-left: 2px;">ƒë·∫°t KPI</span>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); border-left: 4px solid #10b981;">
                <div class="card-body" style="padding: 6px 10px;">
                  <div style="color: #64748b; font-size: 0.65rem; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">L·ª¢I NHU·∫¨N</div>
                  <div id="ktKpiProfit" style="font-size: 1.25rem; font-weight: 700; color: #10b981; margin-bottom: 0px; line-height: 1.1;">41.6 t·ª∑</div>
                  <div class="kpi-meta" style="margin-top: 1px;">
                    <span id="ktKpiProfitTrend" style="color: #10b981; font-size: 0.65rem; font-weight: 600;">‚Üë +14.8%</span>
                    <span style="color: #64748b; font-size: 0.6rem; margin-left: 2px;">vs. k·ª≥ tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #fff7ed 0%, #ffffff 100%); border-left: 4px solid #f97316;">
                <div class="card-body" style="padding: 6px 10px;">
                  <div style="color: #64748b; font-size: 0.65rem; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">CHI PH√ç</div>
                  <div id="ktKpiCost" style="font-size: 1.25rem; font-weight: 700; color: #f97316; margin-bottom: 0px; line-height: 1.1;">115.2 t·ª∑</div>
                  <div class="kpi-meta" style="margin-top: 1px;">
                    <span id="ktKpiCostTrend" style="color: #ef4444; font-size: 0.65rem; font-weight: 600;">‚Üë +5.3%</span>
                    <span style="color: #64748b; font-size: 0.6rem; margin-left: 2px;">vs. k·ª≥ tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%); border-left: 4px solid #ef4444;">
                <div class="card-body" style="padding: 6px 10px;">
                  <div style="color: #64748b; font-size: 0.65rem; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">S·∫¢N L∆Ø·ª¢NG H√ÄNG R·ªúI</div>
                  <div id="ktKpiBulk" style="font-size: 1.25rem; font-weight: 700; color: #ef4444; margin-bottom: 0px; line-height: 1.1;">428,500 t·∫•n</div>
                  <div class="kpi-meta" style="margin-top: 1px;">
                    <span id="ktKpiBulkTrend" style="color: #10b981; font-size: 0.65rem; font-weight: 600;">‚Üë +8.4%</span>
                    <span style="color: #64748b; font-size: 0.6rem; margin-left: 2px;">vs. k·ª≥ tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #ede9fe 0%, #ffffff 100%); border-left: 4px solid #8b5cf6;">
                <div class="card-body" style="padding: 6px 10px;">
                  <div style="color: #64748b; font-size: 0.65rem; font-weight: 600; margin-bottom: 2px; text-transform: uppercase;">S·∫¢N L∆Ø·ª¢NG S√Ä LAN</div>
                  <div id="ktKpiBarge" style="font-size: 1.25rem; font-weight: 700; color: #8b5cf6; margin-bottom: 0px; line-height: 1.1;">12,340 TEU</div>
                  <div class="kpi-meta" style="margin-top: 1px;">
                    <span id="ktKpiBargeTrend" style="color: #10b981; font-size: 0.65rem; font-weight: 600;">‚Üë +6.6%</span>
                    <span style="color: #64748b; font-size: 0.6rem; margin-left: 2px;">vs. k·ª≥ tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts Row 1: T·ªïng quan -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üìä T·ªîNG QUAN</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU - CHI PH√ç - L·ª¢I NHU·∫¨N</div>
                </div>
                <div class="chart-wrapper" id="chart-kt-finance" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">C∆† C·∫§U CHI PH√ç</div>
                  <div class="card-subtitle">So v·ªõi k·ª≥ tr∆∞·ªõc</div>
                </div>
                <div class="chart-wrapper" id="chart-kt-cost-structure" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU THEO LO·∫†I H√ÄNG</div>
                  <div class="card-subtitle">T·ª∑ l·ªá ƒë·∫°t KPI</div>
                </div>
                <div class="chart-wrapper" id="chart-kt-revenue-type" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- Chi ti·∫øt H√†ng r·ªùi -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üì¶ CHI TI·∫æT H√ÄNG R·ªúI</h3>
            </div>
            <div style="display: flex; gap: 20px; margin-bottom: 24px;">
              <div class="card" style="flex: 1; border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">T·ª∂ TR·ªåNG DOANH THU THEO NH√ìM H√ÄNG H√ìA</div>
                </div>
                <div class="chart-wrapper" id="chart-kt-bulk-revenue" style="height: 340px; padding: 16px;"></div>
              </div>
              <div class="card" style="flex: 1.5; border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">CHI TI·∫æT NH√ìM H√ÄNG H√ìA</div>
                </div>
                <div class="card-body">
                  <div class="table-container" style="overflow: auto; max-height: 340px;">
                    <table class="data-table" id="ktTableBulk" style="width: 100%;">
                      <thead>
                        <tr>
                          <th>NH√ìM H√ÄNG H√ìA</th>
                          <th>DOANH THU (TRI·ªÜU)</th>
                          <th>S·∫¢N L∆Ø·ª¢NG (T·∫§N)</th>
                          <th>% DOANH THU</th>
                          <th>% S·∫¢N L∆Ø·ª¢NG</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Chi ti·∫øt S√† lan -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üö¢ CHI TI·∫æT S√Ä LAN</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">S·∫¢N L∆Ø·ª¢NG THEO LO·∫†I S√Ä LAN</div>
                </div>
                <div class="chart-wrapper" id="chart-kt-barge-type" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">S·∫¢N L∆Ø·ª¢NG CONTAINER THEO SIZE</div>
                </div>
                <div class="card-body">
                  <div class="table-container" style="overflow: auto; max-height: 320px;">
                    <table class="data-table" id="ktTableContainer" style="width: 100%;">
                      <thead>
                        <tr>
                          <th>LO·∫†I</th>
                          <th>SIZE 20'</th>
                          <th>SIZE 40'</th>
                          <th>T·ªîNG (TEU)</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">TOP 10 KH√ÅCH H√ÄNG</div>
                  <div class="card-subtitle">Xu·∫•t nhi·ªÅu nh·∫•t</div>
                </div>
                <div class="chart-wrapper" id="chart-kt-top-customers" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- B·∫£ng chi ti·∫øt hi·ªáu qu·∫£ ho·∫°t ƒë·ªông -->
            <div style="margin-bottom: 16px; margin-top: 24px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üìã CHI TI·∫æT HI·ªÜU QU·∫¢ HO·∫†T ƒê·ªòNG</h3>
            </div>
            <div class="card" style="border: 1px solid #e2e8f0; margin-bottom: 24px;">
              <div class="card-header" style="background: #fafafa;">
                <div class="card-title">B·∫¢NG K√ä CHI TI·∫æT THEO M√É KHAI TH√ÅC</div>
              </div>
              <div class="card-body">
                <div class="table-container" style="overflow: auto; max-height: 400px;">
                  <table class="data-table" id="ktTableDetail" style="width: 100%;">
                    <thead>
                      <tr>
                        <th>M√É KHAI TH√ÅC</th>
                        <th>CHI PH√ç (TRI·ªÜU)</th>
                        <th>DOANH THU (TRI·ªÜU)</th>
                        <th>L·ª¢I NHU·∫¨N (TRI·ªÜU)</th>
                        <th>T·ª∂ SU·∫§T L·ª¢I NHU·∫¨N</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </section>

          <!-- PAGE: KINH DOANH TH∆Ø∆†NG V·ª§ -->
          <section class="page" id="thuong-vu">
            <div class="page-header">
              <div>
                <h2 class="page-title">üíº Kinh doanh th∆∞∆°ng v·ª•</h2>
                <p class="page-subtitle">D·ªãch v·ª• container & trucking</p>
              </div>
              <select class="filter-select" id="tvFilterMonth" aria-label="Th√°ng">
                <option value="2026-01">Th√°ng 01/2026</option>
                <option value="2025-12">Th√°ng 12/2025</option>
                <option value="2025-11">Th√°ng 11/2025</option>
                <option value="2025-10">Th√°ng 10/2025</option>
              </select>
            </div>

            <!-- T·ªïng quan -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üìä T·ªîNG QUAN</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU - CHI PH√ç - L·ª¢I NHU·∫¨N</div>
                </div>
                <div class="chart-wrapper" id="chart-tv-finance" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU THEO LO·∫†I H√ÄNG</div>
                  <div class="card-subtitle">T·ª∑ l·ªá ƒë·∫°t KPI</div>
                </div>
                <div class="chart-wrapper" id="chart-tv-revenue-type" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- Chi ti·∫øt th∆∞∆°ng v·ª• -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üì¶ CHI TI·∫æT TH∆Ø∆†NG V·ª§</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa; display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div class="card-title">HEATMAP THEO LO·∫†I D·ªäCH V·ª§ & SIZE</div>
                  </div>
                  <div style="display: flex; gap: 8px;">
                    <button class="filter-select" id="tvBtnHeatmapVolume" style="padding: 4px 12px; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 4px; font-size: 0.85rem;">S·∫£n l∆∞·ª£ng</button>
                    <button class="filter-select" id="tvBtnHeatmapRevenue" style="padding: 4px 12px; cursor: pointer; background: #e2e8f0; color: #64748b; border: none; border-radius: 4px; font-size: 0.85rem;">Doanh thu</button>
                  </div>
                </div>
                <div class="chart-wrapper" id="chart-tv-heatmap" style="height: 420px; padding: 16px;"></div>
              </div>

              <!-- B·∫£ng k√™ chi ti·∫øt theo lo·∫°i h√†ng -->
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">B·∫¢NG K√ä CHI TI·∫æT THEO LO·∫†I H√ÄNG</div>
                </div>
                <div class="card-body">
                  <div class="table-container">
                    <table class="data-table" id="tvTableService">
                      <thead>
                        <tr>
                          <th>Lo·∫°i d·ªãch v·ª•</th>
                          <th>S·∫£n l∆∞·ª£ng</th>
                          <th>Doanh thu (tri·ªáu)</th>
                          <th>ƒê∆°n gi√° (tri·ªáu/cont)</th>
                          <th>% Doanh thu</th>
                          <th>% S·∫£n l∆∞·ª£ng</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Chi ti·∫øt Trucking -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üöö CHI TI·∫æT TRUCKING</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">T·ª∂ TR·ªåNG DOANH THU XE N·ªòI B·ªò - THU√ä NGO√ÄI</div>
                </div>
                <div class="chart-wrapper" id="chart-tv-truck-pie" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">B·∫¢NG CHI TI·∫æT TRUCKING</div>
                  <div class="card-subtitle">Ch√™nh l·ªách k·ª≥ tr∆∞·ªõc</div>
                </div>
                <div class="card-body">
                  <div class="table-container">
                    <table class="data-table" id="tvTableTruck">
                      <thead>
                        <tr>
                          <th>Bi·ªÉn s·ªë xe</th>
                          <th>S·∫£n l∆∞·ª£ng</th>
                          <th>ƒê·ªïi chi·∫øu SL</th>
                          <th>Doanh thu (tri·ªáu)</th>
                          <th>ƒê·ªïi chi·∫øu DT</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- PAGE: MNR -->
          <section class="page" id="mnr">
            <div class="page-header">
              <div>
                <h2 class="page-title">üîß MnR (Maintain & Repair)</h2>
                <p class="page-subtitle">S·ª≠a ch·ªØa & b·∫£o tr√¨ container</p>
              </div>
              <div style="display: flex; gap: 12px; align-items: center;">
                <select id="mnrFilterMonth" class="filter-select" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0; background: white; cursor: pointer;">
                  <option value="2026-01">Th√°ng 1/2026</option>
                  <option value="2025-12">Th√°ng 12/2025</option>
                  <option value="2025-11">Th√°ng 11/2025</option>
                  <option value="2025-10">Th√°ng 10/2025</option>
                </select>
              </div>
            </div>

            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 24px;">
              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">Doanh thu</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b;" id="mnrRevenueValue">45.8 t·ª∑</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;" id="mnrRevenueTrend">‚Üë 5.2%</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">Chi ph√≠</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b;" id="mnrCostValue">32.4 t·ª∑</div>
                  <div style="font-size: 0.8rem; color: #ef4444; font-weight: 600;" id="mnrCostTrend">‚Üë 3.8%</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">L·ª£i nhu·∫≠n</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b;" id="mnrProfitValue">13.4 t·ª∑</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;" id="mnrProfitTrend">‚Üë 8.9%</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">Doanh thu so v·ªõi KPI</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #10b981;" id="mnrKpiValue">105.3%</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;">‚úì ƒê·∫°t KPI</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">T·ªïng cont nh·∫≠p</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b;" id="mnrContValue">3,245</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;" id="mnrContTrend">‚Üë 7.1%</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">T·ª∑ l·ªá ƒë√£ s·ª≠a</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #10b981;" id="mnrRepairRateValue">87.6%</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;" id="mnrRepairRateTrend">‚Üë 2.3%</div>
                </div>
              </div>
            </div>

            <!-- T·ªïng quan -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üìä T·ªîNG QUAN</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU - CHI PH√ç - L·ª¢I NHU·∫¨N</div>
                </div>
                <div class="chart-wrapper" id="chart-mnr-finance" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">C∆† C·∫§U CHI PH√ç</div>
                  <div class="card-subtitle">V·∫≠t t∆∞, nh√¢n c√¥ng, kh√°c</div>
                </div>
                <div class="chart-wrapper" id="chart-mnr-cost-structure" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU THEO LO·∫†I H√ÄNG (SIZE CONT)</div>
                  <div class="card-subtitle">T·ª∑ l·ªá ƒë·∫°t KPI</div>
                </div>
                <div class="chart-wrapper" id="chart-mnr-revenue-type" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- Chi ti·∫øt s·∫£n l∆∞·ª£ng -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üîß CHI TI·∫æT S·∫¢N L∆Ø·ª¢NG</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">T·ª∂ TR·ªåNG TR·∫†NG TH√ÅI S·ª¨A CH·ªÆA</div>
                </div>
                <div class="chart-wrapper" id="chart-mnr-status-pie" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">S·ªê L∆Ø·ª¢NG NH·∫¨P THEO TH·ªúI GIAN</div>
                  <div class="card-subtitle">T·ª∑ l·ªá t·ªìn ch∆∞a s·ª≠a</div>
                </div>
                <div class="chart-wrapper" id="chart-mnr-input-trend" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">TOP KH√ÅCH H√ÄNG S·ª¨A NHI·ªÄU</div>
                  <div class="card-subtitle">Theo s·ªë l∆∞·ª£ng cont</div>
                </div>
                <div class="chart-wrapper" id="chart-mnr-top-customers" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- B·∫£ng k√™ chi ti·∫øt -->
            <div class="card" style="margin-bottom: 24px;">
              <div class="card-header" style="background: #fafafa;">
                <div class="card-title">B·∫¢NG K√ä CHI TI·∫æT THEO M√É CONT</div>
              </div>
              <div class="card-body">
                <div class="table-container">
                  <table class="data-table" id="mnrTableDetail">
                    <thead>
                      <tr>
                        <th>M√£ cont</th>
                        <th>Doanh thu (tri·ªáu)</th>
                        <th>S·∫£n l∆∞·ª£ng (cont)</th>
                        <th>% Doanh thu</th>
                        <th>% S·∫£n l∆∞·ª£ng</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </section>

          <!-- PAGE: KHO B√ÉI -->
          <section class="page" id="kho-bai">
            <div class="page-header">
              <div>
                <h2 class="page-title">üì¶ Kho B√£i</h2>
                <p class="page-subtitle">Cho thu√™ kho, b√£i & nh√† x∆∞·ªüng</p>
              </div>
              <div style="display: flex; gap: 12px; align-items: center;">
                <select id="kbFilterMonth" class="filter-select" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0; background: white; cursor: pointer;">
                  <option value="2026-01">Th√°ng 1/2026</option>
                  <option value="2025-12">Th√°ng 12/2025</option>
                  <option value="2025-11">Th√°ng 11/2025</option>
                  <option value="2025-10">Th√°ng 10/2025</option>
                </select>
              </div>
            </div>

            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 24px;">
              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">Doanh thu</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b;" id="kbRevenueValue">28.5 t·ª∑</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;" id="kbRevenueTrend">‚Üë 4.2%</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">Chi ph√≠</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b;" id="kbCostValue">18.6 t·ª∑</div>
                  <div style="font-size: 0.8rem; color: #ef4444; font-weight: 600;" id="kbCostTrend">‚Üë 2.8%</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">L·ª£i nhu·∫≠n</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #1e293b;" id="kbProfitValue">9.9 t·ª∑</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;" id="kbProfitTrend">‚Üë 6.8%</div>
                </div>
              </div>

              <div class="card" style="padding: 6px 10px; border: 1px solid #e2e8f0;">
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 2px;">Doanh thu so v·ªõi KPI</div>
                <div style="display: flex; align-items: baseline; justify-content: space-between; gap: 8px;">
                  <div style="font-size: 1.25rem; font-weight: 700; color: #10b981;" id="kbKpiValue">108.2%</div>
                  <div style="font-size: 0.8rem; color: #10b981; font-weight: 600;">‚úì ƒê·∫°t KPI</div>
                </div>
              </div>
            </div>

            <!-- T·ªïng quan -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üìä T·ªîNG QUAN</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU - CHI PH√ç - L·ª¢I NHU·∫¨N</div>
                </div>
                <div class="chart-wrapper" id="chart-kb-finance" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">C∆† C·∫§U CHI PH√ç</div>
                  <div class="card-subtitle">Nh√¢n c√¥ng, v·∫≠t t∆∞, kh√°c</div>
                </div>
                <div class="chart-wrapper" id="chart-kb-cost-structure" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU THEO LO·∫†I D·ªäCH V·ª§</div>
                  <div class="card-subtitle">T·ª∑ l·ªá ƒë·∫°t KPI</div>
                </div>
                <div class="chart-wrapper" id="chart-kb-revenue-service" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- Chi ti·∫øt doanh thu -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 16px;">üíº CHI TI·∫æT DOANH THU</h3>
            </div>
            <div class="charts-grid" style="gap: 20px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">DOANH THU THEO KH√ÅCH H√ÄNG</div>
                  <div class="card-subtitle">So v·ªõi KPI</div>
                </div>
                <div class="chart-wrapper" id="chart-kb-customer-revenue" style="height: 320px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">HEATMAP DOANH THU D·ªäCH V·ª§ √ó KH√ÅCH H√ÄNG</div>
                </div>
                <div class="chart-wrapper" id="chart-kb-heatmap" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- B·∫£ng k√™ chi ti·∫øt -->
            <div class="card" style="margin-bottom: 24px;">
              <div class="card-header" style="background: #fafafa;">
                <div class="card-title">B·∫¢NG K√ä CHI TI·∫æT DOANH THU KHO</div>
              </div>
              <div class="card-body">
                <div class="table-container">
                  <table class="data-table" id="kbTableDetail">
                    <thead>
                      <tr>
                        <th>Lo·∫°i d·ªãch v·ª•</th>
                        <th>Doanh thu (tri·ªáu)</th>
                        <th>L·ª£i nhu·∫≠n (tri·ªáu)</th>
                        <th>% Doanh thu</th>
                        <th>% L·ª£i su·∫•t</th>
                        <th>ƒê∆°n gi√° (k/m¬≤/th√°ng)</th>
                        <th>Di·ªán t√≠ch (m¬≤)</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </section>

          <!-- PAGE: QU·∫¢N L√ù R·ªñNG -->
          <section class="page" id="quanly-rong">
            <div class="page-header">
              <div>
                <h2 class="page-title">üì¶ Qu·∫£n L√Ω R·ªóng</h2>
                <p class="page-subtitle">Theo d√µi nh·∫≠p/xu·∫•t/t·ªìn container r·ªóng theo th·ªùi gian th·ª±c</p>
              </div>
              <div class="header-filters">
                <select class="filter-select" id="qlrFilterMonth" aria-label="Th√°ng">
                  <option value="2026-01">Th√°ng 01/2026</option>
                  <option value="2025-12">Th√°ng 12/2025</option>
                  <option value="2025-11">Th√°ng 11/2025</option>
                  <option value="2025-10">Th√°ng 10/2025</option>
                </select>
              </div>
            </div>

            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%); border-left: 4px solid #3b82f6;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">T·ªîNG NH·∫¨P</div>
                  <div id="qlrKpiImport" style="font-size: 1.8rem; font-weight: 700; color: #3b82f6; margin-bottom: 4px;">2,845 cont</div>
                  <div class="kpi-meta">
                    <div id="qlrKpiImportTrend" style="color: #10b981; font-size: 0.85rem; font-weight: 600;">‚Üë 8.5% vs th√°ng tr∆∞·ªõc</div>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%); border-left: 4px solid #ef4444;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">T·ªîNG XU·∫§T</div>
                  <div id="qlrKpiExport" style="font-size: 1.8rem; font-weight: 700; color: #ef4444; margin-bottom: 4px;">2,612 cont</div>
                  <div class="kpi-meta">
                    <div id="qlrKpiExportTrend" style="color: #ef4444; font-size: 0.85rem; font-weight: 600;">‚Üì 3.2% vs th√°ng tr∆∞·ªõc</div>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #fef3c7 0%, #ffffff 100%); border-left: 4px solid #f59e0b;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">T·ªíN B√ÉI</div>
                  <div id="qlrKpiStock" style="font-size: 1.8rem; font-weight: 700; color: #f59e0b; margin-bottom: 4px;">4,320 cont</div>
                  <div class="kpi-meta">
                    <div id="qlrKpiStockTrend" style="color: #f59e0b; font-size: 0.85rem; font-weight: 600;">‚Üë 5.4% vs th√°ng tr∆∞·ªõc</div>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); border-left: 4px solid #10b981;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">% C√îNG SU·∫§T B√ÉI</div>
                  <div id="qlrKpiCapacity" style="font-size: 1.8rem; font-weight: 700; color: #10b981; margin-bottom: 4px;">76.2%</div>
                  <div class="kpi-meta">
                    <div style="color: #64748b; font-size: 0.8rem;">Ng∆∞·ª°ng an to√†n: &lt; 85%</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section: T·ªïng quan -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; padding-left: 4px; border-left: 4px solid var(--accent-blue);">
                üìä T·ªïng quan
              </h3>

              <div style="display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 16px;">
                <!-- Nh·∫≠p/T·ªìn/Xu·∫•t theo th·ªùi gian -->
                <div class="card">
                  <div class="card-header">
                    <div>
                      <h3 class="card-title">Nh·∫≠p / T·ªìn / Xu·∫•t r·ªóng theo th·ªùi gian</h3>
                      <p class="card-subtitle">Xu h∆∞·ªõng 7 th√°ng g·∫ßn nh·∫•t</p>
                    </div>
                  </div>
                  <div class="card-body">
                    <div id="qlr-chart-time-trend" style="width:100%;height:360px;"></div>
                  </div>
                </div>

                <!-- Bar chart theo size -->
                <div class="card">
                  <div class="card-header">
                    <div>
                      <h3 class="card-title">Nh·∫≠p / Xu·∫•t theo size</h3>
                      <p class="card-subtitle">Ph√¢n b·ªï 20HC & 40HC</p>
                    </div>
                  </div>
                  <div class="card-body">
                    <div id="qlr-chart-size-bar" style="width:100%;height:360px;"></div>
                  </div>
                </div>

                <!-- Heatmap t√¨nh tr·∫°ng -->
                <div class="card">
                  <div class="card-header">
                    <div>
                      <h3 class="card-title">T·ªìn b√£i theo t√¨nh tr·∫°ng</h3>
                      <p class="card-subtitle">AV/DM/OF/WA √ó Size</p>
                    </div>
                  </div>
                  <div class="card-body">
                    <div id="qlr-chart-status-heatmap" style="width:100%;height:360px;"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section: Chi ti·∫øt lu·ªìng -->
            <div style="margin-bottom: 16px;">
              <h3 style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; padding-left: 4px; border-left: 4px solid var(--accent-green);">
                üîÑ Chi ti·∫øt lu·ªìng nh·∫≠p xu·∫•t
              </h3>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <!-- Hierarchy Xu·∫•t r·ªóng -->
                <div class="card">
                  <div class="card-header">
                    <div>
                      <h3 class="card-title">Xu·∫•t r·ªóng - Ph√¢n lo·∫°i</h3>
                      <p class="card-subtitle">C·∫•p r·ªóng & Chuy·ªÉn r·ªóng</p>
                    </div>
                  </div>
                  <div class="card-body">
                    <div id="qlr-chart-export-hierarchy" style="width:100%;height:380px;"></div>
                  </div>
                </div>

                <!-- Hierarchy Nh·∫≠p r·ªóng -->
                <div class="card">
                  <div class="card-header">
                    <div>
                      <h3 class="card-title">Nh·∫≠p r·ªóng - Ph√¢n lo·∫°i</h3>
                      <p class="card-subtitle">S√† lan & Gate</p>
                    </div>
                  </div>
                  <div class="card-body">
                    <div id="qlr-chart-import-hierarchy" style="width:100%;height:380px;"></div>
                  </div>
                </div>
              </div>
            </div>

          </section>

          <!-- PAGE: XNT V·∫¨T T∆Ø -->
          <section class="page" id="xnt">
            <div class="page-header">
              <div>
                <h2 class="page-title">üìã Xu·∫•t - Nh·∫≠p - T·ªìn V·∫≠t T∆∞</h2>
                <p class="page-subtitle">Qu·∫£n l√Ω v·∫≠t t∆∞ realtime</p>
              </div>
              <div class="header-filters">
                <select class="filter-select" id="xntFilterMonth" aria-label="Th√°ng">
                  <option value="2026-01">Th√°ng 01/2026</option>
                  <option value="2025-12">Th√°ng 12/2025</option>
                  <option value="2025-11">Th√°ng 11/2025</option>
                </select>
                <select class="filter-select" id="xntFilterCategory" aria-label="Lo·∫°i v·∫≠t t∆∞">
                  <option value="T·∫•t c·∫£">Lo·∫°i: T·∫•t c·∫£</option>
                  <option value="C√¥ng c·ª• s·∫£n xu·∫•t">C√¥ng c·ª• s·∫£n xu·∫•t</option>
                  <option value="V·∫≠t t∆∞ s·∫£n xu·∫•t">V·∫≠t t∆∞ s·∫£n xu·∫•t</option>
                </select>
              </div>
            </div>

            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px;">
              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%); border-left: 4px solid #ef4444;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">T·ªîNG XU·∫§T GI√Å TR·ªä</div>
                  <div id="xntKpiExport" style="font-size: 1.8rem; font-weight: 700; color: #ef4444; margin-bottom: 4px;">254.8 t·ª∑</div>
                  <div class="kpi-meta">
                    <div id="xntKpiExportNote" style="color: #64748b; font-size: 0.8rem;">Th√°ng 01/2026</div>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%); border-left: 4px solid #3b82f6;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">T·ªîNG NH·∫¨P GI√Å TR·ªä</div>
                  <div id="xntKpiImport" style="font-size: 1.8rem; font-weight: 700; color: #3b82f6; margin-bottom: 4px;">186.2 t·ª∑</div>
                  <div class="kpi-meta">
                    <div id="xntKpiImportNote" style="color: #64748b; font-size: 0.8rem;">Th√°ng 01/2026</div>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); border-left: 4px solid #10b981;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">T·ªîNG T·ªíN (GI√Å TR·ªä)</div>
                  <div id="xntKpiStock" style="font-size: 1.8rem; font-weight: 700; color: #10b981; margin-bottom: 4px;">142.6 t·ª∑</div>
                  <div class="kpi-meta">
                    <div id="xntKpiStockNote" style="color: #64748b; font-size: 0.8rem;">Cu·ªëi th√°ng 01/2026</div>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #faf5ff 0%, #ffffff 100%); border-left: 4px solid #a855f7;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">KH·∫¢ NƒÇNG ƒê√ÅP ·ª®NG</div>
                  <div id="xntKpiFulfillment" style="font-size: 1.8rem; font-weight: 700; color: #a855f7; margin-bottom: 4px;">87.5%</div>
                  <div class="kpi-meta">
                    <div id="xntKpiFulfillmentNote" style="color: #64748b; font-size: 0.8rem;">ƒê√°p ·ª©ng k·∫ø ho·∫°ch order</div>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; background: linear-gradient(135deg, #fff7ed 0%, #ffffff 100%); border-left: 4px solid #f59e0b;">
                <div class="card-body" style="padding: 20px;">
                  <div style="color: #64748b; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px;">TI·ªÄN D·ª∞ KI·∫æN MUA TH√äM</div>
                  <div id="xntKpiPurchase" style="font-size: 1.8rem; font-weight: 700; color: #f59e0b; margin-bottom: 4px;">3,223.4 tri·ªáu</div>
                  <div class="kpi-meta">
                    <div id="xntKpiPurchaseNote" style="color: #64748b; font-size: 0.8rem;">T·ªïng order thi·∫øu</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts Row 1: 3 charts -->
            <div style="display: flex; gap: 20px; margin-top: 20px;">
              <div class="card" style="border: 1px solid #e2e8f0; flex: 1; min-width: 0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">XU·∫§T NH·∫¨P T·ªíN THEO TH·ªúI GIAN</div>
                </div>
                <div class="chart-wrapper" id="chart-xnt-timeseries" style="height: 280px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; flex: 1; min-width: 0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">GI√Å TR·ªä THEO LO·∫†I V·∫¨T T∆Ø</div>
                </div>
                <div class="chart-wrapper" id="chart-xnt-category" style="height: 280px; padding: 16px;"></div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0; flex: 1; min-width: 0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">KH·∫¢ NƒÇNG ƒê√ÅP ·ª®NG THEO TH·ªúI GIAN</div>
                </div>
                <div class="chart-wrapper" id="chart-xnt-fulfillment" style="height: 280px; padding: 16px;"></div>
              </div>
            </div>

            <!-- Charts Row 2: B·∫£ng chi ti·∫øt v√† Bi·ªÉu ƒë·ªì -->
            <div class="charts-grid" style="gap: 20px; margin-top: 20px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">CHI TI·∫æT V·∫¨T T∆Ø (ORDER - T·ªíN - C·∫¶N MUA TH√äM)</div>
                </div>
                <div class="card-body">
                  <div class="table-container" style="overflow:auto; max-height: 320px;">
                    <table class="data-table" id="xntTableOrder" style="width: 100%;">
                      <thead>
                        <tr>
                          <th>V·∫¨T T∆Ø</th>
                          <th>LO·∫†I</th>
                          <th>ORDER (S·∫¢N L∆Ø·ª¢NG)</th>
                          <th>T·ªíN HI·ªÜN T·∫†I</th>
                          <th>C·∫¶N MUA TH√äM</th>
                          <th>S·∫¢N L∆Ø·ª¢NG D·ª∞ KI·∫æN</th>
                          <th>TI·ªÄN D·ª∞ KI·∫æN (TRI·ªÜU)</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">XU·∫§T H√ÄNG THEO B·ªò PH·∫¨N</div>
                </div>
                <div class="chart-wrapper" id="chart-xnt-dept" style="height: 320px; padding: 16px;"></div>
              </div>
            </div>

            <!-- B·∫£ng chi ti·∫øt -->
            <div class="card" style="border: 1px solid #e2e8f0; margin-top: 20px;">
              <div class="card-header" style="background: #fafafa;">
                <div class="card-title">CHI TI·∫æT XU·∫§T - NH·∫¨P - T·ªíN TRONG K·ª≤</div>
              </div>
              <div class="card-body">
                <div class="table-container" style="overflow:auto; max-height: 400px;">
                  <table class="data-table" id="xntTableDetail" style="width: 100%;">
                    <thead>
                      <tr>
                        <th>M√É V·∫¨T T∆Ø</th>
                        <th>T√äN V·∫¨T T∆Ø</th>
                        <th>LO·∫†I</th>
                        <th>T·ªíN ƒê·∫¶U K·ª≤</th>
                        <th>NH·∫¨P TRONG K·ª≤</th>
                        <th>XU·∫§T TRONG K·ª≤</th>
                        <th>T·ªíN CU·ªêI K·ª≤</th>
                        <th>ƒê∆†N V·ªä</th>
                        <th>GI√Å TR·ªä (TRI·ªÜU)</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </section>

          <!-- PAGE: S·ª¨A CH·ªÆA THI·∫æT B·ªä -->
          <section class="page" id="sua-chua">
            <div class="page-header">
              <div>
                <h2 class="page-title">üîß B√°o C√°o S·ª≠a Ch·ªØa Thi·∫øt B·ªã</h2>
              </div>
              <div class="header-filters">
                <select class="filter-select" id="scFilterMonth" aria-label="Th·ªùi gian">
                  <option>Th·ªùi gian: Th√°ng 01/2026</option>
                  <option>Th·ªùi gian: Th√°ng 12/2025</option>
                  <option>Th·ªùi gian: Th√°ng 11/2025</option>
                </select>
                <select class="filter-select" id="scFilterDeviceType" aria-label="Lo·∫°i thi·∫øt b·ªã">
                  <option>Lo·∫°i thi·∫øt b·ªã: T·∫•t c·∫£</option>
                  <option>Lo·∫°i thi·∫øt b·ªã: S√† lan</option>
                  <option>Lo·∫°i thi·∫øt b·ªã: C·∫ßu</option>
                  <option>Lo·∫°i thi·∫øt b·ªã: Xe n√¢ng</option>
                </select>
                <select class="filter-select" id="scFilterRepairType" aria-label="Lo·∫°i s·ª≠a ch·ªØa">
                  <option>Lo·∫°i s·ª≠a ch·ªØa: T·∫•t c·∫£</option>
                  <option>Lo·∫°i s·ª≠a ch·ªØa: Ph√°t sinh</option>
                  <option>Lo·∫°i s·ª≠a ch·ªØa: B·∫£o tr√¨ ƒë·ªãnh k·ª≥</option>
                  <option>Lo·∫°i s·ª≠a ch·ªØa: B·∫£o d∆∞·ª°ng</option>
                </select>
              </div>
            </div>

            <div class="kpi-grid" style="gap: 20px;">
              <div class="kpi-card" style="border-left-color: #f87171; background: linear-gradient(135deg, #fef2f2 0%, white 100%);">
                <div class="kpi-label" style="color: #991b1b;">T·ªîNG L·∫¶N S·ª¨A CH·ªÆA</div>
                <div class="kpi-value" style="color: #dc2626;">127</div>
                <div class="kpi-meta">
                  <div style="background: #fee2e2; color: #991b1b; padding: 4px 8px; border-radius: 6px; display: inline-block; font-size: 0.75rem; font-weight: 600; margin-bottom: 4px;">+65% ‚ñ≤</div>
                  <div style="color: #64748b; font-size: 0.75rem;">Th√°ng n√†y | 50 vs th√°ng tr∆∞·ªõc</div>
                </div>
              </div>
              <div class="kpi-card" style="border-left-color: #fbbf24; background: linear-gradient(135deg, #fffbeb 0%, white 100%);">
                <div class="kpi-label" style="color: #92400e;">T·ªîNG CHI PH√ç</div>
                <div class="kpi-value" style="color: #f59e0b;">2.8 t·ª∑</div>
                <div class="kpi-meta">
                  <div style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 6px; display: inline-block; font-size: 0.75rem; font-weight: 600; margin-bottom: 4px;">+98% ‚ñ≤</div>
                  <div style="color: #64748b; font-size: 0.75rem;">Chi ph√≠ c·ªßa s·ª≠a ch·ªØa th√°ng n√†y</div>
                </div>
              </div>
              <div class="kpi-card" style="border-left-color: #34d399; background: linear-gradient(135deg, #f0fdf4 0%, white 100%);">
                <div class="kpi-label" style="color: #065f46;">TH·ªúI GIAN TB/L·∫¶N</div>
                <div class="kpi-value" style="color: #10b981;">4.2 ng√†y</div>
                <div class="kpi-meta">
                  <div style="color: #64748b; font-size: 0.8rem;">Th·ªùi gian s·ª≠a ch·ªØa trung b√¨nh</div>
                </div>
              </div>
              <div class="kpi-card" style="border-left-color: #a78bfa; background: linear-gradient(135deg, #faf5ff 0%, white 100%);">
                <div class="kpi-label" style="color: #5b21b6;">THI·∫æT B·ªä ƒêANG S·ª¨A</div>
                <div class="kpi-value" style="color: #8b5cf6;">18</div>
                <div class="kpi-meta">
                  <div style="color: #64748b; font-size: 0.8rem;">ƒêang trong qu√° tr√¨nh s·ª≠a ch·ªØa</div>
                </div>
              </div>
            </div>

            <div style="display: flex; gap: 20px; margin-top: 20px;">
              <div class="card" style="border: 1px solid #e2e8f0; flex: 1; min-width: 0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">S·ªê L·∫¶N S·ª¨A CH·ªÆA & CHI PH√ç THEO TH·ªúI GIAN</div>
                </div>
                <div class="chart-wrapper" id="chart-sc-timeseries" style="height: 280px; padding: 16px;"></div>
              </div>
              <div class="card" style="border: 1px solid #e2e8f0; flex: 1; min-width: 0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">T·ª∂ TR·ªåNG LO·∫†I S·ª¨A CH·ªÆA</div>
                </div>
                <div class="chart-wrapper" id="chart-sc-type" style="height: 280px; padding: 16px;"></div>
              </div>
              <div class="card" style="border: 1px solid #e2e8f0; flex: 1; min-width: 0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">TOP 10 L·ªñI C·∫¶N S·ª¨A CH·ªÆA</div>
                </div>
                <div class="chart-wrapper" id="chart-sc-topissues" style="height: 280px; padding: 16px;"></div>
              </div>
            </div>

            <div class="charts-grid" style="gap: 20px; margin-top: 20px;">
              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa;">
                  <div class="card-title">TH·ªúI GIAN S·ª¨A CH·ªÆA THEO THI·∫æT B·ªä</div>
                </div>
                <div class="card-body">
                  <div class="table-container" style="overflow:auto; max-height: 280px;">
                    <table class="data-table" id="scTableDevice" style="width: 100%;">
                      <thead>
                        <tr>
                          <th>THI·∫æT B·ªä</th>
                          <th>TH·ªúI GIAN S·ª¨A CH·ªÆA TB (NG√ÄY)</th>
                          <th>S·ªê L·∫¶N S·ª¨A CH·ªÆA</th>
                          <th style="min-width: 200px;">CHI PH√ç S·ª¨A CH·ªÆA (TRI·ªÜU)</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="card" style="border: 1px solid #e2e8f0;">
                <div class="card-header" style="background: #fafafa; display: flex; justify-content: space-between; align-items: center;">
                  <div class="card-title">HEATMAP S·ª¨A CH·ªÆA L·ªñI THEO XE & LO·∫†I S·ª¨A CH·ªÆA</div>
                  <div style="display: flex; gap: 8px;">
                    <button id="btnHeatmapCount" style="padding: 6px 12px; border: 2px solid #3b82f6; background: #3b82f6; color: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">S·ªë l·∫ßn</button>
                    <button id="btnHeatmapCost" style="padding: 6px 12px; border: 2px solid #e2e8f0; background: white; color: #64748b; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">Chi ph√≠</button>
                  </div>
                </div>
                <div class="chart-wrapper" id="chart-sc-heatmap" style="height: 380px; padding: 16px;"></div>
              </div>
            </div>

            <div class="card" style="border: 1px solid #e2e8f0; margin-top: 20px;">
              <div class="card-header" style="background: #fafafa;">
                <div class="card-title">CHI TI·∫æT L·ªäCH S·ª¨ S·ª¨A CH·ªÆA</div>
              </div>
              <div class="card-body">
                <div class="table-container" style="overflow:auto; max-height: 350px;">
                  <table class="data-table" id="scTableHistory">
                    <thead>
                      <tr>
                        <th>M√É SC</th>
                        <th>THI·∫æT B·ªä</th>
                        <th>LO·∫†I S·ª¨A CH·ªÆA</th>
                        <th>N·ªòI DUNG</th>
                        <th>NG√ÄY B·∫ÆT ƒê·∫¶U</th>
                        <th>NG√ÄY HO√ÄN TH√ÄNH</th>
                        <th>TH·ªúI GIAN (NG√ÄY)</th>
                        <th>CHI PH√ç</th>
                        <th>TR·∫†NG TH√ÅI</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

          </section>

          <!-- PAGE: QU·∫¢N L√ù R·ªñNG -->
          <section class="page" id="rong">
            <div class="page-header">
              <div>
                <h2 class="page-title">üì¶ Qu·∫£n L√Ω R·ªóng</h2>
                <p class="page-subtitle">Container & lu·ªìng chi·ªÅu v·ªÅ</p>
              </div>
            </div>

            <div class="kpi-grid">
              <div class="kpi-card danger">
                <div class="kpi-label">T·ª∑ l·ªá r·ªóng</div>
                <div class="kpi-value">21%</div>
                <div class="kpi-meta">
                  <span>M·ª•c ti√™u 15%</span>
                </div>
              </div>
              <div class="kpi-card warning">
                <div class="kpi-label">Chi ph√≠ reposition</div>
                <div class="kpi-value">32 t·ª∑ ‚Ç´</div>
                <div class="kpi-meta">
                  <span class="trend-up">‚Üë +5%</span>
                  <span>so v·ªõi ng√¢n s√°ch</span>
                </div>
              </div>
              <div class="kpi-card success">
                <div class="kpi-label">S·ªë chuy·∫øn t·ªëi ∆∞u</div>
                <div class="kpi-value">148</div>
                <div class="kpi-meta">
                  <span class="trend-up">‚Üë +18</span>
                  <span>chuy·∫øn d√πng gh√©p</span>
                </div>
              </div>
              <div class="kpi-card warning">
                <div class="kpi-label">Lu·ªìng ∆∞u ti√™n</div>
                <div class="kpi-value">SGN ‚Üí HP</div>
                <div class="kpi-meta">
                  <span>M·∫•t c√¢n b·∫±ng cao</span>
                </div>
              </div>
            </div>

            <div class="charts-grid">
              <div class="card">
                <div class="card-header">
                  <div>
                    <div class="card-title">Lu·ªìng R·ªóng Theo Tuy·∫øn</div>
                    <div class="card-subtitle">Ph√¢n t√≠ch d√≤ng ch·∫£y</div>
                  </div>
                  <span class="badge badge-danger">C·∫£nh b√°o</span>
                </div>
                <div class="chart-wrapper" id="chart-rong-flow"></div>
              </div>

              <div class="card">
                <div class="card-header">
                  <div>
                    <div class="card-title">Backlog Theo Lo·∫°i Container</div>
                    <div class="card-subtitle">Ph√¢n lo·∫°i t·ªìn</div>
                  </div>
                  <span class="badge badge-warning">Reefer thi·∫øu</span>
                </div>
                <div class="chart-wrapper" id="chart-rong-backlog"></div>
              </div>
            </div>

          </section>

          <!-- PAGE: QU·∫¢N L√ù KH√ÅCH H√ÄNG -->
          <section class="page" id="khach-hang" style="background: #f8fafc;">
            <div class="page-header">
              <div>
                <h2 class="page-title">üë• Qu·∫£n L√Ω Kh√°ch H√†ng</h2>
                <p class="page-subtitle">Ph√¢n t√≠ch v√† theo d√µi kh√°ch h√†ng</p>
              </div>
              <div style="display: flex; gap: 12px; align-items: center;">
                <select id="khFilterMonth" class="filter-select" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0; background: white; cursor: pointer;">
                  <option value="2026-01">Th√°ng 1/2026</option>
                  <option value="2025-12">Th√°ng 12/2025</option>
                  <option value="2025-11">Th√°ng 11/2025</option>
                  <option value="2025-10">Th√°ng 10/2025</option>
                </select>
                <select id="khFilterType" class="filter-select" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0; background: white; cursor: pointer;">
                  <option value="all">T·∫•t c·∫£ lo·∫°i h√¨nh</option>
                  <option value="khai-thac">Khai th√°c</option>
                  <option value="thuong-vu">Th∆∞∆°ng v·ª•</option>
                  <option value="mnr">MnR</option>
                  <option value="kho-bai">Kho b√£i</option>
                </select>
              </div>
            </div>

            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 16px; margin-bottom: 24px;">
              <!-- Doanh thu so v·ªõi m·ª•c ti√™u -->
              <div class="card" style="background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border: 2px solid #e2e8f0;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #475569; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">Doanh thu vs M·ª•c ti√™u</div>
                  <div id="kh-chart-gauge" style="height: 140px; margin: -10px;"></div>
                  <div style="text-align: center; margin-top: -5px;">
                    <div id="khKpiRevenueValue" style="font-size: 1.5rem; font-weight: 700; color: #1e293b;">289 t·ª∑</div>
                    <div id="khKpiRevenueTarget" style="color: #64748b; font-size: 0.75rem; margin-top: 2px;">M·ª•c ti√™u: 280 t·ª∑</div>
                  </div>
                </div>
              </div>

              <!-- T·ªïng s·ªë KH -->
              <div class="card" style="background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%); border-left: 4px solid #3b82f6;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #64748b; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">T·ªïng s·ªë kh√°ch h√†ng</div>
                  <div id="khKpiCustomers" style="font-size: 2.2rem; font-weight: 700; color: #3b82f6; margin-bottom: 8px;">1,245</div>
                  <div class="kpi-meta" style="margin-bottom: 6px;">
                    <span id="khKpiNewCustomers" style="color: #10b981; font-size: 0.75rem; font-weight: 600;">+32 KH m·ªõi</span>
                    <span style="color: #64748b; font-size: 0.7rem;"> trong th√°ng</span>
                  </div>
                  <div style="color: #64748b; font-size: 0.7rem;">
                    <span style="font-weight: 600; color: #8b5cf6;" id="khKpiLoyalCustomers">892</span> KH trung th√†nh
                  </div>
                </div>
              </div>

              <!-- % KH ƒë·∫°t KPI -->
              <div class="card" style="background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); border-left: 4px solid #10b981;">
                <div class="card-body" style="padding: 16px;">
                  <div style="color: #64748b; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; text-transform: uppercase;">% Kh√°ch h√†ng ƒë·∫°t KPI</div>
                  <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 8px;">
                    <div id="khKpiPercent" style="font-size: 2.2rem; font-weight: 700; color: #10b981;">68.5%</div>
                    <div id="khKpiCount" style="font-size: 0.9rem; color: #64748b;">(853/1245)</div>
                  </div>
                  <div class="kpi-meta">
                    <span id="khKpiPercentTrend" style="color: #10b981; font-size: 0.75rem; font-weight: 600;">‚Üë +5.2%</span>
                    <span style="color: #64748b; font-size: 0.7rem;"> vs th√°ng tr∆∞·ªõc</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Row 1: Revenue & Customer over time + Value segmentation -->
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; margin-bottom: 20px;">
              <div class="card">
                <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Doanh thu v√† S·ªë kh√°ch h√†ng theo th·ªùi gian</div>
                <div id="kh-chart-revenue-customer-time" style="height: 320px;"></div>
              </div>
              <div class="card">
                <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">T·ª∑ tr·ªçng theo nh√≥m gi√° tr·ªã kh√°ch h√†ng</div>
                <div id="kh-chart-value-segment" style="height: 320px;"></div>
              </div>
            </div>

            <!-- Row 2: Top customers + Heatmap -->
            <div style="display: grid; grid-template-columns: 1fr 1.2fr; gap: 20px; margin-bottom: 20px;">
              <div class="card">
                <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Top 10 kh√°ch h√†ng</div>
                <div id="kh-chart-top-customers" style="height: 360px;"></div>
              </div>
              <div class="card">
                <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">Heatmap Kh√°ch h√†ng √ó M·∫£ng kinh doanh</div>
                <div id="kh-chart-heatmap" style="height: 360px;"></div>
              </div>
            </div>

            <!-- Row 3: Cohort Analysis -->
            <div class="card" style="margin-bottom: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div style="font-weight: 600; color: #1e293b; font-size: 0.95rem;">Cohort Analysis - Doanh thu theo th·ªùi gian</div>
                <div style="display: flex; gap: 8px;">
                  <button id="khCohortRevenue" style="padding: 6px 16px; border: 1px solid #3b82f6; background: #3b82f6; color: white; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600;">Doanh thu (t·ª∑)</button>
                  <button id="khCohortRetention" style="padding: 6px 16px; border: 1px solid #cbd5e1; background: white; color: #64748b; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600;">T·ª∑ l·ªá gi·ªØ ch√¢n (%)</button>
                </div>
              </div>
              <div id="kh-chart-cohort" style="height: 320px;"></div>
            </div>

            <!-- Row 4: Customer Detail Table -->
            <div class="card">
              <div style="font-weight: 600; color: #1e293b; margin-bottom: 12px; font-size: 0.95rem;">B·∫£ng chi ti·∫øt kh√°ch h√†ng</div>
              <div class="table-container">
                <table class="data-table" id="khTableDetail">
                  <thead>
                    <tr>
                      <th style="text-align: left;">Kh√°ch h√†ng</th>
                      <th style="text-align: right;">Doanh thu (t·ª∑)</th>
                      <th style="text-align: right;">L·ª£i nhu·∫≠n (t·ª∑)</th>
                      <th style="text-align: right;">C√¥ng n·ª£ (t·ª∑)</th>
                      <th style="text-align: center;">% ƒê·∫°t KPI</th>
                      <th style="text-align: center;">Ng√†y k√Ω Hƒê g·∫ßn nh·∫•t</th>
                      <th style="text-align: center;">M·∫£ng KD ch√≠nh</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

          </section>

          <!-- PAGE: H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG -->
          <section class="page" id="huong-dan" style="background: #f8fafc;">
            <div class="page-header">
              <h1 class="page-title">
                <span class="page-icon">‚ùì</span>
                H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng Dashboard Kinh doanh V·∫≠n h√†nh
              </h1>
            </div>

            <div style="max-width: 1200px; margin: 0 auto;">
              <!-- Section 1: N·ªôi dung c·ªët l√µi -->
              <div class="card" style="margin-bottom: 24px;">
                <h2 style="color: #1e3a8a; font-size: 22px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 3px solid #3b82f6;">
                  üìã 1. N·ªòI DUNG C·ªêT L√ïI
                </h2>

                <!-- 4 Ph·∫ßn B√°o C√°o Ch√≠nh -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                  <div style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); padding: 18px; border-radius: 10px; border-left: 5px solid #ec4899;">
                    <div style="font-weight: 700; color: #9f1239; font-size: 15px; margin-bottom: 8px;">üìä T·ªîNG QUAN</div>
                    <p style="color: #475569; font-size: 13px; line-height: 1.6; margin: 0 0 8px 0;">
                      C√°i nh√¨n t·ªïng th·ªÉ v·ªÅ t·∫•t c·∫£ c√°c KPI ch√≠nh v√† xu h∆∞·ªõng kinh doanh theo th·ªùi gian
                    </p>
                    <div style="color: #9f1239; font-size: 13px; font-weight: 600;">
                      ‚Ä¢ T·ªïng quan
                    </div>
                  </div>
                  <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 18px; border-radius: 10px; border-left: 5px solid #3b82f6;">
                    <div style="font-weight: 700; color: #1e40af; font-size: 15px; margin-bottom: 8px;">üìà KINH DOANH</div>
                    <p style="color: #475569; font-size: 13px; line-height: 1.6; margin: 0 0 8px 0;">
                      Theo d√µi doanh thu, l·ª£i nhu·∫≠n v√† hi·ªáu qu·∫£ kinh doanh c·ªßa c√°c m·∫£ng: Khai th√°c, Th∆∞∆°ng v·ª•, MnR, Kho b√£i
                    </p>
                    <div style="color: #1e40af; font-size: 13px; font-weight: 600; line-height: 1.8;">
                      ‚Ä¢ Khai th√°c<br>
                      ‚Ä¢ Th∆∞∆°ng v·ª•<br>
                      ‚Ä¢ MnR<br>
                      ‚Ä¢ Kho b√£i
                    </div>
                  </div>
                  <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 18px; border-radius: 10px; border-left: 5px solid #10b981;">
                    <div style="font-weight: 700; color: #065f46; font-size: 15px; margin-bottom: 8px;">üîÑ V·∫¨N H√ÄNH</div>
                    <p style="color: #475569; font-size: 13px; line-height: 1.6; margin: 0 0 8px 0;">
                      Qu·∫£n l√Ω ho·∫°t ƒë·ªông v·∫≠n h√†nh: Xu·∫•t-Nh·∫≠p-T·ªìn (XNT), Qu·∫£n l√Ω r·ªóng, S·ª≠a ch·ªØa thi·∫øt b·ªã
                    </p>
                    <div style="color: #065f46; font-size: 13px; font-weight: 600; line-height: 1.8;">
                      ‚Ä¢ Xu·∫•t - Nh·∫≠p - T·ªìn (XNT)<br>
                      ‚Ä¢ Qu·∫£n l√Ω R·ªóng<br>
                      ‚Ä¢ S·ª≠a ch·ªØa Thi·∫øt b·ªã
                    </div>
                  </div>
                  <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 18px; border-radius: 10px; border-left: 5px solid #f59e0b;">
                    <div style="font-weight: 700; color: #92400e; font-size: 15px; margin-bottom: 8px;">üë• KH√ÅCH H√ÄNG</div>
                    <p style="color: #475569; font-size: 13px; line-height: 1.6; margin: 0 0 8px 0;">
                      Ph√¢n t√≠ch chuy√™n s√¢u: Ph√¢n nh√≥m gi√° tr·ªã, Cohort analysis, Heatmap, Theo d√µi KPI v√† c√¥ng n·ª£
                    </p>
                    <div style="color: #92400e; font-size: 13px; font-weight: 600;">
                      ‚Ä¢ Qu·∫£n l√Ω Kh√°ch h√†ng
                    </div>
                  </div>
                </div>
              </div>

              <!-- Section 2: Lu·ªìng b√°o c√°o -->
              <div class="card" style="margin-bottom: 24px;">
                <h2 style="color: #1e3a8a; font-size: 22px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 3px solid #3b82f6;">
                  üîÑ 2. LU·ªíNG B√ÅO C√ÅO
                </h2>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                    <div style="background: #eff6ff; border-left: 5px solid #3b82f6; padding: 15px; border-radius: 8px;">
                      <div style="font-weight: 700; color: #1e40af; margin-bottom: 10px;">üìä T·ªîNG QUAN</div>
                      <ul style="margin: 0; padding-left: 20px; color: #374151; font-size: 13px; line-height: 1.6;">
                        <li><strong>M·∫£ng kinh doanh n√†o ƒë√≥ng g√≥p nhi·ªÅu nh·∫•t?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì "Ph√¢n b·ªï Doanh thu/L·ª£i nhu·∫≠n"</li>
                        <li><strong>Xu h∆∞·ªõng chi ph√≠ c√≥ tƒÉng b·∫•t th∆∞·ªùng kh√¥ng?</strong> ‚Üí Theo d√µi bi·ªÉu ƒë·ªì xu h∆∞·ªõng theo th·ªùi gian</li>
                        <li><strong>Doanh thu th√°ng n√†y ƒë·∫°t m·ª•c ti√™u ch∆∞a?</strong> ‚Üí Xem KPI cards v√† so s√°nh v·ªõi m·ª•c ti√™u</li>
                      </ul>
                    </div>

                    <div style="background: #f0fdf4; border-left: 5px solid #10b981; padding: 15px; border-radius: 8px;">
                      <div style="font-weight: 700; color: #10b981; margin-bottom: 10px;">‚öì KHAI TH√ÅC</div>
                      <ul style="margin: 0; padding-left: 20px; color: #374151; font-size: 13px; line-height: 1.6;">
                        <li><strong>T·∫£i tr·ªçng trung b√¨nh l√† bao nhi√™u?</strong> ‚Üí Xem KPI card "T·∫£i tr·ªçng TB"</li>
                        <li><strong>Tuy·∫øn n√†o mang l·∫°i l·ª£i nhu·∫≠n cao nh·∫•t?</strong> ‚Üí Xem b·∫£ng "Top tuy·∫øn t√†u"</li>
                        <li><strong>H√†ng h√≥a ch√≠nh l√† g√¨?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì "C∆° c·∫•u h√†ng h√≥a"</li>
                      </ul>
                    </div>

                    <div style="background: #fffbeb; border-left: 5px solid #f59e0b; padding: 15px; border-radius: 8px;">
                      <div style="font-weight: 700; color: #f59e0b; margin-bottom: 10px;">üíº TH∆Ø∆†NG V·ª§</div>
                      <ul style="margin: 0; padding-left: 20px; color: #374151; font-size: 13px; line-height: 1.6;">
                        <li><strong>Pipeline kh√°ch h√†ng nh∆∞ th·∫ø n√†o?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì funnel "Pipeline kh√°ch h√†ng"</li>
                        <li><strong>Ng√†nh h√†ng n√†o c√≥ bi√™n l·ª£i nhu·∫≠n cao?</strong> ‚Üí Xem b·∫£ng "Bi√™n l·ª£i nhu·∫≠n theo ng√†nh"</li>
                        <li><strong>D·ªãch v·ª• n√†o chi·∫øm t·ª∑ tr·ªçng l·ªõn?</strong> ‚Üí Xem b·∫£ng "Chi ti·∫øt d·ªãch v·ª•" v·ªõi t·ª∑ tr·ªçng %</li>
                      </ul>
                    </div>

                    <div style="background: #fef2f2; border-left: 5px solid #ef4444; padding: 15px; border-radius: 8px;">
                      <div style="font-weight: 700; color: #ef4444; margin-bottom: 10px;">üîß MnR</div>
                      <ul style="margin: 0; padding-left: 20px; color: #374151; font-size: 13px; line-height: 1.6;">
                        <li><strong>NƒÉng su·∫•t ƒë·ªôi ng≈© l√† bao nhi√™u?</strong> ‚Üí Xem KPI "NƒÉng su·∫•t trung b√¨nh"</li>
                        <li><strong>Lo·∫°i d·ªãch v·ª• n√†o chi·∫øm t·ª∑ tr·ªçng cao?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì tr√≤n "Ph√¢n b·ªï theo lo·∫°i"</li>
                        <li><strong>Xu h∆∞·ªõng chi ph√≠ c√≥ tƒÉng kh√¥ng?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì "Doanh thu & Chi ph√≠" theo th√°ng</li>
                      </ul>
                    </div>

                    <div style="background: #f3e8ff; border-left: 5px solid #a855f7; padding: 15px; border-radius: 8px;">
                      <div style="font-weight: 700; color: #a855f7; margin-bottom: 10px;">üì¶ KHO B√ÉI</div>
                      <ul style="margin: 0; padding-left: 20px; color: #374151; font-size: 13px; line-height: 1.6;">
                        <li><strong>T·ª∑ l·ªá l·∫•p ƒë·∫ßy l√† bao nhi√™u?</strong> ‚Üí Xem gauge chart "C√¥ng su·∫•t s·ª≠ d·ª•ng"</li>
                        <li><strong>Lo·∫°i h√†ng n√†o chi·∫øm di·ªán t√≠ch l·ªõn?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì "Ph√¢n b·ªï theo lo·∫°i h√†ng"</li>
                        <li><strong>Doanh thu l∆∞u b√£i nh∆∞ th·∫ø n√†o?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì xu h∆∞·ªõng "Doanh thu theo th√°ng"</li>
                      </ul>
                    </div>

                    <div style="background: #ecfdf5; border-left: 5px solid #059669; padding: 15px; border-radius: 8px;">
                      <div style="font-weight: 700; color: #059669; margin-bottom: 10px;">üë• KH√ÅCH H√ÄNG</div>
                      <ul style="margin: 0; padding-left: 20px; color: #374151; font-size: 13px; line-height: 1.6;">
                        <li><strong>T·ª∑ l·ªá kh√°ch h√†ng ƒë·∫°t KPI?</strong> ‚Üí Xem KPI card "% ƒê·∫°t KPI"</li>
                        <li><strong>Cohort kh√°ch h√†ng gi·ªØ ch√¢n t·ªët kh√¥ng?</strong> ‚Üí D√πng toggle "T·ª∑ l·ªá gi·ªØ ch√¢n" trong Cohort Analysis</li>
                        <li><strong>Kh√°ch h√†ng VIP l√† ai?</strong> ‚Üí Xem bi·ªÉu ƒë·ªì "Ph√¢n nh√≥m gi√° tr·ªã" v√† b·∫£ng chi ti·∫øt</li>
                      </ul>
                    </div>
                  </div>

                  <!-- L∆∞u √Ω khi xem b√°o c√°o -->
                  <div style="background: #fef3c7; border-left: 5px solid #f59e0b; padding: 20px; border-radius: 8px; margin-top: 20px;">
                    <div style="font-weight: 700; color: #92400e; margin-bottom: 12px; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                      <span>üí°</span>
                      <span>L∆∞u √Ω khi xem b√°o c√°o</span>
                    </div>
                    <ul style="color: #78350f; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
                      <li>Bi·ªÉu ƒë·ªì c√≥ th·ªÉ <strong>click ƒë·ªÉ xem chi ti·∫øt</strong> ho·∫∑c <strong>filter d·ªØ li·ªáu</strong></li>
                      <li>M√†u <strong style="color: #22c55e;">xanh l√°</strong> = T·ªët, <strong style="color: #f59e0b;">v√†ng</strong> = C·∫£nh b√°o, <strong style="color: #ef4444;">ƒë·ªè</strong> = C·∫ßn x·ª≠ l√Ω</li>
                      <li>C√°c KPI c√≥ <strong>m≈©i t√™n ‚Üë‚Üì</strong> so v·ªõi th√°ng tr∆∞·ªõc</li>
                      <li>Hover chu·ªôt l√™n bi·ªÉu ƒë·ªì ƒë·ªÉ xem <strong>tooltip chi ti·∫øt</strong></li>
                      <li>B·∫£ng c√≥ th·ªÉ <strong>s·∫Øp x·∫øp</strong> b·∫±ng c√°ch click v√†o ti√™u ƒë·ªÅ c·ªôt</li>
                      <li>S·ª≠ d·ª•ng <strong>sidebar menu</strong> ƒë·ªÉ chuy·ªÉn gi·ªØa c√°c trang b√°o c√°o</li>
                      <li>D·ªØ li·ªáu ƒë∆∞·ª£c <strong>c·∫≠p nh·∫≠t h√†ng ng√†y</strong> v√†o 8:30 s√°ng</li>
                      <li>Dashboard <strong>responsive</strong> - c√≥ th·ªÉ xem tr√™n mobile/tablet</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

          </section>

        </div>
      </main>
    </div>
  </div>

  <script>
    const navTimestamp = document.getElementById('navTimestamp');

    const updateNavTimestamp = () => {
      if (!navTimestamp) return;
      const now = new Date();
      const formatted = new Intl.DateTimeFormat('vi-VN', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      }).format(now);
      navTimestamp.textContent = `C·∫≠p nh·∫≠t g·∫ßn nh·∫•t: ${formatted}`;
    };

    updateNavTimestamp();
    setInterval(updateNavTimestamp, 30000);

    const chartConfigs = {
      'chart-overview-flow': {
        type: 'line',
        option: {
          tooltip: { trigger: 'axis' },
          grid: { left: '6%', right: '4%', top: '10%', bottom: '14%' },
          xAxis: { type: 'category', data: ['Tu·∫ßn 23', 'Tu·∫ßn 24', 'Tu·∫ßn 25', 'Tu·∫ßn 26', 'Tu·∫ßn 27', 'Tu·∫ßn 28', 'Tu·∫ßn 29'], axisLabel: { color: '#869fb5' }, axisLine: { lineStyle: { color: '#20384a' } } },
          yAxis: { type: 'value', axisLabel: { color: '#869fb5' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [
            { name: 'Doanh thu', type: 'line', smooth: true, data: [310, 328, 342, 361, 355, 370, 389], lineStyle: { color: '#3dd598', width: 3 }, areaStyle: { color: 'rgba(61, 213, 152, 0.15)' }, symbolSize: 9 },
            { name: 'K·∫ø ho·∫°ch', type: 'line', smooth: true, data: [300, 315, 332, 340, 350, 360, 372], lineStyle: { color: '#f4a259', width: 2, type: 'dashed' }, symbol: 'none' }
          ]
        }
      },
      'chart-overview-mix': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item', formatter: '{b}: {d}%' },
          legend: { top: 'bottom', textStyle: { color: '#a2b6cc' } },
          series: [{
            type: 'pie',
            radius: ['35%', '70%'],
            roseType: 'radius',
            data: [
              { value: 38, name: 'Khai th√°c' },
              { value: 24, name: 'Th∆∞∆°ng v·ª•' },
              { value: 20, name: 'MnR' },
              { value: 18, name: 'Kho b√£i' }
            ],
            label: { color: '#f5f7fb' }
          }]
        }
      },
      'chart-kt-gauge': {
        type: 'gauge',
        option: {
          series: [{
            type: 'gauge',
            startAngle: 180,
            endAngle: 0,
            min: 0,
            max: 120,
            radius: '90%',
            center: ['50%', '70%'],
            splitNumber: 6,
            axisLine: {
              lineStyle: {
                width: 12,
                color: [[0.8, '#10b981'], [0.95, '#f59e0b'], [1, '#ef4444']]
              }
            },
            pointer: { itemStyle: { color: '#1e293b' }, width: 4 },
            axisTick: { show: false },
            splitLine: { show: false },
            axisLabel: { show: false },
            detail: {
              valueAnimation: true,
              formatter: '{value}%',
              color: '#1e293b',
              fontSize: 24,
              fontWeight: 700,
              offsetCenter: [0, '-10%']
            },
            data: [{ value: 102.5, name: 'KPI: 153 t·ª∑' }],
            title: { show: true, offsetCenter: [0, '30%'], fontSize: 11, color: '#64748b' }
          }]
        }
      },
      'chart-kt-finance': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: ['Doanh thu', 'Chi ph√≠', 'L·ª£i nhu·∫≠n'] },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-kt-revenue-type': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-kt-cost-structure': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-kt-bulk-revenue': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item' },
          series: [{ type: 'pie', radius: ['40%', '70%'], data: [] }]
        }
      },
      'chart-kt-barge-type': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item' },
          series: [{ type: 'pie', radius: '60%', data: [] }]
        }
      },
      'chart-kt-top-customers': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          xAxis: { type: 'value' },
          yAxis: { type: 'category', data: [] },
          series: []
        }
      },
      'chart-tv-finance': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-tv-revenue-type': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          xAxis: { type: 'category', data: [] },
          yAxis: [{ type: 'value' }, { type: 'value' }],
          series: []
        }
      },
      'chart-tv-volume-pie': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item' },
          series: [{ type: 'pie', radius: ['40%', '70%'], data: [] }]
        }
      },
      'chart-tv-heatmap': {
        type: 'heatmap',
        option: {
          tooltip: { trigger: 'item' },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'category', data: [] },
          series: []
        }
      },
      'chart-tv-truck-pie': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item' },
          series: [{ type: 'pie', radius: ['40%', '70%'], data: [] }]
        }
      },
      'chart-khaithac-route': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          grid: { left: '4%', right: '4%', bottom: '10%', top: '10%' },
          xAxis: { type: 'category', data: ['SGN-HKG', 'SGN-SIN', 'HPH-SGN', 'SGN-KHH', 'HPH-NGB', 'DAD-SGN'], axisLabel: { color: '#8fa6bc' } },
          yAxis: { type: 'value', axisLabel: { color: '#8fa6bc' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [{
            data: [126, 112, 134, 92, 87, 96],
            type: 'bar',
            itemStyle: { color: '#4c6ef5', borderRadius: [6, 6, 0, 0] }
          }]
        }
      },
      'chart-khaithac-load': {
        type: 'radar',
        option: {
          tooltip: {},
          radar: {
            indicator: [
              { name: '√Åp l·ª±c slot', max: 100 },
              { name: 'Gi·ªù c·∫£ng', max: 100 },
              { name: 'Chi ph√≠', max: 100 },
              { name: 'T·ª∑ l·ªá ƒë·∫ßy', max: 100 },
              { name: 'ƒê·ªô tin c·∫≠y', max: 100 }
            ],
            splitLine: { lineStyle: { color: '#132534' } },
            axisName: { color: '#b1c3d6' }
          },
          series: [{ type: 'radar', data: [{ value: [78, 62, 55, 91, 86], name: 'Tuy·∫øn tr·ªçng y·∫øu', areaStyle: { color: 'rgba(244, 162, 89, 0.25)' }, lineStyle: { color: '#f4a259' } }] }]
        }
      },
      'chart-thuongvu-pipeline': {
        type: 'funnel',
        option: {
          tooltip: { trigger: 'item', formatter: '{b}: {c} t·ª∑ ‚Ç´' },
          series: [{
            type: 'funnel',
            left: '5%',
            top: 20,
            width: '90%',
            min: 10,
            max: 140,
            data: [
              { value: 140, name: 'Lead x√°c nh·∫≠n' },
              { value: 112, name: 'Kh·∫£o s√°t' },
              { value: 96, name: 'Ch√†o gi√°' },
              { value: 76, name: 'ƒê√†m ph√°n' },
              { value: 58, name: 'K√Ω k·∫øt' }
            ],
            label: { color: '#f5f7fb' }
          }]
        }
      },
      'chart-thuongvu-margin': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis', formatter: '{b}: {c}%' },
          grid: { left: '6%', right: '4%', bottom: '12%', top: '10%' },
          xAxis: { type: 'category', data: ['B√°n l·∫ª', 'CN n·∫∑ng', 'N√¥ng s·∫£n', 'Th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠', '√î t√¥'], axisLabel: { color: '#9eb0c4' } },
          yAxis: { type: 'value', axisLabel: { color: '#9eb0c4' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [{ type: 'line', data: [21, 18, 24, 28, 16], smooth: true, lineStyle: { color: '#3dd598', width: 3 }, areaStyle: { color: 'rgba(61, 213, 152, 0.25)' }, symbol: 'circle', symbolSize: 9 }]
        }
      },
      'chart-mnr-cost': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis', formatter: '{b}: {c} t·ª∑ ‚Ç´' },
          grid: { left: '5%', right: '4%', bottom: '8%', top: '10%' },
          xAxis: { type: 'category', data: ['Hi·ªáp Ph∆∞·ªõc', 'Tr·∫£ng Bom', 'ƒê√¨nh V≈©', 'S√≥ng Th·∫ßn', 'V√¢n ƒê·ªìn'], axisLabel: { color: '#8ea2b8' } },
          yAxis: { type: 'value', axisLabel: { color: '#8ea2b8' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [{ type: 'bar', data: [11.6, 9.8, 12.4, 13.1, 8.7], itemStyle: { color: '#f25f5c', borderRadius: 8 } }]
        }
      },
      'chart-mnr-finance': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: [] },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-mnr-cost-structure': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          grid: { left: '15%', right: '4%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value' },
          yAxis: { type: 'category', data: [] },
          series: []
        }
      },
      'chart-mnr-revenue-type': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: [] },
          xAxis: { type: 'category', data: [] },
          yAxis: [{ type: 'value' }, { type: 'value' }],
          series: []
        }
      },
      'chart-mnr-status-pie': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item' },
          series: [{ type: 'pie', radius: ['40%', '70%'], data: [] }]
        }
      },
      'chart-mnr-input-trend': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: [] },
          xAxis: { type: 'category', data: [] },
          yAxis: [{ type: 'value' }, { type: 'value' }],
          series: []
        }
      },
      'chart-mnr-top-customers': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          grid: { left: '15%', right: '8%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value' },
          yAxis: { type: 'category', data: [] },
          series: []
        }
      },
      'chart-mnr-turnaround': {
        type: 'line',
        option: {
          tooltip: { trigger: 'axis' },
          grid: { left: '6%', right: '4%', bottom: '12%', top: '10%' },
          xAxis: { type: 'category', data: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'], axisLabel: { color: '#8ea2b8' } },
          yAxis: { type: 'value', axisLabel: { color: '#8ea2b8' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [{ type: 'line', data: [42, 41, 39, 38, 37, 35, 34], smooth: true, lineStyle: { color: '#4c6ef5', width: 3 }, symbol: 'circle', symbolSize: 9 }]
        }
      },
      'chart-kb-finance': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: [] },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-kb-cost-structure': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          grid: { left: '15%', right: '4%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value' },
          yAxis: { type: 'category', data: [] },
          series: []
        }
      },
      'chart-kb-revenue-service': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: [] },
          xAxis: { type: 'category', data: [] },
          yAxis: [{ type: 'value' }, { type: 'value' }],
          series: []
        }
      },
      'chart-kb-customer-revenue': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          grid: { left: '15%', right: '8%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value' },
          yAxis: { type: 'category', data: [] },
          series: []
        }
      },
      'chart-kb-heatmap': {
        type: 'heatmap',
        option: {
          tooltip: { position: 'top' },
          grid: { height: '60%', top: '10%', left: '20%' },
          xAxis: { type: 'category', data: [], splitArea: { show: true } },
          yAxis: { type: 'category', data: [], splitArea: { show: true } },
          visualMap: { min: 0, max: 100, calculable: true, orient: 'horizontal', left: 'center', bottom: '5%' },
          series: [{ type: 'heatmap', data: [], label: { show: true } }]
        }
      },
      'chart-khobai-occupancy': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis', formatter: '{b}: {c}%' },
          dataset: { source: [
            ['Khu v·ª±c', 'T·ª∑ l·ªá'],
            ['Mi·ªÅn B·∫Øc', 76],
            ['Mi·ªÅn Trung', 69],
            ['Mi·ªÅn Nam', 88],
            ['Campuchia', 62],
            ['L√†o', 54]
          ] },
          xAxis: { type: 'category', axisLabel: { color: '#94a7bb' } },
          yAxis: { axisLabel: { color: '#94a7bb' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [{ type: 'bar', encode: { x: 'Khu v·ª±c', y: 'T·ª∑ l·ªá' }, itemStyle: { color: '#3dd598', borderRadius: 6 } }]
        }
      },
      'chart-khobai-aging': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis', formatter: '{b}: {c} t·ª∑ ‚Ç´' },
          grid: { left: '8%', right: '6%', bottom: '12%', top: '10%' },
          xAxis: { type: 'value', axisLabel: { color: '#98acbf' }, splitLine: { lineStyle: { color: '#132534' } } },
          yAxis: { type: 'category', data: ['H√†ng l·∫°nh', 'Ph√¥i th√©p', 'G·ªó', 'H√≥a ch·∫•t', 'Retail'], axisLabel: { color: '#98acbf' } },
          series: [{ type: 'bar', data: [42, 28, 19, 15, 22], itemStyle: { color: '#f4a259', borderRadius: 6 }, label: { show: true, position: 'right', formatter: '{c}' } }]
        }
      },
      'chart-xnt-timeseries': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: ['Nh·∫≠p', 'Xu·∫•t', 'T·ªìn'] },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-xnt-category': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item' },
          series: [{ type: 'pie', radius: ['40%', '70%'], data: [] }]
        }
      },
      'chart-xnt-fulfillment': {
        type: 'line',
        option: {
          tooltip: { trigger: 'axis' },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'value' },
          series: []
        }
      },
      'chart-xnt-heatmap': {
        type: 'heatmap',
        option: {
          tooltip: { position: 'top' },
          grid: { left: 100, right: 40, top: 20, bottom: 60 },
          xAxis: { type: 'category', data: [] },
          yAxis: { type: 'category', data: [] },
          visualMap: { min: 0, max: 150 },
          series: [{ type: 'heatmap', data: [] }]
        }
      },
      'chart-xnt-dept': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: ['K·∫ø ho·∫°ch', 'Th·ª±c t·∫ø'] },
          xAxis: { type: 'value' },
          yAxis: { type: 'category', data: [] },
          series: []
        }
      },
      'chart-suachua-sla': {
        type: 'line',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: ['Mi·ªÅn B·∫Øc', 'Mi·ªÅn Trung', 'Mi·ªÅn Nam'], textStyle: { color: '#9fb2c6' } },
          xAxis: { type: 'category', data: ['Tu·∫ßn 23', 'Tu·∫ßn 24', 'Tu·∫ßn 25', 'Tu·∫ßn 26', 'Tu·∫ßn 27'], axisLabel: { color: '#8fa2b8' } },
          yAxis: { type: 'value', axisLabel: { color: '#8fa2b8' }, splitLine: { lineStyle: { color: '#132534' } }, max: 100 },
          series: [
            { name: 'Mi·ªÅn B·∫Øc', type: 'line', data: [89, 87, 85, 83, 82], smooth: true, lineStyle: { color: '#f25f5c' } },
            { name: 'Mi·ªÅn Trung', type: 'line', data: [93, 92, 91, 90, 91], smooth: true, lineStyle: { color: '#f4a259' } },
            { name: 'Mi·ªÅn Nam', type: 'line', data: [95, 96, 95, 94, 95], smooth: true, lineStyle: { color: '#3dd598' } }
          ]
        }
      },
      'chart-suachua-issues': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item', formatter: '{b}: {d}%' },
          series: [{
            type: 'pie',
            radius: ['35%', '70%'],
            avoidLabelOverlap: false,
            data: [
              { value: 38, name: 'ƒêi·ªán - ƒëi·ªÅu khi·ªÉn' },
              { value: 26, name: 'H·ªá th·ªëng l·∫°nh' },
              { value: 18, name: 'ƒê·ªông l·ª±c' },
              { value: 12, name: 'Khung v·ªè' },
              { value: 6, name: 'Kh√°c' }
            ],
            label: { color: '#f5f7fb' }
          }]
        }
      },
      'chart-rong-flow': {
        type: 'line',
        option: {
          tooltip: { trigger: 'axis' },
          legend: { data: ['Xu·∫•t', 'Nh·∫≠p'], textStyle: { color: '#9db1c5' } },
          xAxis: { type: 'category', data: ['SGN', 'HPH', 'DAD', 'DNH', 'VDO'], axisLabel: { color: '#9db1c5' } },
          yAxis: { type: 'value', axisLabel: { color: '#9db1c5' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [
            { name: 'Xu·∫•t', type: 'line', data: [280, 190, 120, 110, 90], lineStyle: { color: '#f25f5c' }, symbol: 'circle', symbolSize: 9 },
            { name: 'Nh·∫≠p', type: 'line', data: [180, 230, 150, 80, 70], lineStyle: { color: '#4c6ef5' }, symbol: 'circle', symbolSize: 9 }
          ]
        }
      },
      'chart-rong-backlog': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis' },
          xAxis: { type: 'category', data: ['Dry 20', 'Dry 40', 'Reefer', 'Tank', 'Flat rack'], axisLabel: { color: '#9db1c5' } },
          yAxis: { type: 'value', axisLabel: { color: '#9db1c5' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [{ type: 'bar', data: [62, 48, 34, 18, 12], itemStyle: { color: '#f4a259', borderRadius: 8 } }]
        }
      },
      'chart-customer-touch': {
        type: 'bar',
        option: {
          tooltip: { trigger: 'axis', formatter: '{b}: {c}/5' },
          grid: { left: '8%', right: '6%', bottom: '10%', top: '10%' },
          xAxis: { type: 'category', data: ['Booking', 'Theo d√µi', 'H·ªó tr·ª£', 'H√≥a ƒë∆°n', 'Khi·∫øu n·∫°i'], axisLabel: { color: '#9fb2c6' } },
          yAxis: { min: 3, max: 5, axisLabel: { color: '#9fb2c6' }, splitLine: { lineStyle: { color: '#132534' } } },
          series: [{ type: 'bar', data: [4.6, 4.4, 4.8, 4.3, 4.1], itemStyle: { color: '#3dd598', borderRadius: 6 } }]
        }
      },
      'chart-customer-seg': {
        type: 'pie',
        option: {
          tooltip: { trigger: 'item', formatter: '{b}: {d}%' },
          series: [{
            type: 'pie',
            radius: ['40%', '75%'],
            data: [
              { value: 38, name: 'Nh√≥m A - chi·∫øn l∆∞·ª£c' },
              { value: 35, name: 'Nh√≥m B - tƒÉng tr∆∞·ªüng' },
              { value: 19, name: 'Nh√≥m C - ti·ªÅm nƒÉng' },
              { value: 8, name: 'Nh√≥m D - theo d√µi' }
            ],
            label: { color: '#f5f7fb' }
          }]
        }
      },

      /* 3.2 Repair report charts (options set dynamically) */
      'chart-sc-timeseries': {
        type: 'mixed',
        option: {
          animationDuration: 350,
          tooltip: { trigger: 'axis' },
          legend: { 
            top: 0, 
            textStyle: { color: '#64748b', fontSize: 12 },
            data: ['S·ªë l·∫ßn', 'Chi ph√≠ (t·ª∑)']
          },
          grid: { left: 50, right: 50, top: 50, bottom: 40 },
          xAxis: { 
            type: 'category', 
            data: [], 
            axisLabel: { color: '#64748b', fontSize: 11 },
            axisLine: { lineStyle: { color: '#e2e8f0' } }
          },
          yAxis: [
            { 
              type: 'value', 
              name: 'S·ªë l·∫ßn',
              nameTextStyle: { color: '#64748b', fontSize: 11 },
              axisLabel: { color: '#64748b', fontSize: 11 }, 
              splitLine: { lineStyle: { color: '#f1f5f9' } },
              axisLine: { show: false }
            },
            { 
              type: 'value',
              name: 'Chi ph√≠ (t·ª∑)',
              nameTextStyle: { color: '#64748b', fontSize: 11 },
              axisLabel: { color: '#64748b', fontSize: 11 }, 
              splitLine: { show: false },
              axisLine: { show: false }
            }
          ],
          series: []
        }
      },
      'chart-sc-type': {
        type: 'pie',
        option: {
          animationDuration: 350,
          tooltip: { trigger: 'item', formatter: '{b}: {c} ({d}%)' },
          legend: { 
            bottom: 10, 
            textStyle: { color: '#64748b', fontSize: 11 },
            itemGap: 15
          },
          series: [{
            type: 'pie',
            radius: ['45%', '70%'],
            center: ['50%', '45%'],
            data: [],
            label: {
              show: true,
              formatter: '{d}%',
              fontSize: 11,
              color: '#334155',
              fontWeight: 600
            },
            labelLine: {
              show: true,
              length: 10,
              length2: 5
            },
            itemStyle: {
              borderRadius: 4,
              borderColor: '#fff',
              borderWidth: 2
            }
          }]
        }
      },
      'chart-sc-topissues': {
        type: 'bar',
        option: {
          animationDuration: 350,
          tooltip: { 
            trigger: 'axis', 
            axisPointer: { type: 'shadow' },
            formatter: '{b}: {c} l·∫ßn'
          },
          grid: { left: 140, right: 30, top: 20, bottom: 30 },
          xAxis: { 
            type: 'value', 
            axisLabel: { color: '#64748b', fontSize: 11 }, 
            splitLine: { lineStyle: { color: '#f1f5f9' } },
            axisLine: { show: false }
          },
          yAxis: { 
            type: 'category', 
            data: [], 
            axisLabel: { 
              color: '#334155',
              fontSize: 11,
              width: 130,
              overflow: 'truncate'
            },
            axisLine: { lineStyle: { color: '#e2e8f0' } },
            axisTick: { show: false }
          },
          series: [{
            type: 'bar',
            data: [],
            barWidth: 16,
            itemStyle: {
              borderRadius: [0, 6, 6, 0]
            }
          }]
        }
      },
      'chart-sc-heatmap': {
        type: 'heatmap',
        option: {
          animationDuration: 350,
          tooltip: {
            position: 'top',
            formatter: function(params) {
              return params.marker + params.name + ': <b>' + params.value[2] + '</b> l·∫ßn';
            }
          },
          grid: {
            left: 120,
            right: 40,
            top: 20,
            bottom: 80
          },
          xAxis: {
            type: 'category',
            data: [],
            position: 'bottom',
            axisLabel: {
              color: '#334155',
              fontSize: 11,
              interval: 0,
              rotate: 25
            },
            axisLine: { lineStyle: { color: '#e2e8f0' } },
            axisTick: { show: false },
            splitArea: { show: false }
          },
          yAxis: {
            type: 'category',
            data: [],
            position: 'left',
            axisLabel: {
              color: '#1e293b',
              fontSize: 13,
              fontWeight: 600
            },
            axisLine: { lineStyle: { color: '#e2e8f0' } },
            axisTick: { show: false },
            splitArea: { show: false }
          },
          visualMap: {
            min: 0,
            max: 20,
            calculable: true,
            orient: 'horizontal',
            left: 'center',
            bottom: 0,
            inRange: {
              color: ['#d1fae5', '#6ee7b7', '#34d399', '#10b981', '#059669', '#047857']
            },
            text: ['Nhi·ªÅu', 'Th·∫•p'],
            textStyle: {
              color: '#64748b',
              fontSize: 11
            }
          },
          series: [{
            type: 'heatmap',
            data: [],
            itemStyle: {
              borderColor: '#fff',
              borderWidth: 2
            },
            label: {
              show: true,
              fontSize: 13,
              color: '#1e293b',
              fontWeight: 700
            },
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.3)'
              }
            }
          }]
        }
      }
    };

    const chartsById = {};

    const charts = Object.entries(chartConfigs).map(([id, config]) => {
      const el = document.getElementById(id);
      if (!el) {
        chartsById[id] = null;
        return null;
      }
      let chart = echarts.getInstanceByDom(el);
      if (!chart) {
        chart = echarts.init(el);
      }
      chart.setOption(config.option);
      chartsById[id] = chart;
      return chart;
    }).filter(Boolean);

    // Helper function to get or initialize chart
    const getChart = (chartId) => {
      if (chartId in chartsById) {
        return chartsById[chartId];
      }
      
      const el = document.getElementById(chartId);
      if (!el) {
        chartsById[chartId] = null;
        return null;
      }
      
      const config = chartConfigs[chartId];
      if (!config) {
        chartsById[chartId] = null;
        return null;
      }
      
      try {
        let chart = echarts.getInstanceByDom(el);
        if (!chart) {
          chart = echarts.init(el);
        }
        chart.setOption(config.option);
        chartsById[chartId] = chart;
        return chart;
      } catch (error) {
        console.error(`Error initializing chart ${chartId}:`, error);
        chartsById[chartId] = null;
        return null;
      }
    };

    const byId = (id) => document.getElementById(id);
    const setText = (id, value) => {
      const el = byId(id);
      if (el) el.textContent = value;
    };

    const formatMonthLabel = (monthKey) => {
      const [y, m] = monthKey.split('-');
      return `Th√°ng ${m}/${y}`;
    };

    const formatBillion = (million) => {
      const billion = million / 1000;
      if (billion >= 10) return `${billion.toFixed(0)} t·ª∑`;
      return `${billion.toFixed(1)} t·ª∑`;
    };

    const formatMillions = (million) => `${Math.round(million).toLocaleString('vi-VN')}`;
    const formatDateVN = (d) => {
      const [y, m, day] = d.split('-');
      return `${day}/${m}/${y}`;
    };

    const toPercentDelta = (current, previous) => {
      if (!previous) return 0;
      return ((current - previous) / previous) * 100;
    };

    const clamp = (value, min, max) => Math.min(Math.max(value, min), max);

    const initThuongVuReport = () => {
      const tvFilterMonth = byId('tvFilterMonth');
      if (!tvFilterMonth) return;

      // D·ªØ li·ªáu fake
      const monthlyData = {
        '2026-01': { revenue: 89.5, revenuePrev: 82.3, cost: 65.8, profit: 23.7 },
        '2025-12': { revenue: 82.3, revenuePrev: 78.9, cost: 61.2, profit: 21.1 },
        '2025-11': { revenue: 78.9, revenuePrev: 75.4, cost: 59.5, profit: 19.4 },
        '2025-10': { revenue: 75.4, revenuePrev: 72.1, cost: 57.3, profit: 18.1 }
      };

      const serviceData = [
        { 
          id: 'cap-rong',
          name: 'C·∫•p r·ªóng', 
          volume: 4770, 
          revenue: 2577, 
          unitPrice: 0.54, 
          revPct: 51.6, 
          volPct: 53.7,
          children: [
            { name: '20\'', volume: 2850, revenue: 1425, unitPrice: 0.5, revPct: 28.5, volPct: 32.1 },
            { name: '40\'', volume: 1920, revenue: 1152, unitPrice: 0.6, revPct: 23.1, volPct: 21.6 }
          ]
        },
        { 
          id: 'ha-hang',
          name: 'H·∫° h√†ng', 
          volume: 2920, 
          revenue: 1792, 
          unitPrice: 0.61, 
          revPct: 35.9, 
          volPct: 32.9,
          children: [
            { name: '20\'', volume: 1680, revenue: 924, unitPrice: 0.55, revPct: 18.5, volPct: 18.9 },
            { name: '40\'', volume: 1240, revenue: 868, unitPrice: 0.7, revPct: 17.4, volPct: 14.0 }
          ]
        },
        { 
          id: 'tra-rong',
          name: 'Tr·∫£ r·ªóng', 
          volume: 1170, 
          revenue: 513, 
          unitPrice: 0.44, 
          revPct: 10.3, 
          volPct: 13.2,
          children: [
            { name: '20\'', volume: 720, revenue: 288, unitPrice: 0.4, revPct: 5.8, volPct: 8.1 },
            { name: '40\'', volume: 450, revenue: 225, unitPrice: 0.5, revPct: 4.5, volPct: 5.1 }
          ]
        },
        { 
          id: 'dich-vu-khac',
          name: 'D·ªãch v·ª• kh√°c', 
          volume: 15, 
          revenue: 118, 
          unitPrice: 7.9, 
          revPct: 2.4, 
          volPct: 0.2,
          children: []
        }
      ];

      const truckData = [
        { plate: '51A-12345', type: 'N·ªôi b·ªô', volume: 145, volumePrev: 138, revenue: 101.5, revenuePrev: 96.6 },
        { plate: '51B-23456', type: 'N·ªôi b·ªô', volume: 132, volumePrev: 128, revenue: 92.4, revenuePrev: 89.6 },
        { plate: '51C-34567', type: 'N·ªôi b·ªô', volume: 118, volumePrev: 115, revenue: 82.6, revenuePrev: 80.5 },
        { plate: '59A-45678', type: 'Thu√™ ngo√†i', volume: 95, volumePrev: 102, revenue: 76, revenuePrev: 81.6 },
        { plate: '59B-56789', type: 'Thu√™ ngo√†i', volume: 88, volumePrev: 92, revenue: 70.4, revenuePrev: 73.6 },
        { plate: '59C-67890', type: 'Thu√™ ngo√†i', volume: 82, volumePrev: 78, revenue: 65.6, revenuePrev: 62.4 },
        { plate: '79A-78901', type: 'N·ªôi b·ªô', volume: 76, volumePrev: 74, revenue: 53.2, revenuePrev: 51.8 },
        { plate: '79B-89012', type: 'Thu√™ ngo√†i', volume: 72, volumePrev: 75, revenue: 57.6, revenuePrev: 60 }
      ];

      const renderTVFinanceChart = () => {
        const chart = chartsById['chart-tv-finance'];
        if (!chart) return;

        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const revenue = [68, 72, 75, 75, 79, 82, 89];
        const cost = [52, 54, 57, 57, 59, 61, 66];
        const profit = revenue.map((r, i) => r - cost[i]);

        chart.setOption({
          tooltip: { trigger: 'axis' },
          legend: { data: ['Doanh thu', 'Chi ph√≠', 'L·ª£i nhu·∫≠n'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: months, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
          series: [
            { name: 'Doanh thu', type: 'bar', data: revenue, itemStyle: { color: '#3b82f6', borderRadius: [6, 6, 0, 0] }, barWidth: 16 },
            { name: 'Chi ph√≠', type: 'bar', data: cost, itemStyle: { color: '#ef4444', borderRadius: [6, 6, 0, 0] }, barWidth: 16 },
            { name: 'L·ª£i nhu·∫≠n', type: 'line', data: profit, lineStyle: { color: '#10b981', width: 3 }, itemStyle: { color: '#10b981' }, symbol: 'circle', symbolSize: 8 }
          ]
        });
      };

      const renderTVRevenueTypeChart = () => {
        const chart = chartsById['chart-tv-revenue-type'];
        if (!chart) return;

        const categories = ['C·∫•p r·ªóng', 'H·∫° h√†ng', 'D·ªãch v·ª• kh√°c', 'Trucking'];
        const actual = [25.8, 17.9, 1.2, 9.7];
        const kpi = [24, 18, 1.5, 10];
        const kpiPercent = actual.map((a, i) => ((a / kpi[i]) * 100).toFixed(1));

        chart.setOption({
          tooltip: { trigger: 'axis', formatter: (params) => {
            let res = params[0].axisValue + '<br/>';
            params.forEach(p => {
              res += `${p.marker} ${p.seriesName}: ${p.value}${p.seriesType === 'bar' ? ' t·ª∑' : '%'}<br/>`;
            });
            return res;
          }},
          legend: { data: ['Doanh thu', 'ƒê·∫°t KPI'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: categories, axisLabel: { color: '#64748b' } },
          yAxis: [
            { type: 'value', name: 'Doanh thu (t·ª∑)', axisLabel: { formatter: '{value}', color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
            { type: 'value', name: 'KPI (%)', min: 0, max: 150, axisLabel: { formatter: '{value}%', color: '#64748b' }, splitLine: { show: false } }
          ],
          series: [
            { name: 'Doanh thu', type: 'bar', data: actual, yAxisIndex: 0, itemStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{ offset: 0, color: '#3b82f6' }, { offset: 1, color: '#93c5fd' }]), borderRadius: [6, 6, 0, 0] }, barWidth: 35, label: { show: true, position: 'top', formatter: '{c} t·ª∑', color: '#1e293b', fontWeight: 600 } },
            { name: 'ƒê·∫°t KPI', type: 'line', data: kpiPercent.map(p => parseFloat(p)), yAxisIndex: 1, lineStyle: { color: '#10b981', width: 3 }, itemStyle: { color: '#10b981' }, symbol: 'circle', symbolSize: 8, label: { show: true, formatter: '{c}%', color: '#10b981', fontWeight: 600, position: 'top' } }
          ]
        });
      };

      const renderTVVolumePieChart = () => {
        const chart = chartsById['chart-tv-volume-pie'];
        if (!chart) return;

        const data = [
          { value: 32.1, name: 'C·∫•p r·ªóng' },
          { value: 33.0, name: 'H·∫° h√†ng' },
          { value: 13.2, name: 'Tr·∫£ r·ªóng' },
          { value: 21.5, name: 'D·ªãch v·ª• kh√°c' }
        ];

        chart.setOption({
          tooltip: { trigger: 'item', formatter: '{b}: {c}% ({d}%)' },
          legend: { orient: 'vertical', right: '10%', top: 'center', textStyle: { color: '#64748b' } },
          series: [{
            type: 'pie',
            radius: ['40%', '70%'],
            center: ['40%', '50%'],
            data: data,
            itemStyle: { borderRadius: 8, borderColor: '#fff', borderWidth: 2 },
            label: { show: true, formatter: '{b}\n{c}%', color: '#1e293b', fontWeight: 600 },
            emphasis: { itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)' } }
          }]
        });
      };

      let heatmapMode = 'volume';

      const renderTVHeatmapChart = () => {
        const chart = chartsById['chart-tv-heatmap'];
        if (!chart) return;

        const services = ['C·∫•p r·ªóng', 'H·∫° h√†ng', 'Tr·∫£ r·ªóng', 'D·ªãch v·ª• kh√°c'];
        const sizes = ['20\'', '40\'', 'T·ªïng'];
        
        const volumeData = [
          [0, 0, 2850], [0, 1, 1920], [0, 2, 4770],
          [1, 0, 1680], [1, 1, 1240], [1, 2, 2920],
          [2, 0, 720], [2, 1, 450], [2, 2, 1170],
          [3, 0, 8], [3, 1, 7], [3, 2, 15]
        ];

        const revenueData = [
          [0, 0, 1425], [0, 1, 1152], [0, 2, 2577],
          [1, 0, 924], [1, 1, 868], [1, 2, 1792],
          [2, 0, 288], [2, 1, 225], [2, 2, 513],
          [3, 0, 6], [3, 1, 5], [3, 2, 11]
        ];

        const data = heatmapMode === 'volume' ? volumeData : revenueData;
        const unit = heatmapMode === 'volume' ? 'cont' : 'tri·ªáu';
        const label = heatmapMode === 'volume' ? 'S·∫£n l∆∞·ª£ng' : 'Doanh thu';
        const maxVal = heatmapMode === 'volume' ? 5000 : 2700;

        chart.setOption({
          tooltip: { position: 'top', formatter: (params) => {
            if (params.data[1] === 2) return `${services[params.data[0]]} - T·ªïng<br/>${label}: ${params.data[2]} ${unit}`;
            return `${services[params.data[0]]} ${sizes[params.data[1]]}<br/>${label}: ${params.data[2]} ${unit}`;
          }},
          grid: { height: '60%', top: '10%', left: '20%' },
          xAxis: { type: 'category', data: sizes, splitArea: { show: true }, axisLabel: { color: '#64748b', fontWeight: (value) => value === 'T·ªïng' ? 700 : 400 } },
          yAxis: { type: 'category', data: services, splitArea: { show: true }, axisLabel: { color: '#64748b' } },
          visualMap: { min: 0, max: maxVal, calculable: true, orient: 'horizontal', left: 'center', bottom: '5%', inRange: { color: ['#f0f9ff', '#0284c7', '#0c4a6e'] } },
          series: [{
            type: 'heatmap',
            data: data,
            label: { show: true, formatter: '{c}', color: '#fff', fontWeight: 600 },
            emphasis: { itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.5)' } }
          }]
        });
      };

      const serviceExpandedState = {};

      const renderTVServiceTable = () => {
        const tbody = byId('tvTableService')?.querySelector('tbody');
        if (!tbody) return;

        let html = '';
        serviceData.forEach(item => {
          const hasChildren = item.children && item.children.length > 0;
          const isExpanded = serviceExpandedState[item.id];
          const expandIcon = hasChildren ? (isExpanded ? '‚ñº' : '‚ñ∂') : '';
          
          html += `
            <tr style="background: #f8fafc; cursor: ${hasChildren ? 'pointer' : 'default'};" ${hasChildren ? `onclick="toggleServiceRow('${item.id}')"` : ''}>
              <td><strong>${expandIcon} ${item.name}</strong></td>
              <td>${item.volume.toLocaleString('vi-VN')} cont</td>
              <td>${item.revenue.toFixed(1)} tri·ªáu</td>
              <td>${item.unitPrice.toFixed(2)}</td>
              <td style="color: ${item.revPct > 20 ? '#10b981' : '#64748b'}; font-weight: 600;">${item.revPct.toFixed(1)}%</td>
              <td style="color: ${item.volPct > 20 ? '#10b981' : '#64748b'}; font-weight: 600;">${item.volPct.toFixed(1)}%</td>
            </tr>
          `;
          
          if (hasChildren && isExpanded) {
            item.children.forEach(child => {
              html += `
                <tr class="child-row-${item.id}" style="background: #ffffff;">
                  <td style="padding-left: 40px;">${child.name}</td>
                  <td>${child.volume.toLocaleString('vi-VN')} cont</td>
                  <td>${child.revenue.toFixed(1)} tri·ªáu</td>
                  <td>${child.unitPrice.toFixed(2)}</td>
                  <td style="color: #64748b;">${child.revPct.toFixed(1)}%</td>
                  <td style="color: #64748b;">${child.volPct.toFixed(1)}%</td>
                </tr>
              `;
            });
          }
        });
        
        tbody.innerHTML = html;
      };

      window.toggleServiceRow = (id) => {
        serviceExpandedState[id] = !serviceExpandedState[id];
        renderTVServiceTable();
      };

      const renderTVTruckPieChart = () => {
        const chart = chartsById['chart-tv-truck-pie'];
        if (!chart) return;

        const internal = truckData.filter(t => t.type.includes('N·ªôi b·ªô'));
        const external = truckData.filter(t => t.type.includes('Thu√™ ngo√†i'));

        const internalRevenue = internal.reduce((sum, t) => sum + t.revenue, 0);
        const externalRevenue = external.reduce((sum, t) => sum + t.revenue, 0);
        const internalVolume = internal.reduce((sum, t) => sum + t.volume, 0);
        const externalVolume = external.reduce((sum, t) => sum + t.volume, 0);

        const data = [
          { value: internalRevenue, name: 'Xe n·ªôi b·ªô', volume: internalVolume },
          { value: externalRevenue, name: 'Thu√™ ngo√†i', volume: externalVolume }
        ];

        chart.setOption({
          tooltip: { 
            trigger: 'item', 
            formatter: (params) => `${params.name}<br/>Doanh thu: ${params.value.toFixed(1)} tri·ªáu (${params.percent}%)<br/>S·∫£n l∆∞·ª£ng: ${params.data.volume} chuy·∫øn`
          },
          legend: { orient: 'vertical', right: '10%', top: 'center', textStyle: { color: '#64748b' } },
          series: [{
            type: 'pie',
            radius: ['40%', '70%'],
            center: ['40%', '50%'],
            data: data,
            itemStyle: { borderRadius: 8, borderColor: '#fff', borderWidth: 2 },
            color: ['#3b82f6', '#f97316'],
            label: { show: true, formatter: '{b}\n{c} tri·ªáu\n{volume} chuy·∫øn', color: '#1e293b', fontWeight: 600 },
            emphasis: { itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)' } }
          }]
        });
      };

      const renderTVTruckTable = () => {
        const tbody = byId('tvTableTruck')?.querySelector('tbody');
        if (!tbody) return;

        tbody.innerHTML = truckData.map(item => {
          const volChange = ((item.volume - item.volumePrev) / item.volumePrev * 100);
          const revChange = ((item.revenue - item.revenuePrev) / item.revenuePrev * 100);
          return `
            <tr>
              <td><strong>${item.plate}</strong> <span style="color: #64748b; font-size: 0.85rem;">(${item.type})</span></td>
              <td>${item.volume} chuy·∫øn</td>
              <td style="color: ${volChange >= 0 ? '#10b981' : '#ef4444'}; font-weight: 600;">
                ${volChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(volChange).toFixed(1)}%
              </td>
              <td>${item.revenue.toFixed(1)} tri·ªáu</td>
              <td style="color: ${revChange >= 0 ? '#10b981' : '#ef4444'}; font-weight: 600;">
                ${revChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(revChange).toFixed(1)}%
              </td>
            </tr>
          `;
        }).join('');
      };

      const render = () => {
        renderTVFinanceChart();
        renderTVRevenueTypeChart();
        renderTVHeatmapChart();
        renderTVServiceTable();
        renderTVTruckPieChart();
        renderTVTruckTable();
      };

      tvFilterMonth.addEventListener('change', render);

      // X·ª≠ l√Ω button heatmap
      const tvBtnHeatmapVolume = byId('tvBtnHeatmapVolume');
      const tvBtnHeatmapRevenue = byId('tvBtnHeatmapRevenue');
      
      if (tvBtnHeatmapVolume && tvBtnHeatmapRevenue) {
        tvBtnHeatmapVolume.addEventListener('click', () => {
          heatmapMode = 'volume';
          tvBtnHeatmapVolume.style.background = '#3b82f6';
          tvBtnHeatmapVolume.style.color = 'white';
          tvBtnHeatmapRevenue.style.background = '#e2e8f0';
          tvBtnHeatmapRevenue.style.color = '#64748b';
          renderTVHeatmapChart();
        });

        tvBtnHeatmapRevenue.addEventListener('click', () => {
          heatmapMode = 'revenue';
          tvBtnHeatmapRevenue.style.background = '#3b82f6';
          tvBtnHeatmapRevenue.style.color = 'white';
          tvBtnHeatmapVolume.style.background = '#e2e8f0';
          tvBtnHeatmapVolume.style.color = '#64748b';
          renderTVHeatmapChart();
        });
      }

      render();
    };

    const initMnRReport = () => {
      const mnrFilterMonth = byId('mnrFilterMonth');
      if (!mnrFilterMonth) return;

      // D·ªØ li·ªáu fake
      const monthlyData = {
        '2026-01': { revenue: 45.8, revenuePrev: 43.5, cost: 32.4, costPrev: 31.2, profit: 13.4, profitPrev: 12.3, kpi: 105.3, contTotal: 3245, contTotalPrev: 3028, repairRate: 87.6, repairRatePrev: 85.6 },
        '2025-12': { revenue: 43.5, revenuePrev: 41.8, cost: 31.2, costPrev: 30.1, profit: 12.3, profitPrev: 11.7, kpi: 102.1, contTotal: 3028, contTotalPrev: 2915, repairRate: 85.6, repairRatePrev: 84.2 },
        '2025-11': { revenue: 41.8, revenuePrev: 39.6, cost: 30.1, costPrev: 28.9, profit: 11.7, profitPrev: 10.7, kpi: 98.7, contTotal: 2915, contTotalPrev: 2801, repairRate: 84.2, repairRatePrev: 83.1 },
        '2025-10': { revenue: 39.6, revenuePrev: 38.2, cost: 28.9, costPrev: 27.8, profit: 10.7, profitPrev: 10.4, kpi: 95.3, contTotal: 2801, contTotalPrev: 2698, repairRate: 83.1, repairRatePrev: 81.9 }
      };

      const contDetailData = [
        { code: '20DC', revenue: 12.5, volume: 1420, revPct: 27.3, volPct: 43.8 },
        { code: '40HC', revenue: 15.8, volume: 1050, revPct: 34.5, volPct: 32.4 },
        { code: '40DC', revenue: 8.2, volume: 485, revPct: 17.9, volPct: 14.9 },
        { code: '20RF', revenue: 5.6, volume: 185, revPct: 12.2, volPct: 5.7 },
        { code: '40RF', revenue: 3.7, volume: 105, revPct: 8.1, volPct: 3.2 }
      ];

      const updateKPIs = () => {
        const selectedMonth = mnrFilterMonth.value;
        const data = monthlyData[selectedMonth];
        
        byId('mnrRevenueValue').textContent = `${data.revenue} t·ª∑`;
        byId('mnrRevenueTrend').textContent = `‚Üë ${((data.revenue - data.revenuePrev) / data.revenuePrev * 100).toFixed(1)}%`;
        byId('mnrRevenueTrend').style.color = data.revenue >= data.revenuePrev ? '#10b981' : '#ef4444';
        
        byId('mnrCostValue').textContent = `${data.cost} t·ª∑`;
        byId('mnrCostTrend').textContent = `‚Üë ${((data.cost - data.costPrev) / data.costPrev * 100).toFixed(1)}%`;
        byId('mnrCostTrend').style.color = data.cost >= data.costPrev ? '#ef4444' : '#10b981';
        
        byId('mnrProfitValue').textContent = `${data.profit} t·ª∑`;
        byId('mnrProfitTrend').textContent = `‚Üë ${((data.profit - data.profitPrev) / data.profitPrev * 100).toFixed(1)}%`;
        byId('mnrProfitTrend').style.color = data.profit >= data.profitPrev ? '#10b981' : '#ef4444';
        
        byId('mnrKpiValue').textContent = `${data.kpi}%`;
        
        byId('mnrContValue').textContent = data.contTotal.toLocaleString('vi-VN');
        byId('mnrContTrend').textContent = `‚Üë ${((data.contTotal - data.contTotalPrev) / data.contTotalPrev * 100).toFixed(1)}%`;
        
        byId('mnrRepairRateValue').textContent = `${data.repairRate}%`;
        byId('mnrRepairRateTrend').textContent = `‚Üë ${(data.repairRate - data.repairRatePrev).toFixed(1)}%`;
      };

      const renderMnRFinanceChart = () => {
        const chart = getChart('chart-mnr-finance');
        if (!chart) return;

        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const revenue = [35.2, 37.1, 38.6, 39.6, 41.8, 43.5, 45.8];
        const cost = [25.8, 26.5, 27.4, 28.9, 30.1, 31.2, 32.4];
        const profit = revenue.map((r, i) => r - cost[i]);

        chart.setOption({
          tooltip: { trigger: 'axis' },
          legend: { data: ['Doanh thu', 'Chi ph√≠', 'L·ª£i nhu·∫≠n'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: months, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' } },
          series: [
            { name: 'Doanh thu', type: 'bar', data: revenue, itemStyle: { color: '#3b82f6' } },
            { name: 'Chi ph√≠', type: 'bar', data: cost, itemStyle: { color: '#f97316' } },
            { name: 'L·ª£i nhu·∫≠n', type: 'line', data: profit, itemStyle: { color: '#10b981' }, lineStyle: { width: 3 } }
          ]
        });
      };

      const renderMnRCostStructureChart = () => {
        const chart = getChart('chart-mnr-cost-structure');
        if (!chart) return;

        const categories = ['V·∫≠t t∆∞', 'Nh√¢n c√¥ng', 'Kh·∫•u hao', 'Chi ph√≠ kh√°c'];
        const values = [18.5, 8.9, 3.2, 1.8];
        const prevValues = [17.2, 8.6, 3.1, 2.3];

        chart.setOption({
          tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
          grid: { left: '15%', right: '4%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' } },
          yAxis: { type: 'category', data: categories, axisLabel: { color: '#64748b' } },
          series: [{
            type: 'bar',
            data: values,
            itemStyle: { color: '#3b82f6' },
            label: {
              show: true,
              position: 'right',
              formatter: (params) => {
                const change = ((values[params.dataIndex] - prevValues[params.dataIndex]) / prevValues[params.dataIndex] * 100);
                const arrow = change >= 0 ? '‚Üë' : '‚Üì';
                return `{value|${params.value} t·ª∑} {change|${arrow} ${Math.abs(change).toFixed(1)}%}`;
              },
              rich: {
                value: { color: '#1e293b', fontWeight: 600, fontSize: 13 },
                change: { color: '#64748b', fontSize: 11, padding: [0, 0, 0, 8] }
              }
            }
          }]
        });
      };

      const renderMnRRevenueTypeChart = () => {
        const chart = getChart('chart-mnr-revenue-type');
        if (!chart) return;

        const categories = ['20DC', '40HC', '40DC', '20RF', '40RF'];
        const revenue = [12.5, 15.8, 8.2, 5.6, 3.7];
        const kpiRate = [108.5, 112.3, 95.6, 102.8, 98.4];

        chart.setOption({
          tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
          legend: { data: ['Doanh thu', 'T·ª∑ l·ªá KPI'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '8%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: categories, axisLabel: { color: '#64748b' } },
          yAxis: [
            { type: 'value', name: 'Doanh thu (t·ª∑)', position: 'left', axisLabel: { formatter: '{value}', color: '#64748b' } },
            { type: 'value', name: 'KPI (%)', position: 'right', axisLabel: { formatter: '{value}%', color: '#64748b' } }
          ],
          series: [
            {
              name: 'Doanh thu',
              type: 'bar',
              data: revenue,
              itemStyle: { color: '#3b82f6' },
              label: { show: true, position: 'top', formatter: '{c} t·ª∑', color: '#1e293b', fontWeight: 600 }
            },
            {
              name: 'T·ª∑ l·ªá KPI',
              type: 'line',
              yAxisIndex: 1,
              data: kpiRate,
              itemStyle: { color: '#10b981' },
              lineStyle: { width: 2 },
              label: { show: true, formatter: '{c}%', color: '#10b981', fontWeight: 600 }
            }
          ]
        });
      };

      const renderMnRStatusPieChart = () => {
        const chart = getChart('chart-mnr-status-pie');
        if (!chart) return;

        const data = [
          { value: 2843, name: 'ƒê√£ s·ª≠a xong' },
          { value: 285, name: 'ƒêang s·ª≠a' },
          { value: 117, name: 'Ch·ªù v·∫≠t t∆∞' }
        ];

        chart.setOption({
          tooltip: { trigger: 'item', formatter: '{b}: {c} cont ({d}%)' },
          legend: { orient: 'vertical', right: '10%', top: 'center', textStyle: { color: '#64748b' } },
          series: [{
            type: 'pie',
            radius: ['40%', '70%'],
            center: ['40%', '50%'],
            data: data,
            itemStyle: { borderRadius: 8, borderColor: '#fff', borderWidth: 2 },
            color: ['#10b981', '#f97316', '#ef4444'],
            label: { show: true, formatter: '{b}\n{c} cont', color: '#1e293b', fontWeight: 600 },
            emphasis: { itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)' } }
          }]
        });
      };

      const renderMnRInputTrendChart = () => {
        const chart = getChart('chart-mnr-input-trend');
        if (!chart) return;

        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const completed = [2245, 2318, 2375, 2432, 2455, 2593, 2842];
        const pending = [453, 438, 426, 413, 460, 435, 403];

        chart.setOption({
          tooltip: { 
            trigger: 'axis',
            formatter: (params) => {
              const total = params[0].value + params[1].value;
              const pendingPct = (params[1].value / total * 100).toFixed(1);
              return `${params[0].axisValue}<br/>` +
                     `${params[0].marker}${params[0].seriesName}: ${params[0].value} cont<br/>` +
                     `${params[1].marker}${params[1].seriesName}: ${params[1].value} cont (${pendingPct}%)<br/>` +
                     `<strong>T·ªïng: ${total} cont</strong>`;
            }
          },
          legend: { data: ['ƒê√£ s·ª≠a xong', 'T·ªìn ch∆∞a s·ª≠a'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: months, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'value', name: 'S·ªë l∆∞·ª£ng (cont)', axisLabel: { color: '#64748b' } },
          series: [
            {
              name: 'ƒê√£ s·ª≠a xong',
              type: 'bar',
              stack: 'total',
              data: completed,
              itemStyle: { color: '#10b981' },
              label: { show: false }
            },
            {
              name: 'T·ªìn ch∆∞a s·ª≠a',
              type: 'bar',
              stack: 'total',
              data: pending,
              itemStyle: { color: '#ef4444' },
              label: { 
                show: true, 
                position: 'top',
                formatter: (params) => {
                  const total = completed[params.dataIndex] + pending[params.dataIndex];
                  return total;
                },
                color: '#1e293b',
                fontWeight: 600
              }
            }
          ]
        });
      };

      const renderMnRTopCustomersChart = () => {
        const chart = getChart('chart-mnr-top-customers');
        if (!chart) return;

        const customers = ['Maersk Line', 'MSC', 'CMA CGM', 'COSCO', 'Evergreen', 'OOCL', 'Hapag-Lloyd', 'ONE'];
        const volumes = [685, 542, 418, 395, 328, 285, 246, 201];

        chart.setOption({
          tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
          grid: { left: '15%', right: '8%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value', axisLabel: { formatter: '{value} cont', color: '#64748b' } },
          yAxis: { type: 'category', data: customers, axisLabel: { color: '#64748b' } },
          series: [{
            type: 'bar',
            data: volumes,
            itemStyle: { color: '#3b82f6' },
            label: { show: true, position: 'right', formatter: '{c} cont', color: '#1e293b', fontWeight: 600 }
          }]
        });
      };

      const renderMnRDetailTable = () => {
        const tbody = byId('mnrTableDetail')?.querySelector('tbody');
        if (!tbody) return;

        tbody.innerHTML = contDetailData.map(item => `
          <tr>
            <td><strong>${item.code}</strong></td>
            <td>${item.revenue.toFixed(1)} tri·ªáu</td>
            <td>${item.volume.toLocaleString('vi-VN')} cont</td>
            <td style="color: ${item.revPct > 25 ? '#10b981' : '#64748b'}; font-weight: 600;">${item.revPct.toFixed(1)}%</td>
            <td style="color: ${item.volPct > 25 ? '#10b981' : '#64748b'}; font-weight: 600;">${item.volPct.toFixed(1)}%</td>
          </tr>
        `).join('');
      };

      const render = () => {
        updateKPIs();
        renderMnRFinanceChart();
        renderMnRCostStructureChart();
        renderMnRRevenueTypeChart();
        renderMnRStatusPieChart();
        renderMnRInputTrendChart();
        renderMnRTopCustomersChart();
        renderMnRDetailTable();
      };

      mnrFilterMonth.addEventListener('change', render);
      render();
    };

    const initQuanLyRongReport = () => {
      const qlrFilterMonth = byId('qlrFilterMonth');
      if (!qlrFilterMonth) return;

      // D·ªØ li·ªáu fake
      const monthlyData = {
        '2026-01': { 
          import: 2845, importPrev: 2625, 
          export: 2612, exportPrev: 2698,
          stock: 4320, stockPrev: 4100,
          capacity: 76.2
        },
        '2025-12': { 
          import: 2625, importPrev: 2450, 
          export: 2698, exportPrev: 2580,
          stock: 4100, stockPrev: 3950,
          capacity: 72.4
        },
        '2025-11': { 
          import: 2450, importPrev: 2320, 
          export: 2580, exportPrev: 2490,
          stock: 3950, stockPrev: 3820,
          capacity: 69.8
        },
        '2025-10': { 
          import: 2320, importPrev: 2180, 
          export: 2490, exportPrev: 2410,
          stock: 3820, stockPrev: 3680,
          capacity: 67.5
        }
      };

      const updateKPIs = () => {
        const selectedMonth = qlrFilterMonth.value;
        const data = monthlyData[selectedMonth];
        
        byId('qlrKpiImport').textContent = `${data.import.toLocaleString('vi-VN')} cont`;
        const importChange = ((data.import - data.importPrev) / data.importPrev * 100).toFixed(1);
        byId('qlrKpiImportTrend').textContent = `${importChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(importChange)}% vs th√°ng tr∆∞·ªõc`;
        byId('qlrKpiImportTrend').style.color = importChange >= 0 ? '#10b981' : '#ef4444';
        
        byId('qlrKpiExport').textContent = `${data.export.toLocaleString('vi-VN')} cont`;
        const exportChange = ((data.export - data.exportPrev) / data.exportPrev * 100).toFixed(1);
        byId('qlrKpiExportTrend').textContent = `${exportChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(exportChange)}% vs th√°ng tr∆∞·ªõc`;
        byId('qlrKpiExportTrend').style.color = exportChange >= 0 ? '#ef4444' : '#10b981';
        
        byId('qlrKpiStock').textContent = `${data.stock.toLocaleString('vi-VN')} cont`;
        const stockChange = ((data.stock - data.stockPrev) / data.stockPrev * 100).toFixed(1);
        byId('qlrKpiStockTrend').textContent = `${stockChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(stockChange)}% vs th√°ng tr∆∞·ªõc`;
        byId('qlrKpiStockTrend').style.color = stockChange >= 0 ? '#f59e0b' : '#10b981';
        
        byId('qlrKpiCapacity').textContent = `${data.capacity}%`;
      };

      const renderTimeTrendChart = () => {
        const el = document.getElementById('qlr-chart-time-trend');
        if (!el) return;
        
        let chart = chartsById['qlr-chart-time-trend'];
        if (!chart) {
          chart = echarts.init(el);
          chartsById['qlr-chart-time-trend'] = chart;
        }

        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const importData = [2180, 2245, 2320, 2380, 2450, 2625, 2845];
        const exportData = [2120, 2195, 2240, 2410, 2580, 2698, 2612];
        const stockData = [3520, 3580, 3680, 3750, 3820, 3950, 4100];

        chart.setOption({
          tooltip: { trigger: 'axis' },
          legend: { data: ['Nh·∫≠p', 'Xu·∫•t', 'T·ªìn'], bottom: 0 },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: months },
          yAxis: [
            { 
              type: 'value', 
              name: 'Nh·∫≠p/Xu·∫•t (cont)',
              position: 'left'
            },
            { 
              type: 'value', 
              name: 'T·ªìn (cont)',
              position: 'right'
            }
          ],
          series: [
            { 
              name: 'Nh·∫≠p', 
              type: 'bar', 
              data: importData,
              itemStyle: { color: '#3b82f6', borderRadius: [4, 4, 0, 0] },
              barWidth: 18,
              yAxisIndex: 0,
              label: {
                show: true,
                position: 'top',
                formatter: '{c}',
                fontSize: 10,
                fontWeight: 600,
                color: '#1e293b'
              }
            },
            { 
              name: 'Xu·∫•t', 
              type: 'bar', 
              data: exportData,
              itemStyle: { color: '#ef4444', borderRadius: [4, 4, 0, 0] },
              barWidth: 18,
              yAxisIndex: 0,
              label: {
                show: true,
                position: 'top',
                formatter: '{c}',
                fontSize: 10,
                fontWeight: 600,
                color: '#1e293b'
              }
            },
            { 
              name: 'T·ªìn', 
              type: 'line', 
              data: stockData,
              smooth: true,
              itemStyle: { color: '#f59e0b' },
              lineStyle: { width: 3 },
              symbol: 'circle',
              symbolSize: 8,
              yAxisIndex: 1,
              label: {
                show: true,
                position: 'top',
                formatter: '{c}',
                fontSize: 10,
                fontWeight: 600,
                color: '#f59e0b'
              }
            }
          ]
        });
      };

      const renderSizeBarChart = () => {
        const el = document.getElementById('qlr-chart-size-bar');
        if (!el) return;
        
        let chart = chartsById['qlr-chart-size-bar'];
        if (!chart) {
          chart = echarts.init(el);
          chartsById['qlr-chart-size-bar'] = chart;
        }

        const categories = ['Nh·∫≠p 20HC', 'Nh·∫≠p 40HC', 'Xu·∫•t 20HC', 'Xu·∫•t 40HC'];
        const current = [1245, 1600, 1180, 1432];
        const previous = [1150, 1475, 1220, 1478];
        const changes = current.map((v, i) => ((v - previous[i]) / previous[i] * 100).toFixed(1));

        chart.setOption({
          tooltip: { 
            trigger: 'axis',
            axisPointer: { type: 'shadow' },
            formatter: (params) => {
              const idx = params[0].dataIndex;
              const change = changes[idx];
              const arrow = change >= 0 ? '‚Üë' : '‚Üì';
              return `${params[0].name}<br/>${params[0].marker}${params[0].value} cont<br/>Thay ƒë·ªïi: ${arrow} ${Math.abs(change)}%`;
            }
          },
          grid: { left: '10%', right: '8%', bottom: '12%', top: '10%', containLabel: true },
          xAxis: { 
            type: 'category', 
            data: categories,
            axisLabel: { interval: 0, rotate: 15, fontSize: 11 }
          },
          yAxis: { type: 'value', name: 'S·ªë l∆∞·ª£ng (cont)' },
          series: [{
            type: 'bar',
            data: current,
            itemStyle: {
              color: (params) => {
                const colors = ['#3b82f6', '#60a5fa', '#ef4444', '#f87171'];
                return colors[params.dataIndex];
              }
            },
            label: {
              show: true,
              position: 'top',
              fontSize: 12,
              fontWeight: 700,
              color: '#1e293b',
              formatter: (params) => {
                const idx = params.dataIndex;
                const change = changes[idx];
                const arrow = change >= 0 ? '‚Üë' : '‚Üì';
                return params.value + '\n' + arrow + Math.abs(change) + '%';
              }
            },
            barMaxWidth: 60
          }]
        });
      };

      const renderStatusHeatmapChart = () => {
        const el = document.getElementById('qlr-chart-status-heatmap');
        if (!el) return;
        
        let chart = chartsById['qlr-chart-status-heatmap'];
        if (!chart) {
          chart = echarts.init(el);
          chartsById['qlr-chart-status-heatmap'] = chart;
        }

        const statuses = ['AV', 'DM', 'OF', 'WA'];
        const sizes = ['20HC', '40HC'];
        
        // Data format: [sizeIndex, statusIndex, value]
        const data = [
          [0, 0, 1850], [1, 0, 2180], // AV
          [0, 1, 145],  [1, 1, 168],  // DM
          [0, 2, 86],   [1, 2, 95],   // OF
          [0, 3, 52],   [1, 3, 64]    // WA
        ].map(item => [item[0], item[1], item[2]]);

        chart.setOption({
          tooltip: {
            position: 'top',
            formatter: (params) => {
              const size = sizes[params.data[0]];
              const status = statuses[params.data[1]];
              const value = params.data[2];
              return `<b>${size} - ${status}</b><br/>S·ªë l∆∞·ª£ng: <b>${value} cont</b>`;
            }
          },
          grid: { height: '60%', top: '12%', left: '18%', right: '8%' },
          xAxis: {
            type: 'category',
            data: sizes,
            splitArea: { show: true },
            axisLabel: { fontWeight: 600, fontSize: 12 }
          },
          yAxis: {
            type: 'category',
            data: statuses,
            splitArea: { show: true },
            axisLabel: { fontWeight: 600, fontSize: 12 }
          },
          visualMap: {
            min: 0,
            max: 2200,
            calculable: true,
            orient: 'horizontal',
            left: 'center',
            bottom: '8%',
            inRange: {
              color: ['#dbeafe', '#60a5fa', '#2563eb', '#1e40af']
            },
            text: ['Cao', 'Th·∫•p'],
            textStyle: { fontSize: 11 }
          },
          series: [{
            type: 'heatmap',
            data: data,
            label: {
              show: true,
              formatter: (params) => {
                return params.data[2] + '';
              },
              fontSize: 15,
              fontWeight: 700,
              color: '#ffffff'
            },
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }]
        });
      };

      const renderExportHierarchyChart = () => {
        const el = document.getElementById('qlr-chart-export-hierarchy');
        if (!el) return;
        
        let chart = chartsById['qlr-chart-export-hierarchy'];
        if (!chart) {
          chart = echarts.init(el);
          chartsById['qlr-chart-export-hierarchy'] = chart;
        }

        const maxValue = 2612;
        
        chart.setOption({
          tooltip: {
            trigger: 'item',
            formatter: (params) => {
              return `<b>${params.name}</b><br/>S·ªë l∆∞·ª£ng: ${params.value} cont`;
            }
          },
          series: [{
            type: 'tree',
            data: [{
              name: 'Xu·∫•t r·ªóng',
              value: 2612,
              collapsed: false,
              itemStyle: { 
                color: '#f8fafc',
                borderColor: '#cbd5e1',
                borderWidth: 2,
                borderRadius: 8
              },
              label: { fontSize: 14, fontWeight: 700, color: '#1e293b', backgroundColor: '#f1f5f9', padding: [8, 12], borderRadius: 8, borderColor: '#cbd5e1', borderWidth: 1 },
              children: [
                {
                  name: 'C·∫•p r·ªóng',
                  value: 1850,
                  collapsed: false,
                  itemStyle: { 
                    color: '#f8fafc',
                    borderColor: '#cbd5e1',
                    borderWidth: 1.5,
                    borderRadius: 6
                  },
                  label: { fontSize: 13, fontWeight: 600, color: '#475569', backgroundColor: '#f8fafc', padding: [6, 10], borderRadius: 6, borderColor: '#cbd5e1', borderWidth: 1 },
                  children: [
                    { 
                      name: 'C·∫•p t·∫°i c·∫£ng', 
                      value: 1245, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    },
                    { 
                      name: 'C·∫•p t·∫°i depot', 
                      value: 605, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    }
                  ]
                },
                {
                  name: 'Chuy·ªÉn r·ªóng',
                  value: 762,
                  collapsed: false,
                  itemStyle: { 
                    color: '#f8fafc',
                    borderColor: '#cbd5e1',
                    borderWidth: 1.5,
                    borderRadius: 6
                  },
                  label: { fontSize: 13, fontWeight: 600, color: '#475569', backgroundColor: '#f8fafc', padding: [6, 10], borderRadius: 6, borderColor: '#cbd5e1', borderWidth: 1 },
                  children: [
                    { 
                      name: 'Chuy·ªÉn depot kh√°c', 
                      value: 485, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    },
                    { 
                      name: 'Chuy·ªÉn b√£i h√£ng', 
                      value: 277, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    }
                  ]
                }
              ]
            }],
            top: '8%',
            left: '5%',
            bottom: '8%',
            right: '25%',
            symbolSize: [16, 16],
            symbol: 'roundRect',
            orient: 'horizontal',
            layout: 'orthogonal',
            edgeShape: 'polyline',
            edgeForkPosition: '100%',
            expandAndCollapse: true,
            initialTreeDepth: 3,
            label: {
              position: 'insideRight',
              verticalAlign: 'middle',
              align: 'left',
              fontSize: 12,
              fontWeight: 600,
              distance: 10,
              formatter: (params) => {
                const barWidth = Math.floor((params.value / maxValue) * 120);
                const barColor = params.treeAncestors && params.treeAncestors.length > 1 ? 
                  (params.treeAncestors[1].name === 'C·∫•p r·ªóng' ? '#3b82f6' : '#8b5cf6') : '#64748b';
                return `{name|${params.name}} {bar|${'‚ñà'.repeat(Math.max(1, Math.floor(barWidth/8)))}} {value|${params.value}}`;
              },
              rich: {
                name: {
                  fontSize: 12,
                  fontWeight: 600,
                  color: '#1e293b',
                  padding: [4, 8],
                  align: 'left'
                },
                bar: {
                  fontSize: 14,
                  color: '#3b82f6',
                  padding: [0, 4],
                  align: 'left'
                },
                value: {
                  fontSize: 11,
                  fontWeight: 700,
                  color: '#475569',
                  padding: [4, 8],
                  align: 'left'
                }
              }
            },
            leaves: {
              label: {
                position: 'insideRight',
                verticalAlign: 'middle',
                align: 'left'
              }
            },
            emphasis: {
              focus: 'descendant',
              itemStyle: {
                borderWidth: 3,
                borderColor: '#3b82f6'
              }
            },
            lineStyle: {
              color: '#cbd5e1',
              width: 2,
              curveness: 0.5
            },
            expandAndCollapse: true,
            animationDuration: 550,
            animationDurationUpdate: 750
          }]
        });
      };

      const renderImportHierarchyChart = () => {
        const el = document.getElementById('qlr-chart-import-hierarchy');
        if (!el) return;
        
        let chart = chartsById['qlr-chart-import-hierarchy'];
        if (!chart) {
          chart = echarts.init(el);
          chartsById['qlr-chart-import-hierarchy'] = chart;
        }

        const maxValueImport = 2845;
        
        chart.setOption({
          tooltip: {
            trigger: 'item',
            formatter: (params) => {
              return `<b>${params.name}</b><br/>S·ªë l∆∞·ª£ng: ${params.value} cont`;
            }
          },
          series: [{
            type: 'tree',
            data: [{
              name: 'Nh·∫≠p r·ªóng',
              value: 2845,
              collapsed: false,
              itemStyle: { 
                color: '#f8fafc',
                borderColor: '#cbd5e1',
                borderWidth: 2,
                borderRadius: 8
              },
              label: { fontSize: 14, fontWeight: 700, color: '#1e293b', backgroundColor: '#f1f5f9', padding: [8, 12], borderRadius: 8, borderColor: '#cbd5e1', borderWidth: 1 },
              children: [
                {
                  name: 'S√† lan',
                  value: 1920,
                  collapsed: false,
                  itemStyle: { 
                    color: '#f8fafc',
                    borderColor: '#cbd5e1',
                    borderWidth: 1.5,
                    borderRadius: 6
                  },
                  label: { fontSize: 13, fontWeight: 600, color: '#475569', backgroundColor: '#f8fafc', padding: [6, 10], borderRadius: 6, borderColor: '#cbd5e1', borderWidth: 1 },
                  children: [
                    { 
                      name: 'S√† lan HCM', 
                      value: 1245, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    },
                    { 
                      name: 'S√† lan C·∫ßn Th∆°', 
                      value: 485, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    },
                    { 
                      name: 'S√† lan B√¨nh D∆∞∆°ng', 
                      value: 190, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 11, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    }
                  ]
                },
                {
                  name: 'Gate',
                  value: 925,
                  collapsed: false,
                  itemStyle: { 
                    color: '#f8fafc',
                    borderColor: '#cbd5e1',
                    borderWidth: 1.5,
                    borderRadius: 6
                  },
                  label: { fontSize: 13, fontWeight: 600, color: '#475569', backgroundColor: '#f8fafc', padding: [6, 10], borderRadius: 6, borderColor: '#cbd5e1', borderWidth: 1 },
                  children: [
                    { 
                      name: 'Gate 1', 
                      value: 520, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    },
                    { 
                      name: 'Gate 2', 
                      value: 325, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 12, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    },
                    { 
                      name: 'Gate 3', 
                      value: 80, 
                      itemStyle: { 
                        color: '#f8fafc',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        borderRadius: 5
                      },
                      label: { fontSize: 11, color: '#64748b', backgroundColor: '#ffffff', padding: [5, 8], borderRadius: 5, borderColor: '#e2e8f0', borderWidth: 1 }
                    }
                  ]
                }
              ]
            }],
            top: '8%',
            left: '5%',
            bottom: '8%',
            right: '25%',
            symbolSize: [16, 16],
            symbol: 'roundRect',
            orient: 'horizontal',
            layout: 'orthogonal',
            edgeShape: 'polyline',
            edgeForkPosition: '100%',
            expandAndCollapse: true,
            initialTreeDepth: 3,
            label: {
              position: 'insideRight',
              verticalAlign: 'middle',
              align: 'left',
              fontSize: 12,
              fontWeight: 600,
              distance: 10,
              formatter: (params) => {
                const barWidth = Math.floor((params.value / maxValueImport) * 120);
                const barColor = params.treeAncestors && params.treeAncestors.length > 1 ? 
                  (params.treeAncestors[1].name === 'S√† lan' ? '#10b981' : '#f59e0b') : '#64748b';
                return `{name|${params.name}} {bar|${'‚ñà'.repeat(Math.max(1, Math.floor(barWidth/8)))}} {value|${params.value}}`;
              },
              rich: {
                name: {
                  fontSize: 12,
                  fontWeight: 600,
                  color: '#1e293b',
                  padding: [4, 8],
                  align: 'left'
                },
                bar: {
                  fontSize: 14,
                  color: '#10b981',
                  padding: [0, 4],
                  align: 'left'
                },
                value: {
                  fontSize: 11,
                  fontWeight: 700,
                  color: '#475569',
                  padding: [4, 8],
                  align: 'left'
                }
              }
            },
            leaves: {
              label: {
                position: 'insideRight',
                verticalAlign: 'middle',
                align: 'left'
              }
            },
            emphasis: {
              focus: 'descendant',
              itemStyle: {
                borderWidth: 3,
                borderColor: '#10b981'
              }
            },
            lineStyle: {
              color: '#cbd5e1',
              width: 2,
              curveness: 0.5
            },
            expandAndCollapse: true,
            animationDuration: 550,
            animationDurationUpdate: 750
          }]
        });
      };

      const render = () => {
        updateKPIs();
        
        // Render charts with delay to ensure DOM is ready
        setTimeout(() => {
          renderTimeTrendChart();
          renderSizeBarChart();
          renderStatusHeatmapChart();
          renderExportHierarchyChart();
          renderImportHierarchyChart();
        }, 100);
      };

      qlrFilterMonth.addEventListener('change', render);
      render();
    };

    const initKhoBaiReport = () => {
      const kbFilterMonth = byId('kbFilterMonth');
      if (!kbFilterMonth) return;

      // D·ªØ li·ªáu fake
      const monthlyData = {
        '2026-01': { revenue: 28.5, revenuePrev: 27.3, cost: 18.6, costPrev: 18.1, profit: 9.9, profitPrev: 9.2, kpi: 108.2 },
        '2025-12': { revenue: 27.3, revenuePrev: 26.1, cost: 18.1, costPrev: 17.6, profit: 9.2, profitPrev: 8.5, kpi: 105.6 },
        '2025-11': { revenue: 26.1, revenuePrev: 24.8, cost: 17.6, costPrev: 17.2, profit: 8.5, profitPrev: 7.6, kpi: 102.3 },
        '2025-10': { revenue: 24.8, revenuePrev: 23.5, cost: 17.2, costPrev: 16.8, profit: 7.6, profitPrev: 6.7, kpi: 98.7 }
      };

      // C·∫•u tr√∫c d·ªØ li·ªáu ph√¢n c·∫•p theo ·∫£nh
      const serviceData = [
        {
          id: 'cho-thue-kho',
          name: 'Cho thu√™ kho',
          revenue: 8250,
          profit: 2890,
          revPct: 28.9,
          profitMargin: 35.0,
          unitPrice: 95,
          area: 12500,
          children: [
            { name: 'Kho B1.1 (ƒê.ƒê.P thu√™)', revenue: 1850, profit: 680, revPct: 6.5, profitMargin: 36.8, unitPrice: 98, area: 2800 },
            { name: 'Kho B1.2 (ƒê.ƒê.P thu√™)', revenue: 1520, profit: 545, revPct: 5.3, profitMargin: 35.9, unitPrice: 95, area: 2400 },
            { name: 'Kho B2 (ƒê.ƒê.P thu√™)', revenue: 1420, profit: 495, revPct: 5.0, profitMargin: 34.9, unitPrice: 92, area: 2300 },
            { name: 'Kho B3 (ƒê.ƒê.P thu√™)', revenue: 1280, profit: 450, revPct: 4.5, profitMargin: 35.2, unitPrice: 96, area: 2000 },
            { name: 'Kho B4 (ƒê.ƒê.P thu√™)', revenue: 1120, profit: 385, revPct: 3.9, profitMargin: 34.4, unitPrice: 93, area: 1800 },
            { name: 'Kho B5 (ƒê.ƒê.P thu√™)', revenue: 850, profit: 295, revPct: 3.0, profitMargin: 34.7, unitPrice: 94, area: 1400 },
            { name: 'C·∫ßn n·ªëi', revenue: 210, profit: 40, revPct: 0.7, profitMargin: 19.0, unitPrice: 75, area: 420 }
          ]
        },
        {
          id: 'cho-thue-bai',
          name: 'Cho thu√™ b√£i',
          revenue: 7850,
          profit: 3125,
          revPct: 27.5,
          profitMargin: 39.8,
          unitPrice: 45,
          area: 28500,
          children: [
            { name: 'Kho B1.3 (H·∫£i V√¢n thu√™)', revenue: 2450, profit: 1025, revPct: 8.6, profitMargin: 41.8, unitPrice: 48, area: 8200 },
            { name: 'Kho B3 (H·ªìng H·∫£i thu√™)', revenue: 1950, profit: 795, revPct: 6.8, profitMargin: 40.8, unitPrice: 47, area: 6800 },
            { name: 'Kho B3 (Siam City VN thu√™)', revenue: 1820, profit: 720, revPct: 6.4, profitMargin: 39.6, unitPrice: 46, area: 6400 },
            { name: 'Kho CCS (T√¢n Qu√°n thu√™)', revenue: 1630, profit: 585, revPct: 5.7, profitMargin: 35.9, unitPrice: 42, area: 7100 }
          ]
        },
        {
          id: 'cho-thue-nha-xuong',
          name: 'Cho thu√™ nh√† x∆∞·ªüng',
          revenue: 6950,
          profit: 2520,
          revPct: 24.4,
          profitMargin: 36.3,
          unitPrice: 125,
          area: 8850,
          children: [
            { name: 'VP tr∆∞·ªõc c·∫£ng', revenue: 2850, profit: 1065, revPct: 10.0, profitMargin: 37.4, unitPrice: 135, area: 3200 },
            { name: 'T√¢n C·∫£ng Thanh Ph∆∞·ªõc', revenue: 2250, profit: 825, revPct: 7.9, profitMargin: 36.7, unitPrice: 128, area: 2800 },
            { name: 'H·ªìng H·∫£i', revenue: 1850, profit: 630, revPct: 6.5, profitMargin: 34.1, unitPrice: 115, area: 2850 }
          ]
        },
        {
          id: 'dien-kho',
          name: 'ƒêi·ªán kho',
          revenue: 3250,
          profit: 845,
          revPct: 11.4,
          profitMargin: 26.0,
          unitPrice: 0,
          area: 0,
          children: [
            { name: 'ƒêi·ªán kho (ƒê.ƒê.P)', revenue: 1850, profit: 485, revPct: 6.5, profitMargin: 26.2, unitPrice: 0, area: 0 },
            { name: 'ƒêi·ªán (Orient Wealth)', revenue: 680, profit: 175, revPct: 2.4, profitMargin: 25.7, unitPrice: 0, area: 0 },
            { name: 'ƒêi·ªán (Orient Wealth)', revenue: 420, profit: 105, revPct: 1.5, profitMargin: 25.0, unitPrice: 0, area: 0 },
            { name: 'ƒêi·ªán (Ho√†ng ƒê·∫°t V∆∞∆°ng)', revenue: 300, profit: 80, revPct: 1.0, profitMargin: 26.7, unitPrice: 0, area: 0 }
          ]
        },
        {
          id: 'nuoc-kho',
          name: 'N∆∞·ªõc kho',
          revenue: 2200,
          profit: 615,
          revPct: 7.7,
          profitMargin: 28.0,
          unitPrice: 0,
          area: 0,
          children: [
            { name: 'N∆∞·ªõc kho (ƒê.ƒê.P)', revenue: 1250, profit: 360, revPct: 4.4, profitMargin: 28.8, unitPrice: 0, area: 0 },
            { name: 'ƒêi·ªán Siam City', revenue: 520, profit: 145, revPct: 1.8, profitMargin: 27.9, unitPrice: 0, area: 0 },
            { name: 'ƒêi·ªán VNPT', revenue: 280, profit: 75, revPct: 1.0, profitMargin: 26.8, unitPrice: 0, area: 0 },
            { name: 'Viettel', revenue: 150, profit: 35, revPct: 0.5, profitMargin: 23.3, unitPrice: 0, area: 0 }
          ]
        }
      ];

      const updateKPIs = () => {
        const selectedMonth = kbFilterMonth.value;
        const data = monthlyData[selectedMonth];
        
        byId('kbRevenueValue').textContent = `${data.revenue} t·ª∑`;
        byId('kbRevenueTrend').textContent = `‚Üë ${((data.revenue - data.revenuePrev) / data.revenuePrev * 100).toFixed(1)}%`;
        byId('kbRevenueTrend').style.color = data.revenue >= data.revenuePrev ? '#10b981' : '#ef4444';
        
        byId('kbCostValue').textContent = `${data.cost} t·ª∑`;
        byId('kbCostTrend').textContent = `‚Üë ${((data.cost - data.costPrev) / data.costPrev * 100).toFixed(1)}%`;
        byId('kbCostTrend').style.color = data.cost >= data.costPrev ? '#ef4444' : '#10b981';
        
        byId('kbProfitValue').textContent = `${data.profit} t·ª∑`;
        byId('kbProfitTrend').textContent = `‚Üë ${((data.profit - data.profitPrev) / data.profitPrev * 100).toFixed(1)}%`;
        byId('kbProfitTrend').style.color = data.profit >= data.profitPrev ? '#10b981' : '#ef4444';
        
        byId('kbKpiValue').textContent = `${data.kpi}%`;
      };

      const renderKBFinanceChart = () => {
        const chart = getChart('chart-kb-finance');
        if (!chart) return;

        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const revenue = [21.5, 22.3, 23.1, 24.8, 26.1, 27.3, 28.5];
        const cost = [15.8, 16.2, 16.5, 17.2, 17.6, 18.1, 18.6];
        const profit = revenue.map((r, i) => r - cost[i]);

        chart.setOption({
          tooltip: { trigger: 'axis' },
          legend: { data: ['Doanh thu', 'Chi ph√≠', 'L·ª£i nhu·∫≠n'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: months, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' } },
          series: [
            { name: 'Doanh thu', type: 'bar', data: revenue, itemStyle: { color: '#3b82f6' } },
            { name: 'Chi ph√≠', type: 'bar', data: cost, itemStyle: { color: '#f97316' } },
            { name: 'L·ª£i nhu·∫≠n', type: 'line', data: profit, itemStyle: { color: '#10b981' }, lineStyle: { width: 3 } }
          ]
        });
      };

      const renderKBCostStructureChart = () => {
        const chart = getChart('chart-kb-cost-structure');
        if (!chart) return;

        const categories = ['Nh√¢n c√¥ng', 'V·∫≠t t∆∞ & ti·ªán √≠ch', 'Kh·∫•u hao', 'Chi ph√≠ kh√°c'];
        const values = [8.2, 6.5, 2.8, 1.1];
        const prevValues = [7.9, 6.3, 2.7, 1.2];

        chart.setOption({
          tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
          grid: { left: '15%', right: '4%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' } },
          yAxis: { type: 'category', data: categories, axisLabel: { color: '#64748b' } },
          series: [{
            type: 'bar',
            data: values,
            itemStyle: { color: '#3b82f6' },
            label: {
              show: true,
              position: 'right',
              formatter: (params) => {
                const change = ((values[params.dataIndex] - prevValues[params.dataIndex]) / prevValues[params.dataIndex] * 100);
                const arrow = change >= 0 ? '‚Üë' : '‚Üì';
                return `{value|${params.value} t·ª∑} {change|${arrow} ${Math.abs(change).toFixed(1)}%}`;
              },
              rich: {
                value: { color: '#1e293b', fontWeight: 600, fontSize: 13 },
                change: { color: '#64748b', fontSize: 11, padding: [0, 0, 0, 8] }
              }
            }
          }]
        });
      };

      const renderKBRevenueServiceChart = () => {
        const chart = getChart('chart-kb-revenue-service');
        if (!chart) return;

        const services = ['Cho thu√™ kho', 'Cho thu√™ b√£i', 'Cho thu√™ NX', 'ƒêi·ªán kho', 'N∆∞·ªõc kho'];
        const revenue = [8.25, 7.85, 6.95, 3.25, 2.2];
        const kpiRate = [110.5, 108.2, 112.8, 105.4, 103.8];

        chart.setOption({
          tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
          legend: { data: ['Doanh thu', 'T·ª∑ l·ªá KPI'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '12%', right: '8%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: services, axisLabel: { color: '#64748b', rotate: 15 } },
          yAxis: [
            { type: 'value', name: 'Doanh thu (t·ª∑)', position: 'left', axisLabel: { formatter: '{value}', color: '#64748b' } },
            { type: 'value', name: 'KPI (%)', position: 'right', axisLabel: { formatter: '{value}%', color: '#64748b' } }
          ],
          series: [
            {
              name: 'Doanh thu',
              type: 'bar',
              data: revenue,
              itemStyle: { color: '#3b82f6' },
              label: { show: true, position: 'top', formatter: '{c} t·ª∑', color: '#1e293b', fontWeight: 600 }
            },
            {
              name: 'T·ª∑ l·ªá KPI',
              type: 'line',
              yAxisIndex: 1,
              data: kpiRate,
              itemStyle: { color: '#10b981' },
              lineStyle: { width: 2 },
              label: { show: true, formatter: '{c}%', color: '#10b981', fontWeight: 600 }
            }
          ]
        });
      };

      const renderKBCustomerRevenueChart = () => {
        const chart = getChart('chart-kb-customer-revenue');
        if (!chart) return;

        const customers = ['ƒê.ƒê.P', 'H·∫£i V√¢n', 'Orient Wealth', 'H·ªìng H·∫£i', 'Siam City VN', 'T√¢n Qu√°n', 'Ho√†ng ƒê·∫°t V∆∞∆°ng', 'VNPT'];
        const revenue = [4.85, 2.45, 1.9, 1.85, 1.82, 1.63, 1.25, 0.95];
        const kpiRate = [112.5, 108.8, 115.2, 106.5, 110.3, 105.8, 109.2, 112.8];

        chart.setOption({
          tooltip: { 
            trigger: 'axis',
            formatter: (params) => {
              return `${params[0].axisValue}<br/>` +
                     `${params[0].marker}Doanh thu: ${params[0].value} t·ª∑<br/>` +
                     `T·ª∑ l·ªá KPI: ${kpiRate[params[0].dataIndex]}%`;
            }
          },
          grid: { left: '18%', right: '4%', bottom: '8%', top: '8%' },
          xAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' } },
          yAxis: { type: 'category', data: customers, axisLabel: { color: '#64748b' } },
          series: [{
            type: 'bar',
            data: revenue,
            itemStyle: { 
              color: (params) => {
                return kpiRate[params.dataIndex] >= 108 ? '#10b981' : '#3b82f6';
              }
            },
            label: { 
              show: true, 
              position: 'right', 
              formatter: (params) => `${params.value} t·ª∑ (${kpiRate[params.dataIndex]}%)`,
              color: '#1e293b',
              fontWeight: 600
            }
          }]
        });
      };

      const renderKBHeatmapChart = () => {
        const chart = getChart('chart-kb-heatmap');
        if (!chart) return;

        const services = ['Cho thu√™ kho', 'Cho thu√™ b√£i', 'Cho thu√™ NX', 'ƒêi·ªán kho', 'N∆∞·ªõc kho'];
        const customers = ['ƒê.ƒê.P', 'H·∫£i V√¢n', 'Orient W.', 'H·ªìng H·∫£i', 'Siam City', 'T√¢n Qu√°n', 'Hƒê V∆∞∆°ng', 'VNPT'];
        
        const data = [
          [0, 0, 385], [0, 1, 0], [0, 2, 0], [0, 3, 0], [0, 4, 0], [0, 5, 0], [0, 6, 0], [0, 7, 0],
          [1, 0, 0], [1, 1, 245], [1, 2, 0], [1, 3, 195], [1, 4, 182], [1, 5, 163], [1, 6, 0], [1, 7, 0],
          [2, 0, 0], [2, 1, 0], [2, 2, 190], [2, 3, 185], [2, 4, 0], [2, 5, 0], [2, 6, 0], [2, 7, 0],
          [3, 0, 185], [3, 1, 0], [3, 2, 68], [3, 3, 0], [3, 4, 0], [3, 5, 0], [3, 6, 30], [3, 7, 0],
          [4, 0, 125], [4, 1, 0], [4, 2, 0], [4, 3, 0], [4, 4, 52], [4, 5, 0], [4, 6, 0], [4, 7, 28]
        ].map(item => [item[0], item[1], item[2] / 100]);

        chart.setOption({
          tooltip: { 
            position: 'top',
            formatter: (params) => `${services[params.data[0]]} √ó ${customers[params.data[1]]}<br/>Doanh thu: ${(params.data[2] * 100).toFixed(0)} tri·ªáu`
          },
          grid: { height: '65%', top: '8%', left: '18%' },
          xAxis: { type: 'category', data: customers, splitArea: { show: true }, axisLabel: { color: '#64748b', rotate: 30 } },
          yAxis: { type: 'category', data: services, splitArea: { show: true }, axisLabel: { color: '#64748b' } },
          visualMap: { min: 0, max: 4, calculable: true, orient: 'horizontal', left: 'center', bottom: '2%', inRange: { color: ['#f0f9ff', '#0284c7', '#0c4a6e'] } },
          series: [{
            type: 'heatmap',
            data: data,
            label: { show: true, formatter: (params) => params.data[2] > 0 ? (params.data[2] * 100).toFixed(0) : '', color: '#fff', fontWeight: 600 },
            emphasis: { itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.5)' } }
          }]
        });
      };

      const serviceExpandedState = {};

      const renderKBDetailTable = () => {
        const tbody = byId('kbTableDetail')?.querySelector('tbody');
        if (!tbody) return;

        let html = '';
        serviceData.forEach(item => {
          const hasChildren = item.children && item.children.length > 0;
          const isExpanded = serviceExpandedState[item.id];
          const expandIcon = hasChildren ? (isExpanded ? '‚ñº' : '‚ñ∂') : '';
          
          html += `
            <tr style="background: #f8fafc; cursor: ${hasChildren ? 'pointer' : 'default'};" ${hasChildren ? `onclick="toggleKBServiceRow('${item.id}')"` : ''}>
              <td><strong>${expandIcon} ${item.name}</strong></td>
              <td>${item.revenue.toFixed(0)} tri·ªáu</td>
              <td>${item.profit.toFixed(0)} tri·ªáu</td>
              <td style="color: ${item.revPct > 20 ? '#10b981' : '#64748b'}; font-weight: 600;">${item.revPct.toFixed(1)}%</td>
              <td style="color: ${item.profitMargin > 30 ? '#10b981' : '#64748b'}; font-weight: 600;">${item.profitMargin.toFixed(1)}%</td>
              <td>${item.unitPrice > 0 ? item.unitPrice + ' k' : '-'}</td>
              <td>${item.area > 0 ? item.area.toLocaleString('vi-VN') : '-'}</td>
            </tr>
          `;
          
          if (hasChildren && isExpanded) {
            item.children.forEach(child => {
              html += `
                <tr class="child-row-${item.id}" style="background: #ffffff;">
                  <td style="padding-left: 40px;">${child.name}</td>
                  <td>${child.revenue.toFixed(0)} tri·ªáu</td>
                  <td>${child.profit.toFixed(0)} tri·ªáu</td>
                  <td style="color: #64748b;">${child.revPct.toFixed(1)}%</td>
                  <td style="color: #64748b;">${child.profitMargin.toFixed(1)}%</td>
                  <td>${child.unitPrice > 0 ? child.unitPrice + ' k' : '-'}</td>
                  <td>${child.area > 0 ? child.area.toLocaleString('vi-VN') : '-'}</td>
                </tr>
              `;
            });
          }
        });
        
        tbody.innerHTML = html;
      };

      window.toggleKBServiceRow = (id) => {
        serviceExpandedState[id] = !serviceExpandedState[id];
        renderKBDetailTable();
      };

      const render = () => {
        updateKPIs();
        renderKBFinanceChart();
        renderKBCostStructureChart();
        renderKBRevenueServiceChart();
        renderKBCustomerRevenueChart();
        renderKBHeatmapChart();
        renderKBDetailTable();
      };

      kbFilterMonth.addEventListener('change', render);
      render();
    };

    const initXNTReport = () => {
      const xntFilterMonth = byId('xntFilterMonth');
      const xntFilterCategory = byId('xntFilterCategory');

      if (!xntFilterMonth || !xntFilterCategory) return;

      // D·ªØ li·ªáu fake
      const sampleXNTData = [
        // Th√°ng 01/2026
        { month: '2026-01', code: 'VT-001', name: 'Th√©p t·∫•m A36', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'T·∫•n', beginQty: 125, importQty: 85, exportQty: 95, endQty: 115, unitPrice: 18.5 },
        { month: '2026-01', code: 'VT-002', name: '·ªêng th√©p phi 114', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'M√©t', beginQty: 2400, importQty: 1500, exportQty: 1800, endQty: 2100, unitPrice: 0.45 },
        { month: '2026-01', code: 'VT-003', name: 'M√°y h√†n CO2', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', unit: 'C√°i', beginQty: 12, importQty: 3, exportQty: 2, endQty: 13, unitPrice: 85.0 },
        { month: '2026-01', code: 'VT-004', name: 'D√¢y h√†n phi 3.2', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'Kg', beginQty: 850, importQty: 600, exportQty: 720, endQty: 730, unitPrice: 0.12 },
        { month: '2026-01', code: 'VT-005', name: 'M√°y c·∫Øt plasma', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', unit: 'C√°i', beginQty: 8, importQty: 2, exportQty: 1, endQty: 9, unitPrice: 125.0 },
        { month: '2026-01', code: 'VT-006', name: 'S∆°n ch·ªëng r·ªâ', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'L√≠t', beginQty: 1200, importQty: 800, exportQty: 950, endQty: 1050, unitPrice: 0.25 },
        { month: '2026-01', code: 'VT-007', name: 'M√°y m√†i g√≥c', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', unit: 'C√°i', beginQty: 25, importQty: 8, exportQty: 5, endQty: 28, unitPrice: 8.5 },
        { month: '2026-01', code: 'VT-008', name: 'ƒêƒ©a m√†i', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'C√°i', beginQty: 1500, importQty: 1000, exportQty: 1200, endQty: 1300, unitPrice: 0.035 },
        { month: '2026-01', code: 'VT-009', name: 'Kh√≠ CO2', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'Kg', beginQty: 450, importQty: 300, exportQty: 380, endQty: 370, unitPrice: 0.08 },
        { month: '2026-01', code: 'VT-010', name: 'M√°y khoan t·ª´', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', unit: 'C√°i', beginQty: 6, importQty: 2, exportQty: 0, endQty: 8, unitPrice: 65.0 },
        
        // Th√°ng 12/2025
        { month: '2025-12', code: 'VT-001', name: 'Th√©p t·∫•m A36', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'T·∫•n', beginQty: 140, importQty: 75, exportQty: 90, endQty: 125, unitPrice: 18.5 },
        { month: '2025-12', code: 'VT-002', name: '·ªêng th√©p phi 114', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'M√©t', beginQty: 2600, importQty: 1400, exportQty: 1600, endQty: 2400, unitPrice: 0.45 },
        { month: '2025-12', code: 'VT-003', name: 'M√°y h√†n CO2', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', unit: 'C√°i', beginQty: 11, importQty: 2, exportQty: 1, endQty: 12, unitPrice: 85.0 },
        { month: '2025-12', code: 'VT-004', name: 'D√¢y h√†n phi 3.2', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', unit: 'Kg', beginQty: 920, importQty: 550, exportQty: 620, endQty: 850, unitPrice: 0.12 },
        { month: '2025-12', code: 'VT-005', name: 'M√°y c·∫Øt plasma', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', unit: 'C√°i', beginQty: 7, importQty: 2, exportQty: 1, endQty: 8, unitPrice: 125.0 }
      ];

      const renderXNTKpis = (records) => {
        const totalExport = records.reduce((sum, r) => sum + (r.exportQty * r.unitPrice), 0);
        const totalImport = records.reduce((sum, r) => sum + (r.importQty * r.unitPrice), 0);
        const totalStock = records.reduce((sum, r) => sum + (r.endQty * r.unitPrice), 0);
        const fulfillment = 87.5; // Fake data

        // T√≠nh ti·ªÅn mua th√™m t·ª´ b·∫£ng order
        const orderData = [
          { order: 200, stock: 115, unitPrice: 18.5 },
          { order: 3500, stock: 2100, unitPrice: 0.45 },
          { order: 15, stock: 13, unitPrice: 85 },
          { order: 1200, stock: 730, unitPrice: 0.12 },
          { order: 12, stock: 9, unitPrice: 125 },
          { order: 1800, stock: 1050, unitPrice: 0.25 },
          { order: 35, stock: 28, unitPrice: 8.5 },
          { order: 2000, stock: 1300, unitPrice: 0.035 },
          { order: 600, stock: 370, unitPrice: 0.08 },
          { order: 10, stock: 8, unitPrice: 65 }
        ];
        const totalPurchase = orderData.reduce((sum, item) => {
          const needToBuy = Math.max(0, item.order - item.stock);
          return sum + (needToBuy * item.unitPrice);
        }, 0);

        setText('xntKpiExport', (totalExport / 1000).toFixed(1) + ' t·ª∑');
        setText('xntKpiImport', (totalImport / 1000).toFixed(1) + ' t·ª∑');
        setText('xntKpiStock', (totalStock / 1000).toFixed(1) + ' t·ª∑');
        setText('xntKpiFulfillment', fulfillment.toFixed(1) + '%');
        setText('xntKpiPurchase', totalPurchase.toLocaleString('vi-VN', {minimumFractionDigits: 1, maximumFractionDigits: 1}) + ' tri·ªáu');
      };

      const renderXNTTimeseries = () => {
        const chart = chartsById['chart-xnt-timeseries'];
        if (!chart) return;
        
        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const imports = [165, 172, 158, 180, 175, 168, 186];
        const exports = [185, 192, 178, 195, 188, 182, 255];
        const stocks = [128, 135, 132, 142, 138, 140, 143];

        chart.setOption({
          tooltip: { trigger: 'axis' },
          legend: { data: ['Nh·∫≠p', 'Xu·∫•t', 'T·ªìn'], bottom: 0 },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: months, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'value', axisLabel: { color: '#64748b', formatter: '{value} t·ª∑' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
          series: [
            { name: 'Nh·∫≠p', type: 'bar', data: imports, itemStyle: { color: '#3b82f6', borderRadius: [6, 6, 0, 0] }, barWidth: 18 },
            { name: 'Xu·∫•t', type: 'bar', data: exports, itemStyle: { color: '#ef4444', borderRadius: [6, 6, 0, 0] }, barWidth: 18 },
            { name: 'T·ªìn', type: 'line', data: stocks, lineStyle: { color: '#10b981', width: 3 }, itemStyle: { color: '#10b981' }, symbol: 'circle', symbolSize: 8 }
          ]
        });
      };

      const renderXNTCategory = (records) => {
        const chart = chartsById['chart-xnt-category'];
        if (!chart) return;
        
        const grouped = {};
        records.forEach(r => {
          if (!grouped[r.category]) grouped[r.category] = 0;
          grouped[r.category] += r.endQty * r.unitPrice;
        });

        const data = Object.entries(grouped).map(([name, value]) => ({ name, value: value / 1000 }));

        chart.setOption({
          tooltip: { trigger: 'item', formatter: '{b}: {c} t·ª∑ ({d}%)' },
          legend: { bottom: 0 },
          series: [{
            type: 'pie',
            radius: ['40%', '70%'],
            data,
            label: { show: true, formatter: '{b}\\n{c} t·ª∑\\n({d}%)', fontSize: 11, fontWeight: 600 },
            itemStyle: { borderRadius: 4, borderColor: '#fff', borderWidth: 2 }
          }],
          color: ['#3b82f6', '#10b981']
        });
      };

      const renderXNTFulfillment = () => {
        const chart = chartsById['chart-xnt-fulfillment'];
        if (!chart) return;

        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const fulfillment = [82, 85, 83, 88, 86, 84, 87.5];

        chart.setOption({
          tooltip: { trigger: 'axis', formatter: '{b}: {c}%' },
          grid: { left: '8%', right: '4%', bottom: '12%', top: '10%' },
          xAxis: { type: 'category', data: months, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'value', min: 75, max: 100, axisLabel: { color: '#64748b', formatter: '{value}%' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
          series: [{
            type: 'line',
            data: fulfillment,
            smooth: true,
            lineStyle: { color: '#a855f7', width: 3 },
            areaStyle: { color: 'rgba(168, 85, 247, 0.1)' },
            itemStyle: { color: '#a855f7' },
            symbol: 'circle',
            symbolSize: 8,
            markLine: {
              data: [{ yAxis: 85, label: { formatter: 'M·ª•c ti√™u: 85%' } }],
              lineStyle: { color: '#f59e0b', type: 'dashed' }
            }
          }]
        });
      };

      const renderXNTOrderTable = () => {
        const tbody = byId('xntTableOrder')?.querySelector('tbody');
        if (!tbody) return;

        // D·ªØ li·ªáu fake cho b·∫£ng order
        const orderData = [
          { name: 'Th√©p t·∫•m A36', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', order: 200, stock: 115, need: 85, planned: 85, costM: 1572.5 },
          { name: '·ªêng th√©p phi 114', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', order: 3500, stock: 2100, need: 1400, planned: 1400, costM: 630 },
          { name: 'M√°y h√†n CO2', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', order: 15, stock: 13, need: 2, planned: 2, costM: 170 },
          { name: 'D√¢y h√†n phi 3.2', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', order: 1200, stock: 730, need: 470, planned: 470, costM: 56.4 },
          { name: 'M√°y c·∫Øt plasma', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', order: 12, stock: 9, need: 3, planned: 3, costM: 375 },
          { name: 'S∆°n ch·ªëng r·ªâ', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', order: 1800, stock: 1050, need: 750, planned: 750, costM: 187.5 },
          { name: 'M√°y m√†i g√≥c', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', order: 35, stock: 28, need: 7, planned: 7, costM: 59.5 },
          { name: 'ƒêƒ©a m√†i', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', order: 2000, stock: 1300, need: 700, planned: 700, costM: 24.5 },
          { name: 'Kh√≠ CO2', category: 'V·∫≠t t∆∞ s·∫£n xu·∫•t', order: 600, stock: 370, need: 230, planned: 230, costM: 18.4 },
          { name: 'M√°y khoan t·ª´', category: 'C√¥ng c·ª• s·∫£n xu·∫•t', order: 10, stock: 8, need: 2, planned: 2, costM: 130 }
        ];

        tbody.innerHTML = '';
        orderData.forEach((r, idx) => {
          const tr = document.createElement('tr');
          const bgColor = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
          tr.style.backgroundColor = bgColor;

          // M√†u cho c·∫ßn mua th√™m
          let needColor = '#10b981';
          if (r.need > r.order * 0.5) needColor = '#ef4444';
          else if (r.need > r.order * 0.3) needColor = '#f59e0b';
          
          tr.innerHTML = `
            <td><strong style="color: #1e293b;">${r.name}</strong></td>
            <td><span style="display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; background: ${r.category === 'C√¥ng c·ª• s·∫£n xu·∫•t' ? '#dbeafe' : '#f0fdf4'}; color: ${r.category === 'C√¥ng c·ª• s·∫£n xu·∫•t' ? '#2563eb' : '#059669'};">${r.category}</span></td>
            <td style="text-align: right; color: #64748b; font-weight: 500;">${r.order}</td>
            <td style="text-align: right; color: #10b981; font-weight: 600;">${r.stock}</td>
            <td style="text-align: right; color: ${needColor}; font-weight: 700; font-size: 14px;">${r.need}</td>
            <td style="text-align: right; color: #64748b; font-weight: 500;">${r.planned}</td>
            <td style="text-align: right; color: #1e293b; font-weight: 600;">${r.costM.toFixed(1)}</td>
          `;
          tbody.appendChild(tr);
        });
      };

      const renderXNTHeatmap = () => {
        const chart = chartsById['chart-xnt-heatmap'];
        if (!chart) return;

        const items = ['Th√©p t·∫•m', '·ªêng th√©p', 'D√¢y h√†n', 'S∆°n', 'Kh√≠ CO2', 'ƒêƒ©a m√†i'];
        const categories = ['C√¥ng c·ª• SX', 'V·∫≠t t∆∞ SX'];
        
        const data = [
          [0, 0, 45], [0, 1, 98],
          [1, 0, 38], [1, 1, 112],
          [2, 0, 28], [2, 1, 88],
          [3, 0, 32], [3, 1, 65],
          [4, 0, 42], [4, 1, 74],
          [5, 0, 35], [5, 1, 56]
        ];

        chart.setOption({
          tooltip: { position: 'top', formatter: params => `${items[params.value[0]]} - ${categories[params.value[1]]}: ${params.value[2]} t·ª∑` },
          grid: { left: 100, right: 40, top: 20, bottom: 60 },
          xAxis: { type: 'category', data: categories, axisLabel: { color: '#334155', fontSize: 11 } },
          yAxis: { type: 'category', data: items, axisLabel: { color: '#1e293b', fontSize: 12, fontWeight: 600 } },
          visualMap: { min: 0, max: 120, calculable: true, orient: 'horizontal', left: 'center', bottom: 0, inRange: { color: ['#dbeafe', '#60a5fa', '#3b82f6', '#2563eb', '#1d4ed8'] }, text: ['Cao', 'Th·∫•p'] },
          series: [{ type: 'heatmap', data: data.map(d => ({ value: d, name: `${items[d[0]]} - ${categories[d[1]]}` })), label: { show: true, fontSize: 12, fontWeight: 700 }, itemStyle: { borderColor: '#fff', borderWidth: 2 } }]
        });
      };

      const renderXNTDept = () => {
        const chart = chartsById['chart-xnt-dept'];
        if (!chart) return;

        const depts = ['MNR - T·ªï 1', 'MNR - T·ªï 2', 'MNR - T·ªï 3', 'MNR - T·ªï 4', 'MNR - T·ªï 5'];
        const exports = [128, 145, 112, 136, 98];

        chart.setOption({
          tooltip: { trigger: 'axis', formatter: '{b}: {c} tri·ªáu' },
          grid: { left: '15%', right: '4%', bottom: '12%', top: '10%' },
          xAxis: { 
            type: 'value', 
            axisLabel: { formatter: '{value}', color: '#64748b' },
            splitLine: { lineStyle: { color: '#f1f5f9' } }
          },
          yAxis: { 
            type: 'category', 
            data: depts, 
            axisLabel: { color: '#334155', fontSize: 11, fontWeight: 600 } 
          },
          series: [{
            name: 'Gi√° tr·ªã xu·∫•t',
            type: 'bar', 
            data: exports, 
            itemStyle: { 
              color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                { offset: 0, color: '#ef4444' },
                { offset: 1, color: '#fca5a5' }
              ]),
              borderRadius: 4 
            },
            label: {
              show: true,
              position: 'right',
              formatter: '{c}',
              color: '#1e293b',
              fontWeight: 600
            }
          }]
        });
      };

      const renderXNTTable = (records) => {
        const tbody = byId('xntTableDetail')?.querySelector('tbody');
        if (!tbody) return;

        tbody.innerHTML = '';
        records.forEach((r, idx) => {
          const tr = document.createElement('tr');
          const bgColor = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
          tr.style.backgroundColor = bgColor;

          const valueM = (r.endQty * r.unitPrice).toFixed(1);
          
          tr.innerHTML = `
            <td style="color: #64748b; font-size: 13px;">${r.code}</td>
            <td><strong style="color: #1e293b;">${r.name}</strong></td>
            <td><span style="display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; background: ${r.category === 'C√¥ng c·ª• s·∫£n xu·∫•t' ? '#dbeafe' : '#f0fdf4'}; color: ${r.category === 'C√¥ng c·ª• s·∫£n xu·∫•t' ? '#2563eb' : '#059669'};">${r.category}</span></td>
            <td style="text-align: right; color: #64748b;">${r.beginQty}</td>
            <td style="text-align: right; color: #3b82f6; font-weight: 600;">${r.importQty}</td>
            <td style="text-align: right; color: #ef4444; font-weight: 600;">${r.exportQty}</td>
            <td style="text-align: right; color: #10b981; font-weight: 600;">${r.endQty}</td>
            <td style="color: #64748b;">${r.unit}</td>
            <td style="text-align: right; color: #1e293b; font-weight: 600;">${valueM}</td>
          `;
          tbody.appendChild(tr);
        });
      };

      const render = () => {
        const month = xntFilterMonth.value;
        const category = xntFilterCategory.value;
        
        let filtered = sampleXNTData.filter(r => r.month === month);
        if (category !== 'T·∫•t c·∫£') {
          filtered = filtered.filter(r => r.category === category);
        }

        renderXNTKpis(filtered);
        renderXNTTimeseries();
        renderXNTCategory(filtered);
        renderXNTFulfillment();
        renderXNTOrderTable();
        renderXNTDept();
        renderXNTTable(filtered);
      };

      xntFilterMonth.addEventListener('change', render);
      xntFilterCategory.addEventListener('change', render);
      render();
    };

    const initRepairReport = () => {
      const scFilterMonth = byId('scFilterMonth');
      const scFilterDeviceType = byId('scFilterDeviceType');
      const scFilterRepairType = byId('scFilterRepairType');

      if (!scFilterMonth || !scFilterDeviceType || !scFilterRepairType) return;

      const months = ['2025-07', '2025-08', '2025-09', '2025-10', '2025-11', '2025-12', '2026-01'];

      const deviceTypes = ['S√† lan', 'C·∫©u', 'Xe n√¢ng'];
      const repairTypes = ['Ph√°t sinh', 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', 'B·∫£o d∆∞·ª°ng'];

      const issues = [
        'S·ª≠a h·ªá th·ªëng l√†m m√°t',
        'Thay m√° phanh',
        'H·ªèng h·ªá th·ªëng ƒëi·ªÅu khi·ªÉn',
        'Thay piston',
        'L·ªói ƒë·ªông c∆°',
        'H·ªèng b∆°m n∆∞·ªõc',
        'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c',
        'H·ªèng ƒëi·ªán',
        'Thay d·∫ßu nh·ªõt',
        'B·∫£o tr√¨ ƒë·ªãnh k·ª≥'
      ];

      const issueToCategory = {
        'S·ª≠a h·ªá th·ªëng l√†m m√°t': 'ƒê·ªông c∆°',
        'Thay m√° phanh': 'Kh√°c',
        'H·ªèng h·ªá th·ªëng ƒëi·ªÅu khi·ªÉn': 'ƒêi·ªán',
        'Thay piston': 'ƒê·ªông c∆°',
        'L·ªói ƒë·ªông c∆°': 'ƒê·ªông c∆°',
        'H·ªèng b∆°m n∆∞·ªõc': 'ƒê·ªông c∆°',
        'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c': 'H·ªá th·ªëng th·ªßy l·ª±c',
        'H·ªèng ƒëi·ªán': 'ƒêi·ªán',
        'Thay d·∫ßu nh·ªõt': 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥',
        'B·∫£o tr√¨ ƒë·ªãnh k·ª≥': 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥'
      };

      const sampleRecords = [
        // Th√°ng 01/2026
        { code: 'SC-2026-001', month: '2026-01', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'Thay piston', start: '2026-01-02', end: '2026-01-08', days: 6, costM: 85, status: 'Ho√†n th√†nh' },
        { code: 'SC-2026-002', month: '2026-01', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c', start: '2026-01-03', end: '2026-01-09', days: 6, costM: 72, status: 'Ho√†n th√†nh' },
        { code: 'SC-2026-003', month: '2026-01', device: 'C·∫©u C-01', deviceType: 'C·∫©u', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'H·ªèng ƒëi·ªán', start: '2026-01-04', end: '2026-01-07', days: 3, costM: 42, status: 'Ho√†n th√†nh' },
        { code: 'SC-2026-004', month: '2026-01', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'Ph√°t sinh', issue: 'H·ªèng b∆°m n∆∞·ªõc', start: '2026-01-05', end: '2026-01-10', days: 5, costM: 58, status: 'ƒêang s·ª≠a' },
        { code: 'SC-2026-005', month: '2026-01', device: 'Xe n√¢ng XN-01', deviceType: 'Xe n√¢ng', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', start: '2026-01-06', end: '2026-01-06', days: 0.5, costM: 18, status: 'Ho√†n th√†nh' },
        { code: 'SC-2026-006', month: '2026-01', device: 'Xe n√¢ng XN-02', deviceType: 'Xe n√¢ng', repairType: 'Ph√°t sinh', issue: 'H·ªèng h·ªá th·ªëng ƒëi·ªÅu khi·ªÉn', start: '2026-01-07', end: null, days: 0, costM: 64, status: 'Ch·ªù' },
        { code: 'SC-2026-007', month: '2026-01', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'Thay d·∫ßu nh·ªõt', start: '2026-01-12', end: '2026-01-12', days: 0.5, costM: 15, status: 'Ho√†n th√†nh' },
        { code: 'SC-2026-008', month: '2026-01', device: 'C·∫©u C-01', deviceType: 'C·∫©u', repairType: 'Ph√°t sinh', issue: 'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c', start: '2026-01-14', end: '2026-01-18', days: 4, costM: 54, status: 'Ho√†n th√†nh' },
        { code: 'SC-2026-009', month: '2026-01', device: 'Xe n√¢ng XN-01', deviceType: 'Xe n√¢ng', repairType: 'Ph√°t sinh', issue: 'Thay m√° phanh', start: '2026-01-16', end: '2026-01-17', days: 1, costM: 22, status: 'Ho√†n th√†nh' },
        { code: 'SC-2026-010', month: '2026-01', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'H·ªèng ƒëi·ªán', start: '2026-01-20', end: '2026-01-22', days: 2, costM: 38, status: 'Ho√†n th√†nh' },

        // Th√°ng 12/2025
        { code: 'SC-2025-120', month: '2025-12', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'S·ª≠a h·ªá th·ªëng l√†m m√°t', start: '2025-12-03', end: '2025-12-06', days: 3, costM: 46, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-121', month: '2025-12', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'L·ªói ƒë·ªông c∆°', start: '2025-12-04', end: '2025-12-11', days: 7, costM: 96, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-122', month: '2025-12', device: 'C·∫©u C-01', deviceType: 'C·∫©u', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'Thay d·∫ßu nh·ªõt', start: '2025-12-08', end: '2025-12-08', days: 0.5, costM: 14, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-123', month: '2025-12', device: 'Xe n√¢ng XN-01', deviceType: 'Xe n√¢ng', repairType: 'Ph√°t sinh', issue: 'Thay m√° phanh', start: '2025-12-12', end: '2025-12-13', days: 1, costM: 22, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-124', month: '2025-12', device: 'Xe n√¢ng XN-02', deviceType: 'Xe n√¢ng', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'H·ªèng ƒëi·ªán', start: '2025-12-18', end: '2025-12-21', days: 3, costM: 35, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-125', month: '2025-12', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'H·ªèng b∆°m n∆∞·ªõc', start: '2025-12-15', end: '2025-12-19', days: 4, costM: 55, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-126', month: '2025-12', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'Ph√°t sinh', issue: 'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c', start: '2025-12-22', end: '2025-12-26', days: 4, costM: 60, status: 'Ho√†n th√†nh' },

        // Th√°ng 11/2025
        { code: 'SC-2025-110', month: '2025-11', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'Thay d·∫ßu nh·ªõt', start: '2025-11-05', end: '2025-11-05', days: 0.5, costM: 16, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-111', month: '2025-11', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'Ph√°t sinh', issue: 'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c', start: '2025-11-09', end: '2025-11-13', days: 4, costM: 54, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-112', month: '2025-11', device: 'Xe n√¢ng XN-01', deviceType: 'Xe n√¢ng', repairType: 'Ph√°t sinh', issue: 'H·ªèng h·ªá th·ªëng ƒëi·ªÅu khi·ªÉn', start: '2025-11-12', end: '2025-11-16', days: 4, costM: 48, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-113', month: '2025-11', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'Thay piston', start: '2025-11-18', end: '2025-11-24', days: 6, costM: 82, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-114', month: '2025-11', device: 'C·∫©u C-01', deviceType: 'C·∫©u', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'H·ªèng ƒëi·ªán', start: '2025-11-20', end: '2025-11-22', days: 2, costM: 34, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-115', month: '2025-11', device: 'Xe n√¢ng XN-02', deviceType: 'Xe n√¢ng', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', start: '2025-11-25', end: '2025-11-25', days: 0.5, costM: 16, status: 'Ho√†n th√†nh' },

        // Th√°ng 10/2025
        { code: 'SC-2025-100', month: '2025-10', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'H·ªèng b∆°m n∆∞·ªõc', start: '2025-10-02', end: '2025-10-06', days: 4, costM: 52, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-101', month: '2025-10', device: 'C·∫©u C-01', deviceType: 'C·∫©u', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'H·ªèng ƒëi·ªán', start: '2025-10-10', end: '2025-10-12', days: 2, costM: 28, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-102', month: '2025-10', device: 'Xe n√¢ng XN-02', deviceType: 'Xe n√¢ng', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', start: '2025-10-18', end: '2025-10-18', days: 0.5, costM: 12, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-103', month: '2025-10', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'L·ªói ƒë·ªông c∆°', start: '2025-10-14', end: '2025-10-20', days: 6, costM: 89, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-104', month: '2025-10', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'Ph√°t sinh', issue: 'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c', start: '2025-10-22', end: '2025-10-26', days: 4, costM: 56, status: 'Ho√†n th√†nh' },

        // Th√°ng 09/2025
        { code: 'SC-2025-090', month: '2025-09', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'L·ªói ƒë·ªông c∆°', start: '2025-09-04', end: '2025-09-10', days: 6, costM: 88, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-091', month: '2025-09', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'Thay m√° phanh', start: '2025-09-12', end: '2025-09-13', days: 1, costM: 18, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-092', month: '2025-09', device: 'Xe n√¢ng XN-01', deviceType: 'Xe n√¢ng', repairType: 'Ph√°t sinh', issue: 'H·ªèng ƒëi·ªán', start: '2025-09-20', end: '2025-09-22', days: 2, costM: 24, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-093', month: '2025-09', device: 'Xe n√¢ng XN-02', deviceType: 'Xe n√¢ng', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', start: '2025-09-15', end: '2025-09-15', days: 0.5, costM: 14, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-094', month: '2025-09', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'S·ª≠a h·ªá th·ªëng l√†m m√°t', start: '2025-09-25', end: '2025-09-28', days: 3, costM: 48, status: 'Ho√†n th√†nh' },

        // Th√°ng 08/2025
        { code: 'SC-2025-081', month: '2025-08', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'Thay d·∫ßu nh·ªõt', start: '2025-08-02', end: '2025-08-02', days: 0.5, costM: 15, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-082', month: '2025-08', device: 'C·∫©u C-01', deviceType: 'C·∫©u', repairType: 'Ph√°t sinh', issue: 'R√≤ r·ªâ d·∫ßu th·ªßy l·ª±c', start: '2025-08-08', end: '2025-08-12', days: 4, costM: 50, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-083', month: '2025-08', device: 'Xe n√¢ng XN-02', deviceType: 'Xe n√¢ng', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'H·ªèng h·ªá th·ªëng ƒëi·ªÅu khi·ªÉn', start: '2025-08-21', end: '2025-08-24', days: 3, costM: 40, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-084', month: '2025-08', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'H·ªèng b∆°m n∆∞·ªõc', start: '2025-08-16', end: '2025-08-20', days: 4, costM: 58, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-085', month: '2025-08', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'B·∫£o d∆∞·ª°ng', issue: 'H·ªèng ƒëi·ªán', start: '2025-08-28', end: '2025-08-30', days: 2, costM: 32, status: 'Ho√†n th√†nh' },

        // Th√°ng 07/2025
        { code: 'SC-2025-071', month: '2025-07', device: 'S√† lan SL-01', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'S·ª≠a h·ªá th·ªëng l√†m m√°t', start: '2025-07-05', end: '2025-07-08', days: 3, costM: 44, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-072', month: '2025-07', device: 'C·∫©u C-02', deviceType: 'C·∫©u', repairType: 'Ph√°t sinh', issue: 'H·ªèng ƒëi·ªán', start: '2025-07-10', end: '2025-07-12', days: 2, costM: 26, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-073', month: '2025-07', device: 'Xe n√¢ng XN-01', deviceType: 'Xe n√¢ng', repairType: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', issue: 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', start: '2025-07-16', end: '2025-07-16', days: 0.5, costM: 12, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-074', month: '2025-07', device: 'S√† lan SL-02', deviceType: 'S√† lan', repairType: 'Ph√°t sinh', issue: 'Thay piston', start: '2025-07-20', end: '2025-07-26', days: 6, costM: 84, status: 'Ho√†n th√†nh' },
        { code: 'SC-2025-075', month: '2025-07', device: 'Xe n√¢ng XN-02', deviceType: 'Xe n√¢ng', repairType: 'Ph√°t sinh', issue: 'Thay m√° phanh', start: '2025-07-24', end: '2025-07-25', days: 1, costM: 20, status: 'Ho√†n th√†nh' }
      ].map(r => ({ ...r, category: issueToCategory[r.issue] || 'Kh√°c' }));

      const fillSelect = (select, options, defaultValue) => {
        select.innerHTML = '';
        options.forEach(({ value, label }) => {
          const opt = document.createElement('option');
          opt.value = value;
          opt.textContent = label;
          select.appendChild(opt);
        });
        select.value = defaultValue;
      };

      fillSelect(scFilterMonth, months.map(m => ({ value: m, label: formatMonthLabel(m) })), months[months.length - 1]);
      fillSelect(scFilterDeviceType, [{ value: 'T·∫•t c·∫£', label: 'T·∫•t c·∫£' }, ...deviceTypes.map(t => ({ value: t, label: t }))], 'T·∫•t c·∫£');
      fillSelect(scFilterRepairType, [{ value: 'T·∫•t c·∫£', label: 'T·∫•t c·∫£' }, ...repairTypes.map(t => ({ value: t, label: t }))], 'T·∫•t c·∫£');

      const getFilters = () => ({
        month: scFilterMonth.value,
        deviceType: scFilterDeviceType.value,
        repairType: scFilterRepairType.value
      });

      const applyFilters = (records, f) => records.filter(r => {
        if (r.month !== f.month) return false;
        if (f.deviceType !== 'T·∫•t c·∫£' && r.deviceType !== f.deviceType) return false;
        if (f.repairType !== 'T·∫•t c·∫£' && r.repairType !== f.repairType) return false;
        return true;
      });

      const applyFiltersForMonth = (records, monthKey, f) => records.filter(r => {
        if (r.month !== monthKey) return false;
        if (f.deviceType !== 'T·∫•t c·∫£' && r.deviceType !== f.deviceType) return false;
        if (f.repairType !== 'T·∫•t c·∫£' && r.repairType !== f.repairType) return false;
        return true;
      });

      const sum = (arr) => arr.reduce((a, b) => a + b, 0);
      const avg = (arr) => (arr.length ? sum(arr) / arr.length : 0);

      const renderKpis = (currentRecords, prevRecords, monthLabel) => {
        const currentRepairs = currentRecords.length;
        const prevRepairs = prevRecords.length;
        const repairsDelta = toPercentDelta(currentRepairs, prevRepairs);
        setText('scKpiRepairs', `${currentRepairs}`);
        setText('scKpiRepairsNote', `${monthLabel} | ${prevRepairs ? (currentRepairs - prevRepairs >= 0 ? '+' : '') + (currentRepairs - prevRepairs) : 0} vs th√°ng tr∆∞·ªõc`);

        const repairsDeltaEl = byId('scKpiRepairsDelta');
        if (repairsDeltaEl) {
          const isUp = repairsDelta >= 0;
          repairsDeltaEl.classList.toggle('up', isUp);
          repairsDeltaEl.classList.toggle('down', !isUp);
          repairsDeltaEl.textContent = `${repairsDelta >= 0 ? '+' : ''}${Math.round(repairsDelta)}%`;
        }

        const currentCostM = sum(currentRecords.map(r => r.costM));
        const prevCostM = sum(prevRecords.map(r => r.costM));
        const costDelta = toPercentDelta(currentCostM, prevCostM);
        setText('scKpiCost', formatBillion(currentCostM));
        setText('scKpiCostNote', 'Chi ph√≠ s·ª≠a ch·ªØa th√°ng n√†y');
        setText('scKpiCostDelta', `${costDelta >= 0 ? '+' : ''}${Math.round(costDelta)}%`);

        const currentAvgDays = avg(currentRecords.map(r => r.days));
        const prevAvgDays = avg(prevRecords.map(r => r.days));
        const avgDelta = toPercentDelta(currentAvgDays, prevAvgDays);
        setText('scKpiAvg', `${currentAvgDays.toFixed(1)} ng√†y`);
        setText('scKpiAvgDelta', `${avgDelta >= 0 ? '+' : ''}${Math.round(avgDelta)}%`);

        const openCount = currentRecords.filter(r => r.status !== 'Ho√†n th√†nh').length;
        setText('scKpiOpen', `${openCount}`);
      };

      const renderTimeseriesChart = (f) => {
        const monthIndex = months.indexOf(f.month);
        const windowMonths = months.slice(Math.max(0, monthIndex - 6), monthIndex + 1);
        const labels = windowMonths.map(m => `T${parseInt(m.split('-')[1], 10)}`);

        const counts = windowMonths.map(m => applyFiltersForMonth(sampleRecords, m, f).length);
        const costsB = windowMonths.map(m => sum(applyFiltersForMonth(sampleRecords, m, f).map(r => r.costM)) / 1000);

        const chart = chartsById['chart-sc-timeseries'];
        if (!chart) return;
        chart.setOption({
          xAxis: { data: labels },
          series: [
            { 
              name: 'S·ªë l·∫ßn', 
              type: 'bar', 
              yAxisIndex: 0, 
              data: counts, 
              itemStyle: { 
                color: '#ef4444',
                borderRadius: [6, 6, 0, 0]
              }, 
              barWidth: 24
            },
            { 
              name: 'Chi ph√≠ (t·ª∑)', 
              type: 'line', 
              yAxisIndex: 1, 
              data: costsB.map(v => Number(v.toFixed(2))), 
              smooth: true, 
              lineStyle: { 
                color: '#f59e0b', 
                width: 3 
              }, 
              itemStyle: {
                color: '#f59e0b'
              },
              symbol: 'circle', 
              symbolSize: 8
            }
          ]
        }, { notMerge: false });
      };

      const renderTypeChart = (records) => {
        const totals = repairTypes.map(t => ({ name: t, value: records.filter(r => r.repairType === t).length }));
        const chart = chartsById['chart-sc-type'];
        if (!chart) return;
        chart.setOption({
          series: [{
            data: totals,
            label: { 
              show: true,
              formatter: '{b}\n{c} l·∫ßn ({d}%)',
              fontSize: 12,
              color: '#fff',
              fontWeight: 600,
              lineHeight: 18
            },
            emphasis: {
              label: {
                show: true,
                fontSize: 14,
                fontWeight: 'bold'
              }
            },
            itemStyle: {
              borderRadius: 4,
              borderColor: '#fff',
              borderWidth: 2
            }
          }],
          color: ['#ef4444', '#3b82f6', '#10b981']
        }, { notMerge: false });
      };

      const renderTopIssuesChart = (records) => {
        const counts = {};
        records.forEach(r => { counts[r.issue] = (counts[r.issue] || 0) + 1; });
        const sorted = Object.entries(counts)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10);

        const labels = sorted.map(([k]) => k).reverse();
        const values = sorted.map(([, v]) => v).reverse();

        const chart = chartsById['chart-sc-topissues'];
        if (!chart) return;
        
        // T·∫°o m√†u gradient t·ª´ ƒë·ªè -> cam -> v√†ng cho m·ªói bar
        const colors = values.map((val, idx) => {
          const ratio = idx / (values.length - 1);
          if (ratio < 0.33) return '#dc2626'; // ƒê·ªè ƒë·∫≠m
          if (ratio < 0.5) return '#ef4444'; // ƒê·ªè
          if (ratio < 0.66) return '#f97316'; // Cam
          if (ratio < 0.83) return '#fb923c'; // Cam nh·∫°t
          return '#fbbf24'; // V√†ng
        });
        
        chart.setOption({
          yAxis: { data: labels },
          series: [{
            data: values.map((val, idx) => ({
              value: val,
              itemStyle: {
                color: colors[idx]
              }
            }))
          }]
        }, { notMerge: false });
      };

      const renderHeatmapChart = (records) => {
        const chart = chartsById['chart-sc-heatmap'];
        if (!chart) return;

        // Danh s√°ch thi·∫øt b·ªã v√† lo·∫°i s·ª≠a ch·ªØa (ƒë·ªïi ng∆∞·ª£c: thi·∫øt b·ªã Y, lo·∫°i X)
        const devices = ['S√† lan SL-01', 'S√† lan SL-02', 'C·∫©u C-01', 'C·∫©u C-02', 'Xe n√¢ng XN-01', 'Xe n√¢ng XN-02'];
        const categories = ['ƒê·ªông c∆°', 'H·ªá th·ªëng th·ªßy l·ª±c', 'ƒêi·ªán', 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', 'Kh√°c'];
        
        // Fake data s·ªë l·∫ßn - [xIdx (category), yIdx (device), count]
        const heatmapDataCount = [
          [0, 0, 8], [1, 0, 12], [2, 0, 5], [3, 0, 6], [4, 0, 3],
          [0, 1, 15], [1, 1, 6], [2, 1, 7], [3, 1, 4], [4, 1, 2],
          [0, 2, 4], [1, 2, 18], [2, 2, 9], [3, 2, 8], [4, 2, 4],
          [0, 3, 11], [1, 3, 7], [2, 3, 12], [3, 3, 7], [4, 3, 5],
          [0, 4, 6], [1, 4, 5], [2, 4, 14], [3, 4, 6], [4, 4, 3],
          [0, 5, 5], [1, 5, 5], [2, 5, 16], [3, 5, 5], [4, 5, 2]
        ];

        // Fake data chi ph√≠ (tri·ªáu VNƒê)
        const heatmapDataCost = [
          [0, 0, 68], [1, 0, 96], [2, 0, 42], [3, 0, 54], [4, 0, 24],
          [0, 1, 120], [1, 1, 48], [2, 1, 56], [3, 1, 32], [4, 1, 16],
          [0, 2, 32], [1, 2, 144], [2, 2, 72], [3, 2, 64], [4, 2, 32],
          [0, 3, 88], [1, 3, 56], [2, 3, 96], [3, 3, 56], [4, 3, 40],
          [0, 4, 48], [1, 4, 40], [2, 4, 112], [3, 4, 48], [4, 4, 24],
          [0, 5, 40], [1, 5, 40], [2, 5, 128], [3, 5, 40], [4, 5, 16]
        ];

        const updateChart = (mode) => {
          const isCount = mode === 'count';
          const data = isCount ? heatmapDataCount : heatmapDataCost;
          
          chart.setOption({
            xAxis: { data: categories },
            yAxis: { data: devices },
            visualMap: {
              min: 0,
              max: isCount ? 20 : 150,
              text: isCount ? ['Nhi·ªÅu', 'Th·∫•p'] : ['Cao', 'Th·∫•p']
            },
            tooltip: {
              position: 'top',
              formatter: function(params) {
                const val = params.value[2];
                const unit = isCount ? ' l·∫ßn' : ' tri·ªáu';
                return params.marker + params.name + ': <b>' + val + unit + '</b>';
              }
            },
            series: [{
              data: data.map(d => ({
                value: [d[0], d[1], d[2]],
                name: categories[d[0]] + ' - ' + devices[d[1]]
              })),
              itemStyle: {
                borderColor: '#fff',
                borderWidth: 2
              }
            }]
          }, { notMerge: false });
        };

        // Kh·ªüi t·∫°o v·ªõi s·ªë l·∫ßn
        updateChart('count');

        // X·ª≠ l√Ω n√∫t
        const btnCount = document.getElementById('btnHeatmapCount');
        const btnCost = document.getElementById('btnHeatmapCost');
        
        if (btnCount && btnCost) {
          btnCount.onclick = () => {
            updateChart('count');
            btnCount.style.background = '#3b82f6';
            btnCount.style.color = 'white';
            btnCount.style.borderColor = '#3b82f6';
            btnCost.style.background = 'white';
            btnCost.style.color = '#64748b';
            btnCost.style.borderColor = '#e2e8f0';
          };
          
          btnCost.onclick = () => {
            updateChart('cost');
            btnCost.style.background = '#3b82f6';
            btnCost.style.color = 'white';
            btnCost.style.borderColor = '#3b82f6';
            btnCount.style.background = 'white';
            btnCount.style.color = '#64748b';
            btnCount.style.borderColor = '#e2e8f0';
          };
        }
      };

      const renderDeviceTable = (records) => {
        const tbody = byId('scTableDevice')?.querySelector('tbody');
        if (!tbody) return;
        const grouped = {};
        records.forEach(r => {
          grouped[r.device] = grouped[r.device] || { device: r.device, days: [], count: 0, cost: 0 };
          grouped[r.device].days.push(r.days);
          grouped[r.device].count += 1;
          grouped[r.device].cost += r.costM;
        });

        const rows = Object.values(grouped)
          .map(g => ({
            device: g.device,
            avgDays: avg(g.days),
            count: g.count,
            cost: g.cost
          }))
          .sort((a, b) => b.avgDays - a.avgDays);

        tbody.innerHTML = '';
        rows.forEach((r, idx) => {
          const tr = document.createElement('tr');
          
          // M√†u cho th·ªùi gian: ƒë·ªè n·∫øu > 3 ng√†y, v√†ng n·∫øu 1-3, xanh n·∫øu < 1
          let daysColor = '#10b981'; // xanh l√°
          if (r.avgDays > 3) daysColor = '#ef4444'; // ƒë·ªè
          else if (r.avgDays > 1) daysColor = '#f59e0b'; // cam/v√†ng
          
          // M√†u cho chi ph√≠: ƒë·ªè n·∫øu > 150, v√†ng n·∫øu 80-150, xanh n·∫øu < 80
          let costColor = '#10b981';
          if (r.cost > 150) costColor = '#ef4444';
          else if (r.cost > 80) costColor = '#f59e0b';
          
          // M√†u n·ªÅn xen k·∫Ω cho d·ªÖ ƒë·ªçc
          const bgColor = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
          tr.style.backgroundColor = bgColor;
          
          // T√≠nh % cho thanh bar (max = max cost trong data)
          const maxCost = Math.max(...rows.map(row => row.cost));
          const barWidth = (r.cost / maxCost) * 100;
          
          tr.innerHTML = `
            <td><strong style="color: #1e293b;">${r.device}</strong></td>
            <td style="color: ${daysColor}; font-weight: 600;">${r.avgDays.toFixed(1)}</td>
            <td style="color: #64748b; font-weight: 500;">${r.count}</td>
            <td style="position: relative; padding-right: 8px;">
              <div style="position: relative; display: flex; align-items: center; gap: 8px;">
                <div style="flex: 0 0 auto; color: ${costColor}; font-weight: 600; z-index: 2; min-width: 60px;">${formatMillions(r.cost)}</div>
                <div style="flex: 1; height: 20px; background: #f1f5f9; border-radius: 4px; overflow: hidden; position: relative;">
                  <div style="height: 100%; background: linear-gradient(to right, ${costColor}40, ${costColor}); width: ${barWidth}%; transition: width 0.3s ease;"></div>
                </div>
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });
      };

      const renderHeatmapTable = (records) => {
        const tbody = byId('scTableHeatmap')?.querySelector('tbody');
        if (!tbody) return;
        const categories = ['ƒê·ªông c∆°', 'H·ªá th·ªëng th·ªßy l·ª±c', 'ƒêi·ªán', 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥', 'Kh√°c'];

        // Create enhanced heatmap data with better visual distribution
        const heatmapData = [
          { device: 'S√† lan SL-01', 'ƒê·ªông c∆°': 12, 'H·ªá th·ªëng th·ªßy l·ª±c': 8, 'ƒêi·ªán': 3, 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥': 4, 'Kh√°c': 2 },
          { device: 'S√† lan SL-02', 'ƒê·ªông c∆°': 7, 'H·ªá th·ªëng th·ªßy l·ª±c': 10, 'ƒêi·ªán': 5, 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥': 4, 'Kh√°c': 1 },
          { device: 'C·∫©u C-01', 'ƒê·ªông c∆°': 5, 'H·ªá th·ªëng th·ªßy l·ª±c': 15, 'ƒêi·ªán': 6, 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥': 6, 'Kh√°c': 3 },
          { device: 'C·∫©u C-02', 'ƒê·ªông c∆°': 9, 'H·ªá th·ªëng th·ªßy l·ª±c': 4, 'ƒêi·ªán': 8, 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥': 5, 'Kh√°c': 4 },
          { device: 'Xe n√¢ng XN-01', 'ƒê·ªông c∆°': 4, 'H·ªá th·ªëng th·ªßy l·ª±c': 5, 'ƒêi·ªán': 8, 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥': 3, 'Kh√°c': 2 },
          { device: 'Xe n√¢ng XN-02', 'ƒê·ªông c∆°': 3, 'H·ªá th·ªëng th·ªßy l·ª±c': 4, 'ƒêi·ªán': 9, 'B·∫£o tr√¨ ƒë·ªãnh k·ª≥': 3, 'Kh√°c': 1 }
        ];

        const maxVal = Math.max(1, ...heatmapData.flatMap(row => categories.map(c => row[c] || 0)));
        const cellStyle = (val) => {
          const a = clamp(val / maxVal, 0, 1);
          const alpha = 0.12 + a * 0.55;
          const bg = `rgba(37, 99, 235, ${alpha})`;
          const fg = alpha > 0.38 ? '#0b1220' : '#0f172a';
          return { bg, fg };
        };

        tbody.innerHTML = '';
        heatmapData.forEach(row => {
          const tr = document.createElement('tr');
          const cells = categories.map(c => {
            const v = row[c] || 0;
            const { bg, fg } = cellStyle(v);
            return `<td><span class="heat-cell" style="background:${bg};color:${fg};">${v}</span></td>`;
          }).join('');
          tr.innerHTML = `<td><strong>${row.device}</strong></td>${cells}`;
          tbody.appendChild(tr);
        });

        const legend = byId('scHeatLegend');
        if (legend) {
          const maxEl = legend.querySelector('.legend-max');
          if (maxEl) maxEl.textContent = `${maxVal}`;
        }
      };

      const renderHistoryTable = (records) => {
        const tbody = byId('scTableHistory')?.querySelector('tbody');
        if (!tbody) return;

        const statusClass = (s) => {
          if (s === 'Ho√†n th√†nh') return 'done';
          if (s === 'ƒêang s·ª≠a') return 'inprogress';
          return 'pending';
        };

        tbody.innerHTML = '';
        records
          .slice()
          .sort((a, b) => (b.start > a.start ? 1 : -1))
          .forEach((r, idx) => {
            const tr = document.createElement('tr');
            
            // M√†u cho s·ªë ng√†y
            let daysColor = '#10b981'; // xanh
            if (r.days > 5) daysColor = '#ef4444'; // ƒë·ªè
            else if (r.days > 2) daysColor = '#f59e0b'; // cam
            
            // M√†u cho chi ph√≠
            let costColor = '#64748b';
            if (r.costM > 70) costColor = '#ef4444';
            else if (r.costM > 40) costColor = '#f59e0b';
            else costColor = '#10b981';
            
            // M√†u n·ªÅn xen k·∫Ω
            const bgColor = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
            tr.style.backgroundColor = bgColor;
            
            // M√†u cho lo·∫°i thi·∫øt b·ªã
            let deviceColor = '#3b82f6';
            if (r.deviceType === 'S√† lan') deviceColor = '#8b5cf6';
            else if (r.deviceType === 'C·∫©u') deviceColor = '#06b6d4';
            else if (r.deviceType === 'Xe n√¢ng') deviceColor = '#10b981';
            
            // M√†u v√† style cho status
            let statusBg = '#dbeafe';
            let statusColor = '#2563eb';
            let statusBorder = '#93c5fd';
            if (r.status === 'Ho√†n th√†nh') {
              statusBg = '#d1fae5';
              statusColor = '#047857';
              statusBorder = '#6ee7b7';
            } else if (r.status === 'ƒêang s·ª≠a') {
              statusBg = '#fef3c7';
              statusColor = '#d97706';
              statusBorder = '#fcd34d';
            } else if (r.status === 'Ch·ªù') {
              statusBg = '#fee2e2';
              statusColor = '#dc2626';
              statusBorder = '#fca5a5';
            }
            
            tr.innerHTML = `
              <td style="color: #64748b; font-size: 13px;">${r.code}</td>
              <td><strong style="color: ${deviceColor};">${r.device}</strong></td>
              <td><span class="chip" style="background: ${r.repairType === 'Ph√°t sinh' ? '#fee2e2' : r.repairType === 'B·∫£o d∆∞·ª°ng' ? '#dbeafe' : '#fef3c7'}; color: ${r.repairType === 'Ph√°t sinh' ? '#dc2626' : r.repairType === 'B·∫£o d∆∞·ª°ng' ? '#2563eb' : '#d97706'}; font-weight: 500;">${r.repairType}</span></td>
              <td style="color: #475569;">${r.issue}</td>
              <td style="color: #64748b; font-size: 13px;">${formatDateVN(r.start)}</td>
              <td style="color: #64748b; font-size: 13px;">${r.end ? formatDateVN(r.end) : '<span style="color: #ef4444;">-</span>'}</td>
              <td style="color: ${daysColor}; font-weight: 600;">${r.days}</td>
              <td style="color: ${costColor}; font-weight: 600;">${formatMillions(r.costM)} tri·ªáu</td>
              <td><span style="display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; background: ${statusBg}; color: ${statusColor}; border: 1.5px solid ${statusBorder};">${r.status}</span></td>
            `;
            tbody.appendChild(tr);
          });
      };

      const render = () => {
        const f = getFilters();
        const currentRecords = applyFilters(sampleRecords, f);
        const monthLabel = formatMonthLabel(f.month);
        const monthIndex = months.indexOf(f.month);
        const prevMonth = monthIndex > 0 ? months[monthIndex - 1] : null;
        const prevRecords = prevMonth ? applyFiltersForMonth(sampleRecords, prevMonth, f) : [];

        renderKpis(currentRecords, prevRecords, monthLabel);
        renderTimeseriesChart(f);
        renderTypeChart(currentRecords);
        renderTopIssuesChart(currentRecords);
        renderDeviceTable(currentRecords);
        renderHeatmapChart(currentRecords);
        renderHistoryTable(currentRecords);
      };

      [scFilterMonth, scFilterDeviceType, scFilterRepairType].forEach(el => el.addEventListener('change', render));
      render();
    };

    const initOverviewReport = () => {
      const ovFilterMonth = byId('ovFilterMonth');
      if (!ovFilterMonth) return;

      const monthlyData = {
        '2026-01': { revenue: 289, revenuePrev: 251, target: 280, cost: 200, costPrev: 184, profit: 89, profitPrev: 79, customers: 1245, newCustomers: 32, loyalCustomers: 892 }
      };

      const updateKPIs = () => {
        const data = monthlyData[ovFilterMonth.value];
        if (!data) return;

        // Gauge chart
        const gaugeEl = document.getElementById('ov-chart-gauge');
        if (gaugeEl) {
          let gaugeChart = chartsById['ov-chart-gauge'];
          if (!gaugeChart) {
            gaugeChart = echarts.init(gaugeEl);
            chartsById['ov-chart-gauge'] = gaugeChart;
          }
          const percentage = Math.round((data.revenue / data.target) * 100);
          gaugeChart.setOption({
            series: [{
              type: 'gauge',
              startAngle: 180,
              endAngle: 0,
              min: 0,
              max: 120,
              radius: '90%',
              center: ['50%', '70%'],
              axisLine: { lineStyle: { width: 20, color: [[0.5, '#ef4444'], [0.8, '#f59e0b'], [1, '#10b981']] } },
              pointer: { length: '70%', width: 5, itemStyle: { color: '#1e293b' } },
              axisTick: { distance: -20, length: 5, lineStyle: { color: '#fff', width: 1 } },
              splitLine: { distance: -25, length: 15, lineStyle: { color: '#fff', width: 2 } },
              axisLabel: { color: '#64748b', distance: 15, fontSize: 10 },
              detail: { valueAnimation: true, formatter: percentage + '%', color: '#1e293b', fontSize: 24, offsetCenter: [0, '10%'], fontWeight: 700 },
              data: [{ value: percentage, name: '' }]
            }]
          });
        }

        byId('ovKpiRevenueValue').textContent = data.revenue + ' t·ª∑';
        byId('ovKpiRevenueTarget').textContent = 'M·ª•c ti√™u: ' + data.target + ' t·ª∑';
        byId('ovKpiProfit').textContent = data.profit + ' t·ª∑';
        const margin = ((data.profit / data.revenue) * 100).toFixed(1);
        byId('ovKpiMargin').textContent = margin + '%';
        const profitChange = ((data.profit - data.profitPrev) / data.profitPrev * 100).toFixed(1);
        byId('ovKpiProfitTrend').textContent = (profitChange >= 0 ? '‚Üë +' : '‚Üì ') + Math.abs(profitChange) + '%';
        byId('ovKpiRevenue').textContent = data.revenue + ' t·ª∑';
        const revenueChange = ((data.revenue - data.revenuePrev) / data.revenuePrev * 100).toFixed(1);
        byId('ovKpiRevenueTrend').textContent = (revenueChange >= 0 ? '‚Üë +' : '‚Üì ') + Math.abs(revenueChange) + '%';
        byId('ovKpiCost').textContent = data.cost + ' t·ª∑';
        const costChange = ((data.cost - data.costPrev) / data.costPrev * 100).toFixed(1);
        byId('ovKpiCostTrend').textContent = (costChange >= 0 ? '‚Üë +' : '‚Üì ') + Math.abs(costChange) + '%';
        byId('ovKpiCustomers').textContent = data.customers.toLocaleString('vi-VN');
        byId('ovKpiNewCustomers').textContent = '+' + data.newCustomers;
        byId('ovKpiLoyalCustomers').textContent = data.loyalCustomers.toLocaleString('vi-VN');
      };

      const renderCharts = () => {
        // Profit Funnel Chart
        const pfEl = document.getElementById('ov-chart-profit-funnel');
        if (pfEl) {
          let chart = chartsById['ov-chart-profit-funnel'];
          if (!chart) { chart = echarts.init(pfEl); chartsById['ov-chart-profit-funnel'] = chart; }
          
          const revenue = 289; // Doanh thu th√°ng hi·ªán t·∫°i (t·ª∑ VND)
          const profitBeforeTax = 89; // L·ª£i nhu·∫≠n tr∆∞·ªõc thu·∫ø
          const profitAfterTax = 71.2; // L·ª£i nhu·∫≠n sau thu·∫ø (89 * 0.8)
          const marginBeforeTax = ((profitBeforeTax / revenue) * 100).toFixed(1);
          const marginAfterTax = ((profitAfterTax / revenue) * 100).toFixed(1);
          
          chart.setOption({
            tooltip: {
              trigger: 'item',
              formatter: (params) => {
                let margin = params.name === 'Doanh thu' ? '100%' : 
                            params.name === 'L·ª£i nhu·∫≠n tr∆∞·ªõc thu·∫ø' ? `${marginBeforeTax}%` : `${marginAfterTax}%`;
                return `${params.name}<br/>` +
                       `${params.marker}Gi√° tr·ªã: <strong>${params.value} t·ª∑</strong><br/>` +
                       `T·ª∑ su·∫•t: <strong>${margin}</strong>`;
              }
            },
            series: [
              {
                name: 'Ph·ªÖu l·ª£i nhu·∫≠n',
                type: 'funnel',
                left: '10%',
                right: '10%',
                top: 30,
                bottom: 30,
                width: '80%',
                min: 0,
                max: revenue,
                minSize: '35%',
                maxSize: '100%',
                sort: 'descending',
                gap: 5,
                label: {
                  show: true,
                  position: 'inside',
                  formatter: (params) => {
                    let margin = params.name === 'Doanh thu' ? '' : 
                                params.name === 'L·ª£i nhu·∫≠n tr∆∞·ªõc thu·∫ø' ? `\nT·ª∑ su·∫•t: ${marginBeforeTax}%` : `\nT·ª∑ su·∫•t: ${marginAfterTax}%`;
                    return `{name|${params.name}}\n{value|${params.value} t·ª∑}${margin}`;
                  },
                  fontSize: 12,
                  fontWeight: 600,
                  color: '#fff',
                  lineHeight: 18,
                  rich: {
                    name: {
                      fontSize: 11,
                      fontWeight: 600,
                      color: 'rgba(255, 255, 255, 0.85)'
                    },
                    value: {
                      fontSize: 16,
                      fontWeight: 700,
                      color: '#fff'
                    }
                  }
                },
                labelLine: {
                  show: false
                },
                itemStyle: {
                  borderColor: 'transparent',
                  borderWidth: 0
                },
                emphasis: {
                  label: {
                    fontSize: 13,
                    fontWeight: 700
                  },
                  itemStyle: {
                    shadowBlur: 0
                  }
                },
                data: [
                  { 
                    value: revenue, 
                    name: 'Doanh thu', 
                    itemStyle: { 
                      color: '#3b82f6'
                    }
                  },
                  { 
                    value: profitBeforeTax, 
                    name: 'L·ª£i nhu·∫≠n tr∆∞·ªõc thu·∫ø', 
                    itemStyle: { 
                      color: '#10b981'
                    }
                  },
                  { 
                    value: profitAfterTax, 
                    name: 'L·ª£i nhu·∫≠n sau thu·∫ø', 
                    itemStyle: { 
                      color: '#059669'
                    }
                  }
                ]
              }
            ]
          });
        }

        // Revenue trend - Doanh thu/Chi ph√≠ = c·ªôt, L·ª£i nhu·∫≠n = ƒë∆∞·ªùng
        const rtEl = document.getElementById('ov-chart-revenue-trend');
        if (rtEl) {
          let chart = chartsById['ov-chart-revenue-trend'];
          if (!chart) { chart = echarts.init(rtEl); chartsById['ov-chart-revenue-trend'] = chart; }
          chart.setOption({
            tooltip: { trigger: 'axis' },
            legend: { data: ['Doanh thu', 'Chi ph√≠', 'L·ª£i nhu·∫≠n'], bottom: 0 },
            grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
            xAxis: { type: 'category', data: ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'] },
            yAxis: { type: 'value', name: 'T·ª∑ VND' },
            series: [
              { name: 'Doanh thu', type: 'bar', data: [245, 258, 268, 272, 279, 285, 289], itemStyle: { color: '#3b82f6', borderRadius: [4, 4, 0, 0] }, barWidth: 18 },
              { name: 'Chi ph√≠', type: 'bar', data: [175, 182, 189, 192, 195, 198, 200], itemStyle: { color: '#f97316', borderRadius: [4, 4, 0, 0] }, barWidth: 18 },
              { name: 'L·ª£i nhu·∫≠n', type: 'line', data: [70, 76, 79, 80, 84, 87, 89], smooth: true, itemStyle: { color: '#10b981' }, lineStyle: { width: 3 }, symbol: 'circle', symbolSize: 8, label: { show: true, position: 'top', fontSize: 10, fontWeight: 600, color: '#10b981' } }
            ]
          });
        }

        // Profit by segment - v·ªõi KPI line v√† nh√£n ch√™nh l·ªách
        const pbsEl = document.getElementById('ov-chart-profit-by-segment');
        if (pbsEl) {
          let chart = chartsById['ov-chart-profit-by-segment'];
          if (!chart) { chart = echarts.init(pbsEl); chartsById['ov-chart-profit-by-segment'] = chart; }
          const segments = ['Khai th√°c', 'Th∆∞∆°ng v·ª•', 'MnR', 'Kho b√£i', 'Kh√°c'];
          const current = [41.6, 25.2, 12.8, 7.8, 1.6];
          const previous = [36.2, 23.1, 11.5, 6.9, 1.5];
          const kpi = [38, 24, 12, 7.5, 1.5]; // KPI cho t·ª´ng m·∫£ng
          const changes = current.map((v, i) => ((v - previous[i]) / previous[i] * 100).toFixed(1));
          
          chart.setOption({
            tooltip: { 
              trigger: 'axis',
              formatter: (params) => {
                let result = params[0].name + '<br/>';
                params.forEach(p => {
                  if (p.seriesName === 'L·ª£i nhu·∫≠n') {
                    const idx = segments.indexOf(p.name);
                    const change = changes[idx];
                    result += `${p.marker}${p.seriesName}: ${p.value} t·ª∑<br/>`;
                    result += `Ch√™nh k·ª≥ tr∆∞·ªõc: <span style="color: ${change >= 0 ? '#10b981' : '#ef4444'}; font-weight: 600;">${change >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(change)}%</span>`;
                  } else {
                    result += `${p.marker}${p.seriesName}: ${p.value} t·ª∑<br/>`;
                  }
                });
                return result;
              }
            },
            legend: { data: ['L·ª£i nhu·∫≠n', 'KPI'], bottom: 0 },
            grid: { left: '10%', right: '4%', bottom: '15%', top: '10%' },
            xAxis: { type: 'category', data: segments },
            yAxis: { type: 'value', name: 'T·ª∑ VND' },
            series: [
              { 
                name: 'L·ª£i nhu·∫≠n', 
                type: 'bar', 
                data: current.map((v, i) => ({
                  value: v,
                  itemStyle: { 
                    color: v >= kpi[i] ? '#10b981' : '#f59e0b',
                    borderRadius: [4, 4, 0, 0] 
                  }
                })),
                barWidth: 24,
                label: { 
                  show: true, 
                  position: 'top', 
                  fontSize: 10, 
                  fontWeight: 600,
                  formatter: (params) => {
                    const idx = params.dataIndex;
                    const change = changes[idx];
                    const arrow = change >= 0 ? '‚Üë' : '‚Üì';
                    return `${params.value}\n${arrow}${Math.abs(change)}%`;
                  },
                  color: '#1e293b'
                }
              },
              { 
                name: 'KPI', 
                type: 'line', 
                data: kpi, 
                lineStyle: { color: '#64748b', width: 2, type: 'dashed' },
                itemStyle: { color: '#64748b' },
                symbol: 'circle',
                symbolSize: 6
              }
            ]
          });
        }

        // Revenue pie
        const rpEl = document.getElementById('ov-chart-revenue-pie');
        if (rpEl) {
          let chart = chartsById['ov-chart-revenue-pie'];
          if (!chart) { chart = echarts.init(rpEl); chartsById['ov-chart-revenue-pie'] = chart; }
          chart.setOption({
            tooltip: { trigger: 'item', formatter: '{b}: {c} t·ª∑ ({d}%)' },
            legend: { bottom: 0 },
            series: [{
              type: 'pie',
              radius: ['40%', '70%'],
              data: [
                { value: 156.8, name: 'Khai th√°c', itemStyle: { color: '#3b82f6' } },
                { value: 68.9, name: 'Th∆∞∆°ng v·ª•', itemStyle: { color: '#10b981' } },
                { value: 35.6, name: 'MnR', itemStyle: { color: '#f59e0b' } },
                { value: 22.5, name: 'Kho b√£i', itemStyle: { color: '#8b5cf6' } },
                { value: 5.2, name: 'Kh√°c', itemStyle: { color: '#64748b' } }
              ],
              label: { formatter: '{b}\n{d}%', fontSize: 11, fontWeight: 600 }
            }]
          });
        }

        // Cost structure - Bar chart ngang
        const csEl = document.getElementById('ov-chart-cost-structure');
        if (csEl) {
          let chart = chartsById['ov-chart-cost-structure'];
          if (!chart) { chart = echarts.init(csEl); chartsById['ov-chart-cost-structure'] = chart; }
          chart.setOption({
            tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' }, formatter: '{b}: {c} t·ª∑ ({d}%)' },
            grid: { left: '22%', right: '15%', bottom: '8%', top: '5%' },
            xAxis: { type: 'value', name: 'T·ª∑ VND' },
            yAxis: { type: 'category', data: ['Kh√°c', 'Marketing', 'B·∫£o tr√¨', 'V·∫≠n h√†nh', 'Nh√¢n c√¥ng'] },
            series: [{
              type: 'bar',
              data: [
                { value: 10, name: 'Kh√°c', itemStyle: { color: '#64748b', borderRadius: [0, 4, 4, 0] } },
                { value: 15, name: 'Marketing', itemStyle: { color: '#10b981', borderRadius: [0, 4, 4, 0] } },
                { value: 35, name: 'B·∫£o tr√¨', itemStyle: { color: '#f59e0b', borderRadius: [0, 4, 4, 0] } },
                { value: 55, name: 'V·∫≠n h√†nh', itemStyle: { color: '#f97316', borderRadius: [0, 4, 4, 0] } },
                { value: 85, name: 'Nh√¢n c√¥ng', itemStyle: { color: '#ef4444', borderRadius: [0, 4, 4, 0] } }
              ],
              label: { show: true, position: 'right', fontSize: 10, fontWeight: 600, formatter: '{c} t·ª∑' }
            }]
          });
        }

        // Top customers - Ph√¢n m√†u theo KPI
        const tcEl = document.getElementById('ov-chart-top-customers');
        if (tcEl) {
          let chart = chartsById['ov-chart-top-customers'];
          if (!chart) { chart = echarts.init(tcEl); chartsById['ov-chart-top-customers'] = chart; }
          const customerData = [12.5, 14.2, 15.8, 17.3, 18.9, 21.4, 23.7, 26.5, 29.8, 34.2];
          const customerKPI = 20; // KPI cho m·ªói kh√°ch h√†ng
          chart.setOption({
            tooltip: { 
              trigger: 'axis', 
              axisPointer: { type: 'shadow' },
              formatter: (params) => {
                const value = params[0].value;
                const status = value >= customerKPI ? 'ƒê·∫°t KPI' : 'Ch∆∞a ƒë·∫°t KPI';
                const color = value >= customerKPI ? '#10b981' : '#ef4444';
                return `${params[0].name}<br/>${params[0].marker}Doanh thu: ${value} t·ª∑<br/><span style="color: ${color}; font-weight: 600;">${status} (KPI: ${customerKPI} t·ª∑)</span>`;
              }
            },
            grid: { left: '15%', right: '12%', bottom: '8%', top: '5%' },
            xAxis: { type: 'value', name: 'T·ª∑ VND' },
            yAxis: { type: 'category', data: ['KH 10', 'KH 9', 'KH 8', 'KH 7', 'KH 6', 'KH 5', 'KH 4', 'KH 3', 'KH 2', 'KH 1'] },
            series: [{
              type: 'bar',
              data: customerData.map(v => ({
                value: v,
                itemStyle: { 
                  color: v >= customerKPI ? '#10b981' : '#f59e0b',
                  borderRadius: [0, 4, 4, 0] 
                }
              })),
              label: { show: true, position: 'right', fontSize: 9, fontWeight: 600, formatter: '{c} t·ª∑' },
              markLine: {
                data: [{ xAxis: customerKPI }],
                symbol: 'none',
                label: { 
                  show: true, 
                  position: 'end', 
                  formatter: 'KPI: {c} t·ª∑',
                  fontSize: 9,
                  color: '#64748b'
                },
                lineStyle: { color: '#64748b', type: 'dashed', width: 2 }
              }
            }]
          });
        }

        // Table with expandable rows
        const tbody = document.querySelector('#ovTableDetail tbody');
        if (tbody) {
          const serviceData = [
            { 
              id: 'kt',
              name: 'Khai th√°c', 
              revenue: 156.8, 
              cost: 115.2, 
              profit: 41.6, 
              cog: 73.5, 
              change: 14.8,
              color: '#3b82f6',
              children: [
                { name: 'H√†ng r·ªùi', revenue: 89.2, cost: 65.8, profit: 23.4, cog: 73.8, change: 16.2 },
                { name: 'S√† lan', revenue: 67.6, cost: 49.4, profit: 18.2, cog: 73.1, change: 12.8 }
              ]
            },
            { 
              id: 'tv',
              name: 'Th∆∞∆°ng v·ª•', 
              revenue: 68.9, 
              cost: 43.7, 
              profit: 25.2, 
              cog: 63.4, 
              change: 9.1,
              color: '#10b981',
              children: [
                { name: 'C·∫•p r·ªóng', revenue: 28.5, cost: 18.2, profit: 10.3, cog: 63.9, change: 11.5 },
                { name: 'Tr·∫£ r·ªóng', revenue: 22.3, cost: 14.1, profit: 8.2, cog: 63.2, change: 8.7 },
                { name: 'Trucking', revenue: 12.8, cost: 8.0, profit: 4.8, cog: 62.5, change: 7.2 },
                { name: 'H·∫° h√†ng', revenue: 5.3, cost: 3.4, profit: 1.9, cog: 64.2, change: 8.9 }
              ]
            },
            { 
              id: 'mnr',
              name: 'MnR', 
              revenue: 35.6, 
              cost: 22.8, 
              profit: 12.8, 
              cog: 64.0, 
              change: 11.3,
              color: '#f59e0b',
              children: [
                { name: 'S·ª≠a ch·ªØa', revenue: 21.4, cost: 13.7, profit: 7.7, cog: 64.0, change: 12.1 },
                { name: 'B·∫£o d∆∞·ª°ng', revenue: 14.2, cost: 9.1, profit: 5.1, cog: 64.1, change: 10.2 }
              ]
            },
            { 
              id: 'kb',
              name: 'Kho b√£i', 
              revenue: 22.5, 
              cost: 14.7, 
              profit: 7.8, 
              cog: 65.3, 
              change: 13.0,
              color: '#8b5cf6',
              children: [
                { name: 'L∆∞u b√£i', revenue: 15.8, cost: 10.3, profit: 5.5, cog: 65.2, change: 14.2 },
                { name: 'B·ªëc x·∫øp', revenue: 6.7, cost: 4.4, profit: 2.3, cog: 65.7, change: 10.4 }
              ]
            },
            { 
              id: 'other',
              name: 'Kh√°c', 
              revenue: 5.2, 
              cost: 3.6, 
              profit: 1.6, 
              cog: 69.2, 
              change: 6.7,
              color: '#64748b',
              children: []
            }
          ];

          // Calculate total revenue for percentage
          const totalRevenue = serviceData.reduce((sum, s) => sum + s.revenue, 0);

          tbody.innerHTML = serviceData.map(service => {
            const hasChildren = service.children && service.children.length > 0;
            const profitMargin = ((service.profit / service.revenue) * 100).toFixed(1);
            const revenueShare = ((service.revenue / totalRevenue) * 100).toFixed(1);
            
            const parentRow = `
              <tr style="background: linear-gradient(90deg, ${service.color}15 0%, #ffffff 100%); border-left: 4px solid ${service.color}; cursor: ${hasChildren ? 'pointer' : 'default'};" ${hasChildren ? `onclick="toggleOvServiceRow('${service.id}')"` : ''}>
                <td style="font-weight: 700; color: #1e293b; padding-left: 16px;">
                  ${hasChildren ? '<span id="ovToggle-' + service.id + '" style="display: inline-block; width: 16px; margin-right: 8px; font-size: 12px; color: ' + service.color + ';">‚ñ∂</span>' : '<span style="display: inline-block; width: 16px; margin-right: 8px;"></span>'}
                  <span style="display: inline-block; width: 20px; height: 20px; background: ${service.color}; border-radius: 4px; margin-right: 8px; vertical-align: middle;"></span>
                  ${service.name}
                </td>
                <td style="text-align: right; font-weight: 600;">${service.revenue.toFixed(1)}</td>
                <td style="text-align: right; font-weight: 600;">${service.cost.toFixed(1)}</td>
                <td style="text-align: right; color: #10b981; font-weight: 700;">${service.profit.toFixed(1)}</td>
                <td style="text-align: right; font-weight: 700; color: ${profitMargin >= 30 ? '#10b981' : profitMargin >= 20 ? '#f59e0b' : '#ef4444'};">${profitMargin}%</td>
                <td style="text-align: right; font-weight: 600; color: ${service.color};">${revenueShare}%</td>
                <td style="text-align: right; font-weight: 600;">${service.cog.toFixed(1)}%</td>
                <td style="text-align: right; color: ${service.change >= 0 ? '#10b981' : '#ef4444'}; font-weight: 700;">${service.change >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(service.change).toFixed(1)}%</td>
              </tr>
            `;

            const childRows = hasChildren ? service.children.map(child => {
              const childProfitMargin = ((child.profit / child.revenue) * 100).toFixed(1);
              const childRevenueShare = ((child.revenue / totalRevenue) * 100).toFixed(1);
              
              return `
              <tr id="ovChild-${service.id}" style="display: none; background: #f8fafc;">
                <td style="padding-left: 48px; color: #64748b; font-size: 0.9rem;">‚îî‚îÄ ${child.name}</td>
                <td style="text-align: right; color: #64748b;">${child.revenue.toFixed(1)}</td>
                <td style="text-align: right; color: #64748b;">${child.cost.toFixed(1)}</td>
                <td style="text-align: right; color: #059669;">${child.profit.toFixed(1)}</td>
                <td style="text-align: right; color: ${childProfitMargin >= 30 ? '#059669' : childProfitMargin >= 20 ? '#d97706' : '#dc2626'};">${childProfitMargin}%</td>
                <td style="text-align: right; color: #64748b;">${childRevenueShare}%</td>
                <td style="text-align: right; color: #64748b;">${child.cog.toFixed(1)}%</td>
                <td style="text-align: right; color: ${child.change >= 0 ? '#059669' : '#dc2626'};">${child.change >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(child.change).toFixed(1)}%</td>
              </tr>
            `}).join('') : '';

            return parentRow + childRows;
          }).join('');
        }
      }

      // Toggle function for expandable rows
      window.toggleOvServiceRow = function(id) {
        const toggle = document.getElementById('ovToggle-' + id);
        const childRows = document.querySelectorAll('#ovChild-' + id);
        
        if (childRows.length > 0) {
          const isExpanded = childRows[0].style.display !== 'none';
          childRows.forEach(row => {
            row.style.display = isExpanded ? 'none' : 'table-row';
          });
          if (toggle) {
            toggle.textContent = isExpanded ? '‚ñ∂' : '‚ñº';
          }
        }
      };

      const render = () => {
        updateKPIs();
        setTimeout(renderCharts, 100);
      };

      ovFilterMonth.addEventListener('change', render);
      render();
    };

    const initCustomerManagement = () => {
      const khFilterMonth = byId('khFilterMonth');
      const khFilterType = byId('khFilterType');
      
      if (!khFilterMonth || !khFilterType) return;

      const monthlyData = {
        '2026-01': { revenue: 289, target: 280, customers: 1245, newCustomers: 32, loyalCustomers: 892, kpiPercent: 68.5, kpiCount: 853 },
        '2025-12': { revenue: 278, target: 270, customers: 1213, newCustomers: 28, loyalCustomers: 865, kpiPercent: 65.8, kpiCount: 798 },
        '2025-11': { revenue: 265, target: 260, customers: 1185, newCustomers: 25, loyalCustomers: 842, kpiPercent: 63.2, kpiCount: 749 }
      };

      const updateKPIs = () => {
        const selected = khFilterMonth.value;
        const data = monthlyData[selected];
        
        // Gauge chart
        const gaugeChart = echarts.init(byId('kh-chart-gauge'));
        const percentage = ((data.revenue / data.target) * 100).toFixed(1);
        gaugeChart.setOption({
          series: [{
            type: 'gauge',
            startAngle: 180,
            endAngle: 0,
            min: 0,
            max: 120,
            radius: '90%',
            center: ['50%', '70%'],
            splitNumber: 6,
            axisLine: {
              lineStyle: {
                width: 20,
                color: [[0.5, '#ef4444'], [0.8, '#f59e0b'], [1, '#10b981']]
              }
            },
            pointer: { itemStyle: { color: '#1e293b' }, width: 4 },
            axisTick: { show: false },
            splitLine: { length: 20, lineStyle: { color: '#e2e8f0', width: 2 } },
            axisLabel: { show: false },
            detail: {
              valueAnimation: true,
              formatter: percentage + '%',
              color: '#1e293b',
              fontSize: 24,
              fontWeight: 700,
              offsetCenter: [0, '-10%']
            },
            data: [{ value: percentage }]
          }]
        });
        
        chartsById['kh-chart-gauge'] = gaugeChart;

        // Update KPI values
        byId('khKpiRevenueValue').textContent = data.revenue + ' t·ª∑';
        byId('khKpiRevenueTarget').textContent = 'M·ª•c ti√™u: ' + data.target + ' t·ª∑';
        byId('khKpiCustomers').textContent = data.customers.toLocaleString();
        byId('khKpiNewCustomers').textContent = '+' + data.newCustomers + ' KH m·ªõi';
        byId('khKpiLoyalCustomers').textContent = data.loyalCustomers;
        byId('khKpiPercent').textContent = data.kpiPercent + '%';
        byId('khKpiCount').textContent = '(' + data.kpiCount + '/' + data.customers + ')';
      };

      const renderCharts = () => {
        // 1. Revenue & Customer over time
        const chart1 = echarts.init(byId('kh-chart-revenue-customer-time'));
        chart1.setOption({
          tooltip: { trigger: 'axis', axisPointer: { type: 'cross' } },
          legend: { data: ['Doanh thu', 'S·ªë kh√°ch h√†ng'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '8%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'], axisLabel: { color: '#64748b' } },
          yAxis: [
            { type: 'value', name: 'Doanh thu (t·ª∑)', axisLabel: { color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
            { type: 'value', name: 'S·ªë KH', axisLabel: { color: '#64748b' }, splitLine: { show: false } }
          ],
          series: [
            { name: 'Doanh thu', type: 'bar', data: [245, 251, 258, 265, 272, 278, 289], yAxisIndex: 0, itemStyle: { color: '#3b82f6', borderRadius: [4, 4, 0, 0] }, barWidth: 25 },
            { name: 'S·ªë kh√°ch h√†ng', type: 'line', data: [1125, 1142, 1158, 1170, 1185, 1213, 1245], yAxisIndex: 1, lineStyle: { color: '#10b981', width: 3 }, itemStyle: { color: '#10b981' }, symbol: 'circle', symbolSize: 8, smooth: true }
          ]
        });
        chartsById['kh-chart-revenue-customer-time'] = chart1;

        // 2. Value segment (Bar + Cumulative Line)
        const chart2 = echarts.init(byId('kh-chart-value-segment'));
        const segmentData = [
          { name: 'VIP (>50 t·ª∑)', value: 145, color: '#8b5cf6' },
          { name: 'Cao (20-50 t·ª∑)', value: 89, color: '#3b82f6' },
          { name: 'Trung b√¨nh (10-20 t·ª∑)', value: 38, color: '#10b981' },
          { name: 'Th·∫•p (<10 t·ª∑)', value: 17, color: '#f59e0b' }
        ];
        const totalRevenue = segmentData.reduce((sum, item) => sum + item.value, 0);
        let cumulative = 0;
        const cumulativeData = segmentData.map(item => {
          cumulative += item.value;
          return ((cumulative / totalRevenue) * 100).toFixed(1);
        });
        
        chart2.setOption({
          tooltip: { trigger: 'axis', axisPointer: { type: 'cross' } },
          legend: { data: ['Doanh thu', 'T·ª∑ l·ªá l≈©y k·∫ø'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '8%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: segmentData.map(d => d.name), axisLabel: { color: '#64748b', rotate: 15 } },
          yAxis: [
            { type: 'value', name: 'Doanh thu (t·ª∑)', axisLabel: { color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
            { type: 'value', name: 'L≈©y k·∫ø (%)', min: 0, max: 100, axisLabel: { formatter: '{value}%', color: '#64748b' }, splitLine: { show: false } }
          ],
          series: [
            { 
              name: 'Doanh thu', 
              type: 'bar', 
              data: segmentData.map(d => ({ value: d.value, itemStyle: { color: d.color, borderRadius: [4, 4, 0, 0] } })), 
              yAxisIndex: 0, 
              barWidth: 30,
              label: { show: true, position: 'top', formatter: '{c} t·ª∑', color: '#1e293b', fontWeight: 600 }
            },
            { 
              name: 'T·ª∑ l·ªá l≈©y k·∫ø', 
              type: 'line', 
              data: cumulativeData, 
              yAxisIndex: 1, 
              lineStyle: { color: '#ef4444', width: 3 }, 
              itemStyle: { color: '#ef4444' }, 
              symbol: 'circle', 
              symbolSize: 8,
              label: { show: true, formatter: '{c}%', color: '#ef4444', fontWeight: 600, position: 'top' }
            }
          ]
        });
        chartsById['kh-chart-value-segment'] = chart2;

        // 3. Top 10 customers
        const chart3 = echarts.init(byId('kh-chart-top-customers'));
        const customerData = [34.2, 29.8, 26.5, 23.7, 21.4, 18.9, 17.3, 15.8, 14.2, 12.5];
        const kpiThreshold = 20;
        chart3.setOption({
          tooltip: { 
            trigger: 'axis',
            axisPointer: { type: 'shadow' },
            formatter: (params) => {
              const value = params[0].value;
              const status = value >= kpiThreshold ? '<span style="color: #10b981;">‚úì ƒê·∫°t KPI</span>' : '<span style="color: #ef4444;">‚úó Ch∆∞a ƒë·∫°t KPI</span>';
              return params[0].name + '<br/>Doanh thu: ' + value + ' t·ª∑<br/>' + status;
            }
          },
          grid: { left: '15%', right: '8%', bottom: '8%', top: '5%' },
          xAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
          yAxis: { type: 'category', data: ['KH 10', 'KH 9', 'KH 8', 'KH 7', 'KH 6', 'KH 5', 'KH 4', 'KH 3', 'KH 2', 'KH 1'], axisLabel: { color: '#64748b' } },
          series: [{
            type: 'bar',
            data: customerData.map(v => ({
              value: v,
              itemStyle: { color: v >= kpiThreshold ? '#10b981' : '#f59e0b', borderRadius: [0, 4, 4, 0] }
            })),
            barWidth: 20,
            label: { show: true, position: 'right', formatter: '{c} t·ª∑', color: '#1e293b', fontWeight: 600 },
            markLine: {
              silent: true,
              symbol: 'none',
              data: [{ xAxis: kpiThreshold }],
              label: { formatter: 'KPI: {c} t·ª∑', position: 'end', fontSize: 10, color: '#64748b' },
              lineStyle: { color: '#64748b', type: 'dashed', width: 2 }
            }
          }]
        });
        chartsById['kh-chart-top-customers'] = chart3;

        // 4. Heatmap (KH A at top)
        const chart4 = echarts.init(byId('kh-chart-heatmap'));
        const customers = ['KH J', 'KH I', 'KH H', 'KH G', 'KH F', 'KH E', 'KH D', 'KH C', 'KH B', 'KH A'];
        const segments = ['Khai th√°c', 'Th∆∞∆°ng v·ª•', 'MnR', 'Kho b√£i', 'Kh√°c'];
        const heatmapData = [
          [0, 9, 45], [1, 9, 23], [2, 9, 12], [3, 9, 8], [4, 9, 2],
          [0, 8, 38], [1, 8, 28], [2, 8, 15], [3, 8, 10], [4, 8, 3],
          [0, 7, 52], [1, 7, 18], [2, 7, 8], [3, 7, 6], [4, 7, 1],
          [0, 6, 28], [1, 6, 35], [2, 6, 20], [3, 6, 12], [4, 6, 5],
          [0, 5, 15], [1, 5, 42], [2, 5, 18], [3, 5, 8], [4, 5, 2],
          [0, 4, 8], [1, 4, 12], [2, 4, 45], [3, 4, 15], [4, 4, 5],
          [0, 3, 22], [1, 3, 25], [2, 3, 28], [3, 3, 18], [4, 3, 7],
          [0, 2, 18], [1, 2, 15], [2, 2, 22], [3, 2, 35], [4, 2, 10],
          [0, 1, 12], [1, 1, 18], [2, 1, 15], [3, 1, 38], [4, 1, 12],
          [0, 0, 25], [1, 0, 20], [2, 0, 18], [3, 0, 22], [4, 0, 15]
        ];
        
        chart4.setOption({
          tooltip: { position: 'top', formatter: (params) => customers[params.value[1]] + '<br/>' + segments[params.value[0]] + '<br/>Doanh thu: ' + params.value[2] + ' t·ª∑' },
          grid: { left: '12%', right: '5%', bottom: '8%', top: '15%' },
          xAxis: { type: 'category', data: segments, splitArea: { show: true }, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'category', data: customers, splitArea: { show: true }, axisLabel: { color: '#64748b' } },
          visualMap: {
            min: 0,
            max: 55,
            calculable: true,
            orient: 'horizontal',
            left: 'center',
            top: '0%',
            inRange: { color: ['#f0f9ff', '#7dd3fc', '#0284c7', '#0c4a6e'] },
            textStyle: { color: '#64748b' }
          },
          series: [{
            type: 'heatmap',
            data: heatmapData,
            label: { show: true, color: '#1e293b', fontWeight: 600 },
            emphasis: { itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.3)' } }
          }]
        });
        chartsById['kh-chart-heatmap'] = chart4;

        // 5. Cohort Analysis - with toggle between revenue and retention
        const cohortMonths = ['T1', 'T2', 'T3', 'T4', 'T5', 'T6'];
        
        // Data for retention rate (%)
        const cohortRetentionData = [
          ['T1/2025', 0, 100], ['T1/2025', 1, 88], ['T1/2025', 2, 78], ['T1/2025', 3, 72], ['T1/2025', 4, 68], ['T1/2025', 5, 65],
          ['T2/2025', 0, 100], ['T2/2025', 1, 92], ['T2/2025', 2, 82], ['T2/2025', 3, 76], ['T2/2025', 4, 71], ['T2/2025', 5, null],
          ['T3/2025', 0, 100], ['T3/2025', 1, 90], ['T3/2025', 2, 84], ['T3/2025', 3, 79], ['T3/2025', 4, null], ['T3/2025', 5, null],
          ['T4/2025', 0, 100], ['T4/2025', 1, 94], ['T4/2025', 2, 86], ['T4/2025', 3, null], ['T4/2025', 4, null], ['T4/2025', 5, null],
          ['T5/2025', 0, 100], ['T5/2025', 1, 91], ['T5/2025', 2, null], ['T5/2025', 3, null], ['T5/2025', 4, null], ['T5/2025', 5, null],
          ['T6/2025', 0, 100], ['T6/2025', 1, null], ['T6/2025', 2, null], ['T6/2025', 3, null], ['T6/2025', 4, null], ['T6/2025', 5, null]
        ].map(item => [item[1], cohortMonths.indexOf(item[0].split('/')[0]), item[2]]);
        
        // Data for revenue (t·ª∑)
        const cohortRevenueData = [
          ['T1/2025', 0, 45.2], ['T1/2025', 1, 39.8], ['T1/2025', 2, 35.3], ['T1/2025', 3, 32.5], ['T1/2025', 4, 30.7], ['T1/2025', 5, 29.4],
          ['T2/2025', 0, 48.5], ['T2/2025', 1, 44.6], ['T2/2025', 2, 39.8], ['T2/2025', 3, 36.9], ['T2/2025', 4, 34.4], ['T2/2025', 5, null],
          ['T3/2025', 0, 52.3], ['T3/2025', 1, 47.1], ['T3/2025', 2, 43.9], ['T3/2025', 3, 41.3], ['T3/2025', 4, null], ['T3/2025', 5, null],
          ['T4/2025', 0, 55.8], ['T4/2025', 1, 52.4], ['T4/2025', 2, 48.0], ['T4/2025', 3, null], ['T4/2025', 4, null], ['T4/2025', 5, null],
          ['T5/2025', 0, 58.2], ['T5/2025', 1, 53.0], ['T5/2025', 2, null], ['T5/2025', 3, null], ['T5/2025', 4, null], ['T5/2025', 5, null],
          ['T6/2025', 0, 61.5], ['T6/2025', 1, null], ['T6/2025', 2, null], ['T6/2025', 3, null], ['T6/2025', 4, null], ['T6/2025', 5, null]
        ].map(item => [item[1], cohortMonths.indexOf(item[0].split('/')[0]), item[2]]);

        let currentCohortMode = 'revenue'; // 'revenue' or 'retention'

        const renderCohortChart = (mode) => {
          const chart5 = echarts.init(byId('kh-chart-cohort'));
          const data = mode === 'revenue' ? cohortRevenueData : cohortRetentionData;
          const isRevenue = mode === 'revenue';
          
          chart5.setOption({
            tooltip: { 
              position: 'top', 
              formatter: (params) => {
                if (params.value[2] === null) return '';
                const label = isRevenue ? 'Doanh thu: ' + params.value[2] + ' t·ª∑' : 'Gi·ªØ ch√¢n: ' + params.value[2] + '%';
                return 'Cohort: ' + cohortMonths[params.value[1]] + '<br/>Th√°ng ' + params.value[0] + '<br/>' + label;
              }
            },
            grid: { left: '12%', right: '8%', bottom: '5%', top: '5%' },
            xAxis: { type: 'category', data: ['M0', 'M1', 'M2', 'M3', 'M4', 'M5'], splitArea: { show: true }, axisLabel: { color: '#64748b' } },
            yAxis: { type: 'category', data: cohortMonths, splitArea: { show: true }, axisLabel: { color: '#64748b' } },
            series: [{
              min: isRevenue ? 25 : 60,
              max: isRevenue ? 65 : 100,
              type: 'heatmap',
              data: data.map(item => {
                if (item[2] === null) return item;
                const val = item[2];
                let color;
                if (isRevenue) {
                  if (val >= 55) color = '#0c4a6e';
                  else if (val >= 45) color = '#0284c7';
                  else if (val >= 35) color = '#7dd3fc';
                  else color = '#f0f9ff';
                } else {
                  if (val >= 90) color = '#059669';
                  else if (val >= 80) color = '#10b981';
                  else if (val >= 70) color = '#fca5a5';
                  else color = '#fef2f2';
                }
                return [...item, color];
              }),
              label: { 
                show: true, 
                formatter: (params) => params.value[2] ? params.value[2] + (isRevenue ? '' : '%') : '-', 
                color: '#1e293b', 
                fontWeight: 600 
              },
              itemStyle: {
                color: (params) => params.value[3] || '#f1f5f9'
              },
              emphasis: { itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.3)' } }
            }]
          });
          chartsById['kh-chart-cohort'] = chart5;
        };

        // Initial render with revenue mode
        renderCohortChart('revenue');

        // Button event listeners
        const btnRevenue = byId('khCohortRevenue');
        const btnRetention = byId('khCohortRetention');
        
        if (btnRevenue && btnRetention) {
          btnRevenue.addEventListener('click', () => {
            currentCohortMode = 'revenue';
            renderCohortChart('revenue');
            
            // Update button styles
            btnRevenue.style.background = '#3b82f6';
            btnRevenue.style.color = 'white';
            btnRevenue.style.borderColor = '#3b82f6';
            
            btnRetention.style.background = 'white';
            btnRetention.style.color = '#64748b';
            btnRetention.style.borderColor = '#cbd5e1';
          });
          
          btnRetention.addEventListener('click', () => {
            currentCohortMode = 'retention';
            renderCohortChart('retention');
            
            // Update button styles
            btnRetention.style.background = '#3b82f6';
            btnRetention.style.color = 'white';
            btnRetention.style.borderColor = '#3b82f6';
            
            btnRevenue.style.background = 'white';
            btnRevenue.style.color = '#64748b';
            btnRevenue.style.borderColor = '#cbd5e1';
          });
        }

        // 6. Customer Detail Table
        const tbody = document.querySelector('#khTableDetail tbody');
        if (tbody) {
          const customers = [
            { name: 'C√¥ng ty TNHH ABC', revenue: 34.2, profit: 12.5, debt: 2.3, kpi: 128, contract: '15/12/2025', segment: 'Khai th√°c' },
            { name: 'T·∫≠p ƒëo√†n XYZ', revenue: 29.8, profit: 10.8, debt: 1.8, kpi: 115, contract: '22/12/2025', segment: 'Th∆∞∆°ng v·ª•' },
            { name: 'C√¥ng ty CP DEF', revenue: 26.5, profit: 9.2, debt: 3.1, kpi: 108, contract: '10/01/2026', segment: 'Khai th√°c' },
            { name: 'DNTN GHI', revenue: 23.7, profit: 8.5, debt: 1.5, kpi: 102, contract: '05/01/2026', segment: 'Th∆∞∆°ng v·ª•' },
            { name: 'C√¥ng ty TNHH JKL', revenue: 21.4, profit: 7.8, debt: 2.8, kpi: 98, contract: '28/12/2025', segment: 'Khai th√°c' },
            { name: 'T·∫≠p ƒëo√†n MNO', revenue: 18.9, profit: 6.5, debt: 1.2, kpi: 88, contract: '18/12/2025', segment: 'MnR' },
            { name: 'C√¥ng ty CP PQR', revenue: 17.3, profit: 5.9, debt: 2.2, kpi: 82, contract: '12/12/2025', segment: 'Kho b√£i' },
            { name: 'DNTN STU', revenue: 15.8, profit: 5.2, debt: 1.9, kpi: 76, contract: '20/11/2025', segment: 'Th∆∞∆°ng v·ª•' },
            { name: 'C√¥ng ty TNHH VWX', revenue: 14.2, profit: 4.8, debt: 3.5, kpi: 68, contract: '15/11/2025', segment: 'Khai th√°c' },
            { name: 'T·∫≠p ƒëo√†n YZ', revenue: 12.5, profit: 4.2, debt: 1.6, kpi: 62, contract: '08/11/2025', segment: 'MnR' }
          ];

          tbody.innerHTML = customers.map(c => {
            const kpiStatus = c.kpi >= 100 ? 'ƒê·∫°t' : 'Ch∆∞a ƒë·∫°t';
            const kpiColor = c.kpi >= 100 ? '#10b981' : '#ef4444';
            const segmentColors = {
              'Khai th√°c': '#3b82f6',
              'Th∆∞∆°ng v·ª•': '#10b981',
              'MnR': '#f59e0b',
              'Kho b√£i': '#8b5cf6',
              'Kh√°c': '#64748b'
            };
            
            return `
              <tr style="border-left: 3px solid ${segmentColors[c.segment] || '#64748b'};">
                <td style="font-weight: 600; color: #1e293b;">${c.name}</td>
                <td style="text-align: right; font-weight: 600;">${c.revenue.toFixed(1)}</td>
                <td style="text-align: right; color: #10b981; font-weight: 600;">${c.profit.toFixed(1)}</td>
                <td style="text-align: right; color: ${c.debt > 2.5 ? '#ef4444' : '#64748b'}; font-weight: 600;">${c.debt.toFixed(1)}</td>
                <td style="text-align: center;">
                  <span style="display: inline-block; padding: 4px 12px; border-radius: 12px; background: ${kpiColor}15; color: ${kpiColor}; font-weight: 700; font-size: 0.85rem;">
                    ${kpiStatus} (${c.kpi}%)
                  </span>
                </td>
                <td style="text-align: center; color: #64748b;">${c.contract}</td>
                <td style="text-align: center;">
                  <span style="display: inline-block; padding: 4px 12px; border-radius: 12px; background: ${segmentColors[c.segment]}15; color: ${segmentColors[c.segment]}; font-weight: 600; font-size: 0.85rem;">
                    ${c.segment}
                  </span>
                </td>
              </tr>
            `;
          }).join('');
        }
      };

      const render = () => {
        updateKPIs();
        setTimeout(renderCharts, 100);
      };

      khFilterMonth.addEventListener('change', render);
      khFilterType.addEventListener('change', render);
      render();
    };

    const initKhaiThacReport = () => {
      const ktFilterMonth = byId('ktFilterMonth');
      
      if (!ktFilterMonth) return;

      // D·ªØ li·ªáu fake
      const monthlyData = {
        '2026-01': { revenue: 156.8, revenuePrev: 144.9, kpi: 153, cost: 115.2, costPrev: 109.4, profit: 41.6, profitPrev: 36.2, bulk: 428500, bulkPrev: 395200, barge: 12340, bargePrev: 11580 },
        '2025-12': { revenue: 144.9, revenuePrev: 138.2, kpi: 145, cost: 109.4, costPrev: 104.8, profit: 36.2, profitPrev: 33.4, bulk: 395200, bulkPrev: 382400, barge: 11580, bargePrev: 10920 },
        '2025-11': { revenue: 138.2, revenuePrev: 142.1, kpi: 140, cost: 104.8, costPrev: 106.2, profit: 33.4, profitPrev: 35.9, bulk: 382400, bulkPrev: 398600, barge: 10920, bargePrev: 11240 },
        '2025-10': { revenue: 142.1, revenuePrev: 135.8, kpi: 138, cost: 106.2, costPrev: 102.5, profit: 35.9, profitPrev: 33.3, bulk: 398600, bulkPrev: 385000, barge: 11240, bargePrev: 10850 }
      };

      const bulkCargoData = [
        { name: 'Than', revenue: 45200, volume: 185000, revenuePct: 35.2, volumePct: 43.2 },
        { name: 'Clinker', revenue: 32800, volume: 128000, revenuePct: 25.5, volumePct: 29.9 },
        { name: 'Ph√¢n b√≥n', revenue: 21500, volume: 62500, revenuePct: 16.7, volumePct: 14.6 },
        { name: 'Th√≥c g·∫°o', revenue: 15600, volume: 32000, revenuePct: 12.1, volumePct: 7.5 },
        { name: 'Xi mƒÉng', revenue: 8900, volume: 15000, revenuePct: 6.9, volumePct: 3.5 },
        { name: 'Kh√°c', revenue: 4500, volume: 6000, revenuePct: 3.5, volumePct: 1.4 }
      ];

      const containerData = [
        { type: 'Cont xu·∫•t', size20: 3200, size40: 2850 },
        { type: 'Cont r·ªóng', size20: 1850, size40: 1640 }
      ];

      const topCustomers = [
        { name: 'Vinacomin', teu: 2840 },
        { name: 'PetroVietnam', teu: 2350 },
        { name: 'Vinachem', teu: 1920 },
        { name: 'TKV', teu: 1680 },
        { name: 'Ho√†ng Anh Gia Lai', teu: 1450 },
        { name: 'Vinafood', teu: 1280 },
        { name: 'Siam Cement', teu: 1120 },
        { name: 'Holcim VN', teu: 980 },
        { name: 'CFAO Vietnam', teu: 850 },
        { name: 'Maersk Line', teu: 720 }
      ];

      const renderKpis = () => {
        const month = ktFilterMonth.value;
        const data = monthlyData[month];
        
        const revChange = ((data.revenue - data.revenuePrev) / data.revenuePrev) * 100;
        const costChange = ((data.cost - data.costPrev) / data.costPrev) * 100;
        const profitChange = ((data.profit - data.profitPrev) / data.profitPrev) * 100;
        const bulkChange = ((data.bulk - data.bulkPrev) / data.bulkPrev) * 100;
        const bargeChange = ((data.barge - data.bargePrev) / data.bargePrev) * 100;
        const vsKpi = (data.revenue / data.kpi) * 100;
        
        setText('ktKpiRevenue', data.revenue.toFixed(1) + ' t·ª∑');
        setText('ktKpiCost', data.cost.toFixed(1) + ' t·ª∑');
        setText('ktKpiProfit', data.profit.toFixed(1) + ' t·ª∑');
        setText('ktKpiBulk', data.bulk.toLocaleString('vi-VN') + ' t·∫•n');
        setText('ktKpiBarge', data.barge.toLocaleString('vi-VN') + ' TEU');
        
        const trendEl = byId('ktKpiRevenueTrend');
        if (trendEl) {
          const arrow = revChange >= 0 ? '‚Üë' : '‚Üì';
          const color = revChange >= 0 ? '#10b981' : '#ef4444';
          trendEl.textContent = `${arrow} ${revChange >= 0 ? '+' : ''}${revChange.toFixed(1)}%`;
          trendEl.style.color = color;
        }

        const revenueKpiEl = byId('ktKpiRevenueKpi');
        if (revenueKpiEl) {
          const color = vsKpi >= 100 ? '#10b981' : '#ef4444';
          const icon = vsKpi >= 100 ? '‚úì' : '‚úó';
          revenueKpiEl.textContent = `${icon} ${vsKpi.toFixed(1)}%`;
          revenueKpiEl.style.color = color;
        }

        const costTrendEl = byId('ktKpiCostTrend');
        if (costTrendEl) {
          const arrow = costChange >= 0 ? '‚Üë' : '‚Üì';
          const color = costChange >= 0 ? '#ef4444' : '#10b981';
          costTrendEl.textContent = `${arrow} ${costChange >= 0 ? '+' : ''}${costChange.toFixed(1)}%`;
          costTrendEl.style.color = color;
        }

        const profitTrendEl = byId('ktKpiProfitTrend');
        if (profitTrendEl) {
          const arrow = profitChange >= 0 ? '‚Üë' : '‚Üì';
          const color = profitChange >= 0 ? '#10b981' : '#ef4444';
          profitTrendEl.textContent = `${arrow} ${profitChange >= 0 ? '+' : ''}${profitChange.toFixed(1)}%`;
          profitTrendEl.style.color = color;
        }

        const bulkTrendEl = byId('ktKpiBulkTrend');
        if (bulkTrendEl) {
          const arrow = bulkChange >= 0 ? '‚Üë' : '‚Üì';
          const color = bulkChange >= 0 ? '#10b981' : '#ef4444';
          bulkTrendEl.textContent = `${arrow} ${bulkChange >= 0 ? '+' : ''}${bulkChange.toFixed(1)}%`;
          bulkTrendEl.style.color = color;
        }

        const bargeTrendEl = byId('ktKpiBargeTrend');
        if (bargeTrendEl) {
          const arrow = bargeChange >= 0 ? '‚Üë' : '‚Üì';
          const color = bargeChange >= 0 ? '#10b981' : '#ef4444';
          bargeTrendEl.textContent = `${arrow} ${bargeChange >= 0 ? '+' : ''}${bargeChange.toFixed(1)}%`;
          bargeTrendEl.style.color = color;
        }
      };

      const renderFinanceChart = () => {
        const chart = chartsById['chart-kt-finance'];
        if (!chart) return;

        const months = ['T7', 'T8', 'T9', 'T10', 'T11', 'T12', 'T1'];
        const revenue = [132, 138, 142, 135, 138, 145, 157];
        const cost = [98, 102, 105, 101, 103, 107, 115];
        const profit = revenue.map((r, i) => r - cost[i]);

        chart.setOption({
          tooltip: { trigger: 'axis', formatter: (params) => {
            let res = params[0].axisValue + '<br/>';
            params.forEach(p => {
              res += `${p.marker} ${p.seriesName}: ${p.value} t·ª∑<br/>`;
            });
            return res;
          }},
          legend: { data: ['Doanh thu', 'Chi ph√≠', 'L·ª£i nhu·∫≠n'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: months, axisLabel: { color: '#64748b' } },
          yAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
          series: [
            { name: 'Doanh thu', type: 'bar', data: revenue, itemStyle: { color: '#3b82f6', borderRadius: [6, 6, 0, 0] }, barWidth: 16 },
            { name: 'Chi ph√≠', type: 'bar', data: cost, itemStyle: { color: '#ef4444', borderRadius: [6, 6, 0, 0] }, barWidth: 16 },
            { name: 'L·ª£i nhu·∫≠n', type: 'line', data: profit, lineStyle: { color: '#10b981', width: 3 }, itemStyle: { color: '#10b981' }, symbol: 'circle', symbolSize: 8 }
          ]
        });
      };

      const renderRevenueTypeChart = () => {
        const chart = chartsById['chart-kt-revenue-type'];
        if (!chart) return;

        const categories = ['H√†ng r·ªùi', 'S√† lan', 'Kh√°c'];
        const actual = [128.5, 24.8, 3.5];
        const kpi = [120, 28, 5];
        const kpiPercent = actual.map((a, i) => ((a / kpi[i]) * 100).toFixed(1));

        chart.setOption({
          tooltip: { trigger: 'axis', formatter: (params) => {
            const idx = categories.indexOf(params[0].axisValue);
            let res = params[0].axisValue + '<br/>';
            params.forEach(p => {
              res += `${p.marker} ${p.seriesName}: ${p.value}${p.seriesType === 'bar' ? ' t·ª∑' : '%'}<br/>`;
            });
            return res;
          }},
          legend: { data: ['Doanh thu', 'ƒê·∫°t KPI'], bottom: 0, textStyle: { color: '#64748b' } },
          grid: { left: '8%', right: '4%', bottom: '15%', top: '10%' },
          xAxis: { type: 'category', data: categories, axisLabel: { color: '#64748b' } },
          yAxis: [
            { type: 'value', name: 'Doanh thu (t·ª∑)', axisLabel: { formatter: '{value}', color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
            { type: 'value', name: 'KPI (%)', min: 0, max: 150, axisLabel: { formatter: '{value}%', color: '#64748b' }, splitLine: { show: false } }
          ],
          series: [
            { name: 'Doanh thu', type: 'bar', data: actual, yAxisIndex: 0, itemStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{ offset: 0, color: '#3b82f6' }, { offset: 1, color: '#93c5fd' }]), borderRadius: [6, 6, 0, 0] }, barWidth: 35, label: { show: true, position: 'top', formatter: '{c} t·ª∑', color: '#1e293b', fontWeight: 600 } },
            { name: 'ƒê·∫°t KPI', type: 'line', data: kpiPercent.map(p => parseFloat(p)), yAxisIndex: 1, lineStyle: { color: '#10b981', width: 3 }, itemStyle: { color: '#10b981' }, symbol: 'circle', symbolSize: 8, label: { show: true, formatter: '{c}%', color: '#10b981', fontWeight: 600, position: 'top' } }
          ]
        });
      };

      const renderCostStructureChart = () => {
        const chart = chartsById['chart-kt-cost-structure'];
        if (!chart) return;

        const categories = ['Nhi√™n li·ªáu', 'Nh√¢n c√¥ng', 'B·∫£o tr√¨', 'C·∫£ng ph√≠', 'Kh√°c'];
        const current = [42, 28, 15, 18, 12];
        const previous = [45, 26, 14, 17, 11];
        const changes = current.map((c, i) => ((c - previous[i]) / previous[i] * 100).toFixed(1));

        chart.setOption({
          tooltip: { trigger: 'axis', formatter: (params) => {
            const idx = params[0].dataIndex;
            let res = params[0].axisValue + '<br/>';
            res += `${params[0].marker} Chi ph√≠: ${params[0].value} t·ª∑<br/>`;
            const change = parseFloat(changes[idx]);
            const color = change >= 0 ? '#ef4444' : '#10b981';
            const arrow = change >= 0 ? '‚Üë' : '‚Üì';
            res += `<span style="color: ${color};">${arrow} ${Math.abs(change)}% vs k·ª≥ tr∆∞·ªõc</span>`;
            return res;
          }},
          grid: { left: '20%', right: '15%', bottom: '8%', top: '5%' },
          xAxis: { type: 'value', axisLabel: { formatter: '{value} t·ª∑', color: '#64748b', fontSize: 10 }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
          yAxis: { type: 'category', data: categories, axisLabel: { color: '#64748b', fontSize: 11 } },
          series: [
            { 
              name: 'Chi ph√≠', 
              type: 'bar', 
              data: current, 
              itemStyle: { color: '#ef4444', borderRadius: [0, 6, 6, 0] }, 
              barWidth: 24,
              label: { 
                show: true, 
                position: 'right',
                formatter: (params) => {
                  const change = parseFloat(changes[params.dataIndex]);
                  const arrow = change >= 0 ? '‚Üë' : '‚Üì';
                  const color = change >= 0 ? '#ef4444' : '#10b981';
                  return `{value|${params.value} t·ª∑} {change|${arrow} ${Math.abs(change)}%}`;
                },
                rich: {
                  value: { color: '#1e293b', fontWeight: 600, fontSize: 11 },
                  change: { color: '#64748b', fontSize: 10, padding: [0, 0, 0, 6] }
                }
              }
            }
          ]
        });
      };

      const renderDetailTable = () => {
        const tbody = byId('ktTableDetail')?.querySelector('tbody');
        if (!tbody) return;

        const detailData = [
          { code: 'KT-001', cost: 12500, revenue: 18200, profit: 5700, margin: 31.3 },
          { code: 'KT-002', cost: 8900, revenue: 13400, profit: 4500, margin: 33.6 },
          { code: 'KT-003', cost: 15200, revenue: 21800, profit: 6600, margin: 30.3 },
          { code: 'KT-004', cost: 6800, revenue: 9500, profit: 2700, margin: 28.4 },
          { code: 'KT-005', cost: 11200, revenue: 16800, profit: 5600, margin: 33.3 },
          { code: 'KT-006', cost: 9400, revenue: 14200, profit: 4800, margin: 33.8 },
          { code: 'KT-007', cost: 7600, revenue: 11900, profit: 4300, margin: 36.1 },
          { code: 'KT-008', cost: 13800, revenue: 19600, profit: 5800, margin: 29.6 },
          { code: 'KT-009', cost: 8200, revenue: 12100, profit: 3900, margin: 32.2 },
          { code: 'KT-010', cost: 10800, revenue: 15800, profit: 5000, margin: 31.6 }
        ];

        tbody.innerHTML = '';
        detailData.forEach((item, idx) => {
          const tr = document.createElement('tr');
          const bgColor = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
          tr.style.backgroundColor = bgColor;

          let marginColor = '#10b981';
          if (item.margin < 30) marginColor = '#ef4444';
          else if (item.margin < 32) marginColor = '#f59e0b';

          tr.innerHTML = `
            <td><strong style="color: #1e293b;">${item.code}</strong></td>
            <td style="text-align: right; color: #ef4444; font-weight: 600;">${item.cost.toLocaleString('vi-VN')}</td>
            <td style="text-align: right; color: #3b82f6; font-weight: 600;">${item.revenue.toLocaleString('vi-VN')}</td>
            <td style="text-align: right; color: #10b981; font-weight: 700;">${item.profit.toLocaleString('vi-VN')}</td>
            <td style="text-align: right; color: ${marginColor}; font-weight: 700; font-size: 14px;">${item.margin}%</td>
          `;
          tbody.appendChild(tr);
        });
      };

      const renderBulkRevenueChart = () => {
        const chart = chartsById['chart-kt-bulk-revenue'];
        if (!chart) return;

        const data = bulkCargoData.map(item => ({
          name: item.name,
          value: item.revenue
        }));

        chart.setOption({
          tooltip: { trigger: 'item', formatter: '{b}: {c} tri·ªáu ({d}%)' },
          legend: { orient: 'vertical', left: 'left', textStyle: { color: '#64748b' } },
          series: [{
            type: 'pie',
            radius: ['40%', '70%'],
            avoidLabelOverlap: true,
            itemStyle: { borderRadius: 8, borderColor: '#fff', borderWidth: 2 },
            label: { show: true, formatter: '{b}\n{d}%', color: '#1e293b', fontWeight: 600 },
            data: data,
            color: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#64748b']
          }]
        });
      };

      const renderBulkTable = () => {
        const tbody = byId('ktTableBulk')?.querySelector('tbody');
        if (!tbody) return;

        tbody.innerHTML = '';
        bulkCargoData.forEach((item, idx) => {
          const tr = document.createElement('tr');
          const bgColor = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
          tr.style.backgroundColor = bgColor;

          tr.innerHTML = `
            <td><strong style="color: #1e293b;">${item.name}</strong></td>
            <td style="text-align: right; color: #3b82f6; font-weight: 600;">${item.revenue.toLocaleString('vi-VN')}</td>
            <td style="text-align: right; color: #64748b; font-weight: 500;">${item.volume.toLocaleString('vi-VN')}</td>
            <td style="text-align: right; color: #10b981; font-weight: 600;">${item.revenuePct}%</td>
            <td style="text-align: right; color: #a855f7; font-weight: 600;">${item.volumePct}%</td>
          `;
          tbody.appendChild(tr);
        });
      };

      const renderBargeTypeChart = () => {
        const chart = chartsById['chart-kt-barge-type'];
        if (!chart) return;

        chart.setOption({
          tooltip: { trigger: 'item', formatter: '{b}: {c} TEU ({d}%)' },
          legend: { bottom: 0, textStyle: { color: '#64748b' } },
          series: [{
            type: 'pie',
            radius: '60%',
            data: [
              { name: 'S√† lan c·ªßa TPP', value: 8240 },
              { name: 'S√† lan thu√™ chuy·∫øn', value: 4100 }
            ],
            itemStyle: { borderRadius: 8, borderColor: '#fff', borderWidth: 2 },
            label: { show: true, formatter: '{b}\n{c} TEU\n({d}%)', color: '#1e293b', fontWeight: 600 },
            color: ['#3b82f6', '#f59e0b']
          }]
        });
      };

      const renderContainerTable = () => {
        const tbody = byId('ktTableContainer')?.querySelector('tbody');
        if (!tbody) return;

        tbody.innerHTML = '';
        containerData.forEach((item, idx) => {
          const tr = document.createElement('tr');
          const bgColor = idx % 2 === 0 ? '#ffffff' : '#f8fafc';
          tr.style.backgroundColor = bgColor;
          
          const teu = item.size20 + item.size40 * 2;

          tr.innerHTML = `
            <td><strong style="color: #1e293b;">${item.type}</strong></td>
            <td style="text-align: right; color: #64748b; font-weight: 500;">${item.size20.toLocaleString('vi-VN')}</td>
            <td style="text-align: right; color: #64748b; font-weight: 500;">${item.size40.toLocaleString('vi-VN')}</td>
            <td style="text-align: right; color: #3b82f6; font-weight: 700; font-size: 15px;">${teu.toLocaleString('vi-VN')}</td>
          `;
          tbody.appendChild(tr);
        });

        // Th√™m t·ªïng
        const trTotal = document.createElement('tr');
        trTotal.style.backgroundColor = '#f1f5f9';
        trTotal.style.fontWeight = '700';
        const total20 = containerData.reduce((sum, item) => sum + item.size20, 0);
        const total40 = containerData.reduce((sum, item) => sum + item.size40, 0);
        const totalTEU = total20 + total40 * 2;
        
        trTotal.innerHTML = `
          <td><strong style="color: #1e293b;">T·ªîNG</strong></td>
          <td style="text-align: right; color: #1e293b;">${total20.toLocaleString('vi-VN')}</td>
          <td style="text-align: right; color: #1e293b;">${total40.toLocaleString('vi-VN')}</td>
          <td style="text-align: right; color: #3b82f6; font-size: 16px;">${totalTEU.toLocaleString('vi-VN')}</td>
        `;
        tbody.appendChild(trTotal);
      };

      const renderTopCustomersChart = () => {
        const chart = chartsById['chart-kt-top-customers'];
        if (!chart) return;

        chart.setOption({
          tooltip: { trigger: 'axis', formatter: '{b}: {c} TEU' },
          grid: { left: '25%', right: '4%', bottom: '8%', top: '5%' },
          xAxis: { type: 'value', axisLabel: { formatter: '{value}', color: '#64748b' }, splitLine: { lineStyle: { color: '#f1f5f9' } } },
          yAxis: { type: 'category', data: topCustomers.map(c => c.name).reverse(), axisLabel: { color: '#334155', fontSize: 11, fontWeight: 500 } },
          series: [{
            type: 'bar',
            data: topCustomers.map(c => c.teu).reverse(),
            itemStyle: { 
              color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                { offset: 0, color: '#8b5cf6' },
                { offset: 1, color: '#c4b5fd' }
              ]),
              borderRadius: 4
            },
            label: { show: true, position: 'right', formatter: '{c}', color: '#1e293b', fontWeight: 600 }
          }]
        });
      };

      const render = () => {
        renderKpis();
        renderFinanceChart();
        renderCostStructureChart();
        renderRevenueTypeChart();
        renderBulkRevenueChart();
        renderBulkTable();
        renderBargeTypeChart();
        renderContainerTable();
        renderTopCustomersChart();
        renderDetailTable();
      };

      ktFilterMonth.addEventListener('change', render);
      render();
    };

    initOverviewReport();
    initCustomerManagement();
    initKhaiThacReport();
    initThuongVuReport();
    initMnRReport();
    initKhoBaiReport();
    initQuanLyRongReport();
    initXNTReport();
    initRepairReport();

    // Setup navigation after all initialization
    const navItems = document.querySelectorAll('.nav-item');
    const pages = document.querySelectorAll('.page');

    navItems.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.dataset.page;
        navItems.forEach(i => i.classList.toggle('active', i === btn));
        pages.forEach(page => page.classList.toggle('active', page.id === target));
        
        // Resize charts when switching pages
        setTimeout(() => {
          Object.values(chartsById).forEach(chart => {
            if (chart) {
              try {
                chart.resize();
              } catch (e) {
                console.warn('Chart resize error:', e);
              }
            }
          });
        }, 100);
      });
    });

    window.addEventListener('resize', () => {
      Object.values(chartsById).forEach(chart => {
        if (chart) {
          try {
            chart.resize();
          } catch (e) {
            console.warn('Chart resize error:', e);
          }
        }
      });
    });
  </script>
</body>
</html>
